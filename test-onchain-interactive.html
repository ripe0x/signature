<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script>window.LESS_TOKEN_ID=1;window.LESS_SEED="0xe3bb783817c9a594ecfddd15e867d13b1e67d5e46bc3da9c0199b526310c19fb";window.FOLD_COUNT=1;</script></head><body><script>(()=>{var Qt="FoldMono",en="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",In='"Courier New", Courier, monospace',Zt=`"${Qt}", ${In}`,Pt=.6,ae=.08,ce=.06,Rn=.03,Tn=.05;function je(t,e,n){let i=t/255,o=e/255,r=n/255;return(.2126*i+.7152*o+.0722*r)*100}var nt=[{hex:"#000000",name:"black",luminance:0,temperature:"neutral",r:0,g:0,b:0},{hex:"#0000AA",name:"blue",luminance:10,temperature:"cool",r:0,g:0,b:170},{hex:"#AA0000",name:"red",luminance:20,temperature:"warm",r:170,g:0,b:0},{hex:"#AA00AA",name:"magenta",luminance:25,temperature:"warm",r:170,g:0,b:170},{hex:"#FFFFFF",name:"white",luminance:100,temperature:"neutral",r:255,g:255,b:255},{hex:"#FFFF55",name:"yellow",luminance:93,temperature:"warm",r:255,g:255,b:85},{hex:"#55FFFF",name:"lightCyan",luminance:85,temperature:"cool",r:85,g:255,b:255},{hex:"#55FF55",name:"lightGreen",luminance:77,temperature:"cool",r:85,g:255,b:85},{hex:"#00AA00",name:"green",luminance:30,temperature:"cool",r:0,g:170,b:0},{hex:"#00AAAA",name:"cyan",luminance:40,temperature:"cool",r:0,g:170,b:170},{hex:"#5555FF",name:"lightBlue",luminance:45,temperature:"cool",r:85,g:85,b:255},{hex:"#FF5555",name:"lightRed",luminance:45,temperature:"warm",r:255,g:85,b:85},{hex:"#FF55FF",name:"lightMagenta",luminance:60,temperature:"warm",r:255,g:85,b:255}],Sn=nt.filter(t=>t.luminance<30||t.luminance>70),Ln={black:.2,white:.15,blue:.15,red:.15,magenta:.1,yellow:.1,lightCyan:.08,lightGreen:.07},Ht=nt,Fn=nt.filter(t=>t.temperature!=="neutral"),Dn=nt.filter(t=>t.temperature!=="neutral"),Ue=nt,Yo={dark:nt.filter(t=>t.luminance<30),light:nt.filter(t=>t.luminance>70)},Ke={warm:nt.filter(t=>t.temperature==="warm"),cool:nt.filter(t=>t.temperature==="cool"),neutral:nt.filter(t=>t.temperature==="neutral")};function kn(t,e){let n=t.r-e.r,i=t.g-e.g,o=t.b-e.b;return Math.sqrt(n*n*.3+i*i*.59+o*o*.11)}function Gn(t,e,n){let i=t.luminance,o=e.luminance,r=[];for(let l=0;l<n;l++){let f=l/(n-1),a=i+(o-i)*f,u=nt.filter(g=>g.temperature===t.temperature||g.temperature==="neutral"),b=u[0],M=Math.abs(b.luminance-a);for(let g of u){let p=Math.abs(g.luminance-a);p<M&&(M=p,b=g)}r.push(b)}return r}function Ve(t,e,n=4.5){let i=t.luminance/100,o=e.luminance/100,r=Math.max(i,o)+.05,l=Math.min(i,o)+.05;return r/l>=n}function fe(t,e){return e[Math.floor(t()*e.length)]}function On(t,e,n){let i=t(),o=0;for(let r of e)if(o+=n[r.name]||0,i<o)return r;return e[e.length-1]}function Te(t,e,n){e/=100,n/=100;let i=e*Math.min(n,1-n),o=r=>{let l=(r+t/30)%12,f=n-i*Math.max(Math.min(l-3,9-l,1),-1);return Math.round(255*f).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}`}function Se(t){let e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,i=parseInt(t.slice(5,7),16)/255,o=Math.max(e,n,i),r=Math.min(e,n,i),l,f,a=(o+r)/2;if(o===r)l=f=0;else{let u=o-r;switch(f=a>.5?u/(2-o-r):u/(o+r),o){case e:l=((n-i)/u+(n<i?6:0))/6;break;case n:l=((i-e)/u+2)/6;break;case i:l=((e-n)/u+4)/6;break}}return{h:l*360,s:f*100,l:a*100}}var Nn={red:["cyan","lightCyan"],magenta:["green","lightGreen"],blue:["yellow"],lightRed:["cyan","lightCyan"],lightMagenta:["green","lightGreen"],lightBlue:["yellow"],cyan:["red","lightRed"],lightCyan:["red","lightRed"],green:["magenta","lightMagenta"],lightGreen:["magenta","lightMagenta"],yellow:["blue","lightBlue"],black:["white","yellow","lightCyan"],white:["black","blue","magenta"]};function Wn(t,e,n){let o=[];switch(e){case"value":{let r=t.luminance<50;o=Ht.filter(l=>r?l.luminance>60:l.luminance<40);break}case"temperature":{if(t.temperature==="neutral")o=Ht.filter(r=>r.temperature!=="neutral"&&Math.abs(r.luminance-t.luminance)>25);else{let r=t.temperature==="warm"?"cool":"warm";o=Ht.filter(l=>l.temperature===r&&Math.abs(l.luminance-t.luminance)>25)}break}case"complement":{let r=Nn[t.name]||[];if(o=Ht.filter(l=>r.includes(l.name)),o.length===0){let l=t.luminance<50;o=Ht.filter(f=>l?f.luminance>60:f.luminance<40)}break}case"clash":{o=Ht.filter(r=>r.name!==t.name&&Math.abs(r.luminance-t.luminance)>20&&Math.abs(r.luminance-t.luminance)<50);break}}return o.sort((r,l)=>Math.abs(l.luminance-t.luminance)-Math.abs(r.luminance-t.luminance)),o.length>0?fe(n,o):t.luminance<50?nt.find(r=>r.name==="white"):nt.find(r=>r.name==="black")}function _n(t,e,n){if(n()<.4)return e;let i=Fn.filter(r=>r.name!==t.name&&r.name!==e.name&&Math.abs(r.luminance-t.luminance)>20);if(i.length===0)return e;let o=i.filter(r=>["yellow","lightCyan","lightMagenta","lightGreen"].includes(r.name));return o.length>0&&n()<.6?fe(n,o):fe(n,i)}function Hn(t){let e=fe(t,Dn),n;return e.luminance>50?n=nt.find(i=>i.name==="black"):e.luminance<30?n=t()<.75?nt.find(i=>i.name==="black"):nt.find(i=>i.name==="white"):n=t()<.6?nt.find(i=>i.name==="black"):nt.find(i=>i.name==="white"),{bg:n.hex,text:e.hex,accent:e.hex,strategy:`monochrome/${e.name}`,colorCount:2}}function Bn(t){let e=O(t);if(e()<.12)return Hn(e);let n=On(e,Sn,Ln),i=e(),o;i<.4?o="value":i<.68?o="temperature":i<.9?o="complement":o="clash";let r=Wn(n,o,e),l=_n(n,r,e),f=l.hex===r.hex?2:3;return Math.abs(n.luminance-r.luminance)<25?{bg:n.luminance<50?"#000000":"#FFFFFF",text:n.luminance<50?"#FFFFFF":"#000000",accent:"#FFFF55",strategy:o,colorCount:f}:{bg:n.hex,text:r.hex,accent:l.hex,strategy:o,colorCount:f}}function qe(t,e,n){let i=[];for(let o=e;o<=n;o++)t%o===0&&i.push(o);return i}function Pn(t,e,n,i){let o=1200-n*2-290,r=1697-n*2-145*2,l=qe(o,20,600),f=qe(r,20,600);l.length===0&&l.push(8),f.length===0&&f.push(12);let a=O(i+9999),u=1+ae+ce,b=Pt/u,M=[];for(let d of l)for(let m of f){let c=Math.max(d/m,m/d),h=m*b;c<=3&&d>=h&&M.push({w:d,h:m})}if(M.length===0)return{cellW:8,cellH:12};M.sort((d,m)=>d.w*d.h-m.w*m.h);let g=a(),p;if(g<.03){let d=Math.max(1,Math.ceil(M.length*.1)),m=Math.floor(a()*d);p=M[m]}else if(g<.1){let d=Math.floor(M.length*.1),m=Math.floor(M.length*.25),c=d+Math.floor(a()*Math.max(1,m-d));p=M[Math.min(c,M.length-1)]}else if(g<.45){let d=Math.floor(M.length*.25),m=Math.floor(M.length*.75),c=d+Math.floor(a()*(m-d));p=M[Math.min(c,M.length-1)]}else if(g<.95){let d=Math.floor(M.length*.75),m=Math.floor(M.length*.9),c=d+Math.floor(a()*Math.max(1,m-d));p=M[Math.min(c,M.length-1)]}else{let d=Math.floor(M.length*.9),m=d+Math.floor(a()*(M.length-d));p=M[Math.min(m,M.length-1)]}return{cellW:p.w,cellH:p.h}}function Xn(t){let n=O(t+5555)();return n<.4?"normal":n<.7?"inverted":n<.8?"binary":n<.9?"sparse":"dense"}function $n(t){return O(t+5556)()<.3}function Oe(t){let e=O(t+7777),n=e();if(n<.25){let i=.2+e()*.2;return{min:i,max:i+.1+e()*.2}}else if(n<.5){let i=.6+e()*.2;return{min:i,max:i+.1+e()*.1}}else return n<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function Yn(t){let e=O(t+11111);if(!(e()>=.5))return{hasOverlap:!1,amount:"none"};let i=e(),o;return i<.2?o="5%":i<.4?o="25%":i<.6?o="50%":i<.8?o="75%":o="95%",{hasOverlap:!0,amount:o}}function nn(t){let e=O(t+2222);return Math.floor(4+e()*66)}function on(t){let e=O(t+6666),n=e();return n<.16?{type:"horizontal",jitter:3+e()*12}:n<.32?{type:"vertical",jitter:3+e()*12}:n<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:n<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:n<.68?{type:"grid",jitter:3+e()*10}:n<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function Fe(t){let e=t.toUpperCase();return Ue.find(n=>n.hex===e)||Ue[0]}function zn(t,e,n){let i=O(t+3333),o=Fe(e),r=Fe(n),l=o.luminance>50,f=(u,b)=>l?b.luminance-u.luminance:u.luminance-b.luminance;if(i()<.5){let u=Gn(o,r,6);return[u[0].hex,u[Math.floor(u.length*.33)].hex,u[Math.floor(u.length*.66)].hex,u[u.length-1].hex]}else{let u=r.temperature,b=u==="warm"?"cool":"warm",M=Ke[u].filter(x=>Ve(o,x,2)).sort(f),g=Ke[b].filter(x=>Ve(o,x,2)).sort(f),p=[],d=new Set;M.length>0?(p.push(M[0].hex),d.add(M[0].hex)):(p.push(r.hex),d.add(r.hex));let m=M.filter(x=>!d.has(x.hex));if(m.length>0){let x=m[Math.floor(m.length*.4)];p.push(x.hex),d.add(x.hex)}else p.push(r.hex);let c=g.filter(x=>!d.has(x.hex));if(c.length>0){let x=c[Math.floor(c.length*.5)];p.push(x.hex),d.add(x.hex)}else p.push(r.hex);let h=[...M,...g].filter(x=>!d.has(x.hex)).sort(f);return h.length>0?p.push(h[h.length-1].hex):p.push(r.hex),p}}function jn(t){return O(t+4444)()<.25}function rn(t){return .08+(.35-.08)*Math.exp(-.03*t)}function Un(t,e=0){let n=O(t+77777),i=rn(e);return n()<i}function Kn(t){let n=O(t+88888)();return n<.5?"background":n<.85?"text":"accent"}function Le(t){let e=[0,51,102,153,204,255],n=e[0],i=Math.abs(t-n);for(let o of e){let r=Math.abs(t-o);r<i&&(i=r,n=o)}return n}function sn(t,e,n){let i=Le(t),o=Le(e),r=Le(n);return"#"+i.toString(16).padStart(2,"0").toUpperCase()+o.toString(16).padStart(2,"0").toUpperCase()+r.toString(16).padStart(2,"0").toUpperCase()}function ue(t){let e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function se(t){let e=ue(t);return(.299*e.r+.587*e.g+.114*e.b)/255}function Je(t,e,n){let i=ue(t),r=e*n*51,l=Math.max(0,Math.min(255,i.r+r)),f=Math.max(0,Math.min(255,i.g+r)),a=Math.max(0,Math.min(255,i.b+r));return sn(l,f,a)}function Bt(t,e,n,i){let r=O(t+(i==="background"?11111:i==="text"?22222:33333)),l=se(e),f=se(n),a;i==="background"?l<.3?a=r()<.75?1:-1:l>.7?a=r()<.75?-1:1:a=r()<.5?1:-1:i==="text"?f<.4?a=l>.5&&r()<.6?-1:1:a=l<.5&&r()<.6?1:-1:a=r()<.5?1:-1;let u=r(),b=u<.5?1:u<.85?2:3,M=Je(e,a,b),g=se(M),p=Math.abs(g-f);if(i!=="accent"&&p<.2){let d=Je(e,-a,b+1),m=se(d);if(Math.abs(m-f)>p)return d}return M}function Vn(t,e,n){let i={...e,anchorType:n,cgaBg:e.bg,cgaText:e.text,cgaAccent:e.accent};return n==="background"?(i.bg=e.bg,i.text=Bt(t,e.text,e.bg,"text"),i.accent=Bt(t+1,e.accent,e.bg,"accent")):n==="text"?(i.bg=Bt(t,e.bg,e.text,"background"),i.text=e.text,i.accent=Bt(t+1,e.accent,e.text,"accent")):(i.bg=Bt(t,e.bg,e.accent,"background"),i.text=Bt(t+1,e.text,i.bg,"text"),i.accent=e.accent),i}function qn(t,e){let n=ue(t),i=ue(e);return[.25,.5,.75,1].map(l=>{let f=Math.round(n.r+(i.r-n.r)*l),a=Math.round(n.g+(i.g-n.g)*l),u=Math.round(n.b+(i.b-n.b)*l);return sn(f,a,u)})}function Jn(t){return O(t+9191)()<.008}function Qn(t){return O(t+9393)()<.008}function Zn(t){let e=O(t+5555),n=.1+e()*.8,i=0,o=e()<.4,r=o?e()*180:null,l=o?.2+e()*.6:0,f=.3+e()*1.4;return{absorbency:n,intersectionThreshold:i,angleAffinity:r,affinityStrength:l,ceilingMultiplier:f}}function to(t){let e=t.absorbency<.35?"Resistant":t.absorbency<.65?"Standard":"Absorbent",n=t.intersectionThreshold<.15?"Fine":t.intersectionThreshold<.35?"Medium":"Coarse",i=t.angleAffinity!==null?"Grain":"Uniform";return`${e}/${n}/${i}`}function ln(t,e,n){return t}var zo=[-1/1,-1/2,-1/4,-1/8,-1/16,1/64,1/32,1/16,1/8,1/4,1/2,1,2];function an(t,e,n,i,o){let r=O(t+12345),l=r()<.6,f=!1,a=!1,u=!1,b=!1;if(l){let U=r();U<.33?f=!0:(U<.66||(f=!0),a=!0),f&&r()<.3&&(u=!0),a&&r()<.3&&(b=!0)}let M=[-1/16,-1/8,-1/4,-1/2],g=U=>{if(U)return M[Math.floor(r()*M.length)];let T=r();return T<.4?0:T<.525?1/64:T<.65?1/32:T<.75?1/16:T<.85?1/8:T<.9?1/4:T<.95?1/2:T<.98?1:2},p=e,d=n,m=f?g(u):0,c=p*m,h=p+c,x=h>0?Math.max(1,Math.floor((i+c)/h)):1,y=x>1?c:0;x===1&&p<i&&(p=i,y=0);let w=a?g(b):0,I=d*w,D=d+I,R=D>0?Math.max(1,Math.floor((o+I)/D)):1,F=R>1?I:0;R===1&&d<o&&(d=o,F=0);let Y=x,z=R,j=y,P=F,s=Y*p+(Y>1?(Y-1)*j:0),gt=z*d+(z>1?(z-1)*P:0),H=i-s,S=o-gt;return{cols:Y,rows:z,cellWidth:p,cellHeight:d,colGap:j,rowGap:P,strideX:p+j,strideY:d+P,gridOffsetX:H>0?H/2:0,gridOffsetY:S>0?S/2:0,actualGridWidth:s,actualGridHeight:gt}}function cn(t){let e=Object.values(t).filter(f=>f>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((f,a)=>f-a);let n=(f,a)=>{let u=Math.floor(f.length*a);return f[Math.min(u,f.length-1)]},i=n(e,.7),o=n(e,.94),r=n(e,.94)+1,l=n(e,.985);return{t1:Math.max(.01,i),t2:Math.max(i+.01,o),t3:Math.max(o+.01,r),tExtreme:Math.max(r+.01,l)}}function xt(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}var eo=1103515245n,no=12345n,Qe=0x7fffffffn;function O(t){let e=BigInt(Math.abs(t)||1);return()=>(e=e*eo+no&Qe,Number(e)/Number(Qe))}function fn(t,e,n){let o=O(t+22222)(),r;o<.6?r=0:o<.8?r=1:o<.9?r=2:o<.97?r=3:r=5;let l=O(t+33333),f=l(),a;f<.22?a="ltr":f<.44?a="rtl":f<.65?a="center":f<.8?a="alternate":f<.9?a="diagonal":f<.96?a="randomMid":a="checkerboard";let u=l()<.5,b=Math.floor(l()*e),M=l()<.5,g=O(t+11111),p=g()>=.65,m=(()=>{if(!p)return 1;let S=g();return S<.1?.95:S<.2?.75:S<.3?.65:S<.6?.5:S<.8?.25:.05})(),c=[.95,.75,.5,.25,.05],h=p?Math.floor(g()*5):0,x=c.indexOf(m),y=Math.floor(g()*3)+1,w=Math.floor(g()*3),I=Math.floor(g()*4)+1,D=[],R=[],F=[],Y=.3+g()*.4,z=.3+g()*.4,j=.3+g()*.4;for(let S=0;S<20;S++)D.push(g()<Y),R.push(g()<z),F.push(g()<j);let P=Math.floor(g()*2),s=g()<.1;return{cellOverflowAmount:r,drawDirectionMode:a,hasOverlap:p,invertedSingleCharOnEmpty:s,getOverlapFactor:(S,U)=>{if(!p)return 1;let T=x===-1?0:x;switch(h){case 1:w===1?D[S%20]&&(T=(T+y)%c.length):w===2?T=(T+S%3*y)%c.length:T=(T+Math.floor(S/I)*y)%c.length;break;case 2:w===1?R[U%20]&&(T=(T+y)%c.length):w===2?T=(T+U%3*y)%c.length:T=(T+Math.floor(U/I)*y)%c.length;break;case 3:if(w===1){let X=D[S%20],N=R[U%20];(P===0?X||N:X!==N)&&(T=(T+y)%c.length)}else(S+U)%(w===2?3:2)===0&&(T=(T+y)%c.length);break;case 4:w===1?F[(S+U)%20]&&(T=(T+y)%c.length):(S+U)%(w===2?5:I+1)===0&&(T=(T+y)%c.length);break}return c[T]||m},getCellDirection:(S,U)=>{if(a==="ltr")return"ltr";if(a==="rtl")return"rtl";if(a==="center")return"center";if(a==="alternate")return S%2===1!==u?"rtl":"ltr";if(a==="diagonal"){let T=(b+(M?S:-S)+e*100)%e;return U<T?"ltr":"rtl"}if(a==="randomMid"){let T=O(t+55555+S),X=Math.floor(T()*e);return U<X?"ltr":"rtl"}return a==="checkerboard"?(S+U)%2===0?"ltr":"rtl":"ltr"}}}var ot={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>ot.len(ot.sub(t,e)),norm:t=>{let e=ot.len(t);return e>1e-4?ot.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,n)=>({x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>ot.dist(t,e)<.5};function Ne(t,e,n,i){let o=ot.sub(e,t),r=ot.sub(i,n),l=o.x*r.y-o.y*r.x;if(Math.abs(l)<1e-4)return null;let f=ot.sub(n,t),a=(f.x*r.y-f.y*r.x)/l,u=(f.x*o.y-f.y*o.x)/l;return a>=.001&&a<=.999&&u>=.001&&u<=.999?{point:ot.add(t,ot.scale(o,a)),t:a,u}:null}function Ze(t,e){let n=t.reduce((o,r)=>o+r,0);if(n<=0)return 0;let i=e()*n;for(let o=0;o<t.length;o++)if(i-=t[o],i<=0)return o;return t.length-1}var oo=0,ro=1,io=2,so=3;function ut(t,e,n,i){switch(t){case oo:return{x:e*n,y:0};case ro:return{x:n,y:e*i};case io:return{x:(1-e)*n,y:i};case so:return{x:0,y:(1-e)*i};default:return{x:e*n,y:0}}}function De(t,e,n){switch(t){case 0:return{x:0,y:0};case 1:return{x:e,y:0};case 2:return{x:e,y:n};case 3:return{x:0,y:n};default:return{x:0,y:0}}}function un(t,e){return{x:t.p1.x+(t.p2.x-t.p1.x)*e,y:t.p1.y+(t.p2.y-t.p1.y)*e}}function ke(t,e){let n=e.x-t.x,i=e.y-t.y,o=Math.atan2(i,n)*180/Math.PI;return o<0&&(o+=180),o>=180&&(o-=180),o}function lo(t,e,n,i,o,r,l){let a=(()=>{if(!l)return[0,1,2,3];switch(l.type){case"horizontal":return[1,3];case"vertical":return[0,2];case"grid":return t%2===0?[1,3]:[0,2];case"diagonal":return[0,1,2,3];case"radial":case"clustered":case"random":default:return[0,1,2,3]}})();if(l&&l.type==="radial"){let g=l.focalX*i,p=l.focalY*o;if(t<10||e.length===0||r()<.6){let d=[{edge:0,dist:p},{edge:1,dist:i-g},{edge:2,dist:o-p},{edge:3,dist:g}];d.sort((x,y)=>x.dist-y.dist);let m=r(),c=m<.5?d[0].edge:m<.8?d[1].edge:d[Math.floor(r()*4)].edge,h;return c===0||c===2?h=.1+g/i*.8+(r()-.5)*.3:h=.1+p/o*.8+(r()-.5)*.3,h=Math.max(.05,Math.min(.95,h)),{point:ut(c,h,i,o),type:"edge",edge:c,t:h}}}if(l&&l.type==="clustered"){let g=l.clusterX*i,p=l.clusterY*o,d=l.spread;if(t<15||r()<.7){let m=[{edge:0,weight:1+(1-Math.abs(p/o))*2},{edge:1,weight:1+g/i*2},{edge:2,weight:1+p/o*2},{edge:3,weight:1+(1-g/i)*2}],c=m.reduce((w,I)=>w+I.weight,0),h=r()*c,x=0;for(let w of m)if(h-=w.weight,h<=0){x=w.edge;break}let y;return x===0||x===2?y=g/i+(r()-.5)*d:y=p/o+(r()-.5)*d,y=Math.max(.05,Math.min(.95,y)),{point:ut(x,y,i,o),type:"edge",edge:x,t:y}}}let u=Math.max(.2,1-t*.015),b=l&&(l.type==="horizontal"||l.type==="vertical"||l.type==="grid");if(b||r()<u||e.length===0&&n.length===0){let g=b?0:l&&l.type==="diagonal"?.5:.15;if(r()<g){let d=Math.floor(r()*4);return{point:De(d,i,o),type:"corner",corner:d}}else{let d=a[Math.floor(r()*a.length)],m=l&&l.jitter?l.jitter/100:0,c=.05+r()*.9,h=Math.max(.05,Math.min(.95,c+(r()-.5)*m));return{point:ut(d,h,i,o),type:"edge",edge:d,t:h}}}else if(n.length>0&&r()<.35){let p=n[Math.floor(r()*n.length)];return{point:{x:p.x,y:p.y},type:"intersection",intersectionIndex:n.indexOf(p)}}else if(e.length>0){let p=e[Math.floor(r()*e.length)],d=.1+r()*.8;return{point:un(p,d),type:"crease",creaseIndex:e.indexOf(p),t:d}}else{let p=a[Math.floor(r()*a.length)],d=.05+r()*.9;return{point:ut(p,d,i,o),type:"edge",edge:p,t:d}}}function ao(t,e,n,i,o,r,l,f,a){let u=Math.min(o,r)*.15,b=c=>c===0||c===2,M=c=>c===1||c===3;if(a&&(a.type==="horizontal"||a.type==="vertical"||a.type==="grid")){let c=a.type==="horizontal"||a.type==="grid"&&e%2===0;if(t.type==="edge"){let h=(t.edge+2)%4,x=M(t.edge);if(c&&x||!c&&!x){let y=a.jitter?a.jitter/100:0,w=t.t!==void 0?t.t:.5,I=Math.max(.05,Math.min(.95,w+(l()-.5)*y));return I=1-I,{point:ut(h,I,o,r),type:"edge",edge:h}}}}if(a&&a.type==="diagonal"){let c=a.angle||(l()<.5?45:135);if(t.type==="corner"){let h=(t.corner+2)%4;return{point:De(h,o,r),type:"corner"}}else if(t.type==="edge"){let h=a.jitter?(l()-.5)*a.jitter:0,x=(c+h)*Math.PI/180,y=t.point.x,w=t.point.y,I=Math.cos(x),D=Math.sin(x),R=null,F=0,Y=[{edge:0,y:0},{edge:2,y:r},{edge:3,x:0},{edge:1,x:o}];for(let z of Y){let j=null;if(z.y!==void 0){let P=(z.y-w)/D;if(P>0){let s=y+I*P;s>=0&&s<=o&&(j={x:s,y:z.y})}}else{let P=(z.x-y)/I;if(P>0){let s=w+D*P;s>=0&&s<=r&&(j={x:z.x,y:s})}}if(j){let P=ot.dist(t.point,j);P>F&&P>=u&&(F=P,R=j)}}if(R)return{point:R,type:"edge"}}}if(a&&a.type==="radial"){let c=a.focalX*o,h=a.focalY*r,x={x:c,y:h},y=t.point.x-c,w=t.point.y-h,I=Math.sqrt(y*y+w*w);if(I>0){let D=y/I,R=w/I,F=1/0;D>0&&(F=Math.min(F,(o-t.point.x)/D)),D<0&&(F=Math.min(F,-t.point.x/D)),R>0&&(F=Math.min(F,(r-t.point.y)/R)),R<0&&(F=Math.min(F,-t.point.y/R));let Y={x:Math.max(0,Math.min(o,t.point.x+D*F*.95)),y:Math.max(0,Math.min(r,t.point.y+R*F*.95))};if(ot.dist(t.point,Y)>=u)return{point:Y,type:"edge"}}}if(a&&a.type==="clustered"){let c=a.clusterX*o,h=a.clusterY*r,x={x:c,y:h},y=[];for(let I=0;I<4;I++)for(let D=0;D<3;D++){let R=.1+l()*.8,F=ut(I,R,o,r),Y=co(x,t.point,F),z=Math.max(o,r)*.5,j=Math.max(.1,1-Y/z)*3;y.push({point:F,type:"edge",edge:I,weight:j})}let w=y.filter(I=>ot.dist(t.point,I.point)>=u);if(w.length>0){let I=w.map(R=>R.weight),D=Ze(I,l);return w[D]}}let g=[];if(t.type==="edge"){let c=(t.edge+2)%4,h=(t.edge+1)%4,x=(t.edge+3)%4,y=e<3?3:1.5;for(let I=0;I<3;I++){let D=.1+l()*.8;g.push({point:ut(c,D,o,r),type:"edge",edge:c,weight:y})}let w=1;for(let I=0;I<2;I++){let D=.1+l()*.8;g.push({point:ut(h,D,o,r),type:"edge",edge:h,weight:w}),g.push({point:ut(x,D,o,r),type:"edge",edge:x,weight:w})}}else if(t.type==="corner"){let c=(t.corner+2)%4;g.push({point:De(c,o,r),type:"corner",weight:2});for(let h=0;h<4;h++)if(!(h===t.corner||h===(t.corner+3)%4)){let y=.2+l()*.6;g.push({point:ut(h,y,o,r),type:"edge",edge:h,weight:1.5})}}else{for(let c=0;c<4;c++){let h=.1+l()*.8;g.push({point:ut(c,h,o,r),type:"edge",edge:c,weight:1})}if(n.length>1&&e>3)for(let c=0;c<Math.min(3,n.length);c++){let h=Math.floor(l()*n.length),x=n[h];if(t.type==="crease"&&t.creaseIndex===h)continue;let y=.15+l()*.7;g.push({point:un(x,y),type:"crease",creaseIndex:h,weight:.6})}}if(n.length>0&&f)for(let c of g){let h=ke(t.point,c.point);for(let x of n){let y=ke(x.p1,x.p2),w=Math.abs(h-y);w>90&&(w=180-w),f.parallel>0&&w<15&&(c.weight*=1+f.parallel),f.perpendicular>0&&w>75&&(c.weight*=1+f.perpendicular)}}let p=g.filter(c=>ot.dist(t.point,c.point)>=u);if(p.length===0){for(let h=0;h<4;h++){let y=ut(h,.5,o,r);if(ot.dist(t.point,y)>=u)return{point:y,type:"edge",edge:h}}let c=t.type==="edge"?(t.edge+2)%4:0;return{point:ut(c,.5,o,r),type:"edge",edge:c}}let d=p.map(c=>c.weight),m=Ze(d,l);return p[m]}function co(t,e,n){let i=n.x-e.x,o=n.y-e.y,r=i*i+o*o;if(r===0)return ot.dist(t,e);let l=((t.x-e.x)*i+(t.y-e.y)*o)/r;l=Math.max(0,Math.min(1,l));let f={x:e.x+l*i,y:e.y+l*o};return ot.dist(t,f)}function fo(t){let e=[];for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++){let o=Ne(t[n].p1,t[n].p2,t[i].p1,t[i].p2);o&&e.push({x:o.point.x,y:o.point.y,crease1:n,crease2:i})}return e}function We(t,e,n,i,o={min:0,max:1},r=null,l=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let f=r||on(i),a=nn(i),u=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],b=[],M=null,g=null;if(!n||n<=0)return{creases:[],finalShape:u,maxFolds:a,firstFoldTarget:null,lastFoldTarget:null};let p=O(i),d=O(i+8888),m=O(i+6666),c=l||{absorbency:1,intersectionThreshold:0,angleAffinity:null,affinityStrength:0,ceilingMultiplier:1},h=[],x=O(i+1111);for(let R=0;R<a;R++)h[R]=.001+x()*.25;let y=O(i+2222),w={parallel:y()*.8,perpendicular:y()*.8},I=Math.max(t,e)*.05,D=[];for(let R=0;R<n;R++){let F=R%a,Y=Math.floor(R/a);if(F===0&&Y>0)for(let X of b)X.reductionMultiplier!==void 0&&(X.weight=Math.max(.01,X.weight*X.reductionMultiplier));R%5===0&&b.length>1&&(D=fo(b));let z=lo(R,b,D,t,e,p,f),j=ao(z,R,b,D,t,e,p,w,f),P=z.point,s=j.point,H=m()<c.absorbency,S=o.min+d()*(o.max-o.min);if(c.angleAffinity!==null&&c.affinityStrength>0){let X=ke(P,s),N=Math.abs(X-c.angleAffinity);N>90&&(N=180-N);let Z=1-N/90*c.affinityStrength;S*=Z}if(H&&S>.01&&(b.push({p1:ot.copy(P),p2:ot.copy(s),depth:b.length,weight:S,cyclePosition:F,reductionMultiplier:h[F],anchorType:z.type,terminusType:j.type}),b.length>1)){let X=b[b.length-1];for(let N=0;N<b.length-1;N++){let Z=Ne(X.p1,X.p2,b[N].p1,b[N].p2);Z&&D.push({x:Z.point.x,y:Z.point.y,crease1:N,crease2:b.length-1})}}let U=ot.mid(P,s),T={x:Math.max(I,Math.min(t-I,U.x)),y:Math.max(I,Math.min(e-I,U.y))};R===0&&M===null&&(M=T),g=T}return{creases:b,finalShape:u,maxFolds:a,firstFoldTarget:M,lastFoldTarget:g}}function uo(t){let e=[];for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++){let o=Ne(t[n].p1,t[n].p2,t[i].p1,t[i].p2);if(o){let r=t[n].weight||1,l=t[i].weight||1;e.push({x:o.point.x,y:o.point.y,depth1:t[n].depth,depth2:t[i].depth,gap:Math.abs(t[i].depth-t[n].depth),weight:r+l})}}return e}function hn(t,e,n,i,o,r=null,l=null){let f=uo(t),a=l||{intersectionThreshold:0,ceilingMultiplier:1},u=f.filter(c=>c.weight>=a.intersectionThreshold),b={},M={},g={};for(let c of u){let h=Math.floor(c.x/i),x=Math.floor(c.y/o);if(h>=0&&h<e&&x>=0&&x<n){let y=`${h},${x}`;b[y]=(b[y]||0)+c.weight,M[y]=Math.max(M[y]||0,c.gap),g[y]=(g[y]||0)+1}}let d=e*n*.5*a.ceilingMultiplier,m=Object.values(b).reduce((c,h)=>c+h,0);if(m>d&&m>0){let c=d/m,h=c+(1-c)*.3;for(let x of Object.keys(b))b[x]*=h}return{activeCreases:t,intersections:u,cellWeights:b,cellMaxGap:M,cellIntersectionCounts:g,destroyed:0,maxFolds:r}}function ho({folds:t,seed:e,outputWidth:n,outputHeight:i,bgColor:o,textColor:r,accentColor:l,cellWidth:f,cellHeight:a,renderMode:u,showEmptyCells:b=!1,multiColor:M,levelColors:g,foldStrategy:p=null,paperProperties:d=null,padding:m=0,showCreases:c=!1,showPaperShape:h=!1,showFoldTargets:x=!1,showIntersections:y=!1,showGrid:w=!1,showHitCounts:I=!1,showCellOutlines:D=!1,showCreaseLines:R=!1,fontFamily:F=Zt,linesOnlyMode:Y=!1,analyticsMode:z=!1,skipCells:j=null}){let P=document.createElement("canvas"),s=P.getContext("2d"),gt=2;P.width=n*gt,P.height=i*gt,s.setTransform(gt,0,0,gt,0,0),s.fillStyle=o,s.fillRect(0,0,n,i);let H=n/1200,S=i/1697,U=1200-m*2-145*2,T=1697-m*2-145*2;{let v=15*H;s.font=`${v}px ${F}`,s.fillStyle=r,s.globalAlpha=.1;let E=v*Pt,k=v*1.13;for(let K=0;K<i+k;K+=k)for(let rt=0;rt<n+E;rt+=E)s.fillText("\u2591",rt,K+k);s.globalAlpha=1}let X=an(e,f,a,U,T),{cols:N,rows:Z,strideX:Xt,strideY:$t,gridOffsetX:de,gridOffsetY:pe}=X,ge=X.cellWidth,Yt=X.cellHeight,Rt=U*H,Ot=T*S,W=(m+145+de)*H,_=(m+145+pe)*S,mt=ge*H,yt=Yt*S,lt=Xt*H,bt=$t*S,zt=Oe(e),wt=ln(d,N,Z),Ct=X.actualGridWidth,Tt=X.actualGridHeight,{creases:At,finalShape:St,maxFolds:xe,firstFoldTarget:Lt,lastFoldTarget:It}=We(Ct,Tt,t,e,zt,p,wt),me=At.map(C=>({...C,p1:{x:C.p1.x*H,y:C.p1.y*S},p2:{x:C.p2.x*H,y:C.p2.y*S}})),te=null;if(Lt){let C=Math.max(0,Math.min(N-1,Math.floor(Lt.x/Xt))),v=Math.max(0,Math.min(Z-1,Math.floor(Lt.y/$t)));te=`${C},${v}`}let ee=null;if(It){let C=Math.max(0,Math.min(N-1,Math.floor(It.x/Xt))),v=Math.max(0,Math.min(Z-1,Math.floor(It.y/$t)));ee=`${C},${v}`}let{activeCreases:Et,intersections:ht,cellWeights:$,cellMaxGap:dt}=hn(me,N,Z,lt,bt,xe,d),it=new Set;if(Object.keys(dt).length>0){let C=Math.max(...Object.values(dt));for(let[v,E]of Object.entries(dt))E===C&&it.add(v)}let jt=1+ae+ce,V=yt/jt;s.font=`${V}px ${F}`,s.textBaseline="top";let tt=[" ","\u2591","\u2592","\u2593"],et=V<30?2:3,B=V*Pt,J=V*ae,Ut=V*ce,He=V*Rn,Be=V*Tn,Mt=cn($),ye=fn(e,N,u),{cellOverflowAmount:ne,drawDirectionMode:Me,invertedSingleCharOnEmpty:Kt,getOverlapFactor:Vt,getCellDirection:be}=ye,Ft=(C,v)=>g&&g.length>0?g[Math.min(C,3)]:r,Dt=O(e+22222),Nt=Dt()<.25,Ce=Math.round(2+Dt()*2)*H,xn=Math.round(1+Dt()*2)*S,mn=Nt?.4+Dt()*.3:0,yn=(C,v)=>{let E=O(e+22222+C*1e3+v),k=Math.floor(E()*3);return{x:k!==1?Ce:0,y:k!==0?xn:0}},Mn=Nt?(()=>{if(l&&l!==r)return l;let C=Fe(r),v=nt.filter(K=>K.hex!==r&&K.hex!==o&&kn(K,C)>100),E=Math.floor(Dt()*v.length);return(v.length>0?v[E]:nt[0]).hex})():null,Pe=(m+145)*H,Ee=(m+145)*S,ve=Pe+Be,bn=Ee+J,we=Pe+Rt,Bo=Ee+Ot-Ut;if(Y){let C=L=>{let G=parseInt(L.slice(1,3),16),st=parseInt(L.slice(3,5),16),Q=parseInt(L.slice(5,7),16);return je(G,st,Q)},v=C(o),E=C(r),k=C(l),K=Math.abs(v-E)>Math.abs(v-k)?r:l,rt=2*H;if(Et.length>0){s.strokeStyle=K,s.lineWidth=rt,s.globalAlpha=1,s.lineCap="round";for(let L of Et)s.beginPath(),s.moveTo(W+L.p1.x,_+L.p1.y),s.lineTo(W+L.p2.x,_+L.p2.y),s.stroke()}if(ht&&ht.length>0){s.strokeStyle=K,s.lineWidth=rt,s.globalAlpha=1;let L=4*H;for(let G of ht)s.beginPath(),s.arc(W+G.x,_+G.y,L,0,Math.PI*2),s.stroke()}s.globalAlpha=1}else if(z){let C=2*H;s.strokeStyle=l,s.lineWidth=1,s.globalAlpha=.4;for(let E=0;E<=N;E++){let k=W+E*lt;s.beginPath(),s.moveTo(k,_),s.lineTo(k,_+Ot),s.stroke()}for(let E=0;E<=Z;E++){let k=_+E*bt;s.beginPath(),s.moveTo(W,k),s.lineTo(W+Rt,k),s.stroke()}if(s.globalAlpha=1,Et.length>0){s.strokeStyle=l,s.lineWidth=C,s.globalAlpha=1,s.lineCap="round";for(let E of Et)s.beginPath(),s.moveTo(W+E.p1.x,_+E.p1.y),s.lineTo(W+E.p2.x,_+E.p2.y),s.stroke()}if(ht&&ht.length>0){s.strokeStyle=l,s.lineWidth=C,s.globalAlpha=1;let E=4*H;for(let k of ht)s.beginPath(),s.arc(W+k.x,_+k.y,E,0,Math.PI*2),s.stroke()}let v=Math.floor(Math.min(mt*.45,yt*.7));s.font=`bold ${v}px monospace`,s.textAlign="center",s.textBaseline="middle",s.fillStyle=l;for(let E=0;E<Z;E++)for(let k=0;k<N;k++){let K=Math.round(W+k*lt+mt/2),rt=Math.round(_+E*bt+yt/2),L=`${k},${E}`,G=$[L]||0;s.fillText(Math.round(G).toString(),K,rt)}s.textAlign="left",s.textBaseline="top"}else if(I){let C=Math.floor(Math.min(mt*.45,yt*.7));s.font=`bold ${C}px monospace`,s.textAlign="center",s.textBaseline="middle",s.fillStyle=r;for(let v=0;v<Z;v++)for(let E=0;E<N;E++){let k=Math.round(W+E*lt+mt/2),K=Math.round(_+v*bt+yt/2),rt=`${E},${v}`,L=$[rt]||0;s.fillText(Math.round(L).toString(),k,K)}s.textAlign="left",s.textBaseline="top"}else{let C=Math.max(W,ve),v=Math.max(_,bn);for(let E=0;E<Z;E++){let k=Math.round(v+E*bt);if(!(k>Ee+Ot))for(let K=0;K<N;K++){let rt=Math.round(C+K*lt),L=`${K},${E}`;if(j&&j.has(L))continue;let G=$[L]||0,st=null,Q=r,q=-1,Wt=!1;if(te===L)q=G>0?xt(G,Mt):2,st=tt[Math.min(Math.max(q,2),et)],Q=l;else if(u==="normal")if(q=xt(G,Mt),q===0?st=null:st=tt[Math.min(q,et)],Q=Ft(q,L),G>=1.5){let _t=G-1.5,kt=30+Math.min(_t*300,150),ct=Se(r);Q=Te((ct.h+kt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else it.has(L)&&G>0?Q=l:ee===L&&(Q=r);else if(u==="binary")G===0?b&&(st=tt[1],q=0,Wt=!0,Q=r):(q=et,st=tt[q],Q=Ft(q,L),it.has(L)&&(Q=l));else if(u==="inverted")if(q=Math.min(3-xt(G,Mt),et),st=tt[q],Q=Ft(q,L),G>=1.5){let _t=G-1.5,kt=30+Math.min(_t*300,150),ct=Se(r);Q=Te((ct.h+kt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else it.has(L)&&G>0&&(Q=l);else if(u==="sparse")q=xt(G,Mt),q===1?(st=tt[1],Q=Ft(1,L),it.has(L)&&(Q=l)):st=null;else if(u==="dense")if(q=xt(G,Mt),q>=2)if(st=tt[Math.min(q,et)],Q=Ft(q,L),G>=1.5){let _t=G-1.5,kt=30+Math.min(_t*300,150),ct=Se(r);Q=Te((ct.h+kt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else it.has(L)&&(Q=l);else st=null;if(st){if(te===L||ee===L)s.fillStyle=Q;else{let at=Ft(xt(G,Mt),L);s.fillStyle=it.has(L)&&G>0?l:at}Wt&&(s.globalAlpha=.1,s.fillStyle=r);let _t=s.measureText(st).width,kt=rt+mt,ct=Math.min(kt,we),qt=ct-rt;if(qt<B*.5)continue;let En=Wt||G===0&&u!=="inverted",Ae=u==="inverted"&&G===0&&Kt,vn=En||Ae?1:Vt(E,K),Xe=B*vn,Ie=Math.max(1,Math.floor((qt-B)/Xe)+1),wn=(Ie-1)*Xe+B,vt=(qt-wn)/B>.3?Ie+1:Ie,Gt=vt<=1?B:(qt-B)/(vt-1),$e=Wt||Ae?0:ne*mt,Ye=0;$e>0&&(Ye=Math.ceil($e/Gt));let An=Ae?1:vt+Ye,ze=be(E,K),oe=rt+qt/2;for(let at=0;at<An&&q>=0;at++){let Re=st;q>=2&&at>0&&at%2===0&&(Re=tt[Math.max(0,q-1)]);let ft;if(ze==="center")if(at<vt){let pt=Math.floor((at+1)/2)*Gt;at%2===0?ft=oe+(at===0?-B/2:pt-B/2):ft=oe-pt-B/2}else{let pt=at-vt,re=Math.floor(vt/2)*Gt,ie=Math.floor((pt+1)/2)*Gt;if(pt%2===0){if(ft=oe+re+ie,ft+B>we)break}else if(ft=oe-re-ie-B,ft<ve)break}else if(at<vt)ft=rt+at*Gt;else if(ze==="rtl"){let pt=at-vt;if(ft=rt-(pt+1)*Gt,ft<ve)break}else{let pt=at-vt;if(ft=ct+pt*Gt,ft+B>we)break}if(Nt&&!Wt){let pt=yn(E,K),re=s.globalAlpha,ie=s.fillStyle;s.globalAlpha=mn,s.fillStyle=Mn,s.fillText(Re,ft+pt.x,k+pt.y),s.globalAlpha=re,s.fillStyle=ie}s.fillText(Re,ft,k)}Wt&&(s.globalAlpha=1)}}}}if(D){s.strokeStyle=l,s.lineWidth=.5,s.globalAlpha=1;for(let C=0;C<Z;C++)for(let v=0;v<N;v++){let E=Math.round(W+v*lt),k=Math.round(_+C*bt);s.strokeRect(E,k,mt,yt)}}if(R&&Et.length>0){let v=O(e+9292)()<.6;s.strokeStyle=v?l:r,s.lineWidth=1.5*H,s.globalAlpha=.85,s.lineCap="round";for(let E of Et)s.beginPath(),s.moveTo(W+E.p1.x,_+E.p1.y),s.lineTo(W+E.p2.x,_+E.p2.y),s.stroke();s.globalAlpha=1}if(c){let C=L=>{let G=parseInt(L.slice(1,3),16),st=parseInt(L.slice(3,5),16),Q=parseInt(L.slice(5,7),16);return je(G,st,Q)},v=C(o),E=C(r),k=C(l),K=Math.abs(v-E)>Math.abs(v-k)?r:l,rt=2*H;s.strokeStyle=K,s.lineWidth=rt,s.globalAlpha=1,s.lineCap="round";for(let L of Et)s.beginPath(),s.moveTo(W+L.p1.x,_+L.p1.y),s.lineTo(W+L.p2.x,_+L.p2.y),s.stroke();if(ht&&ht.length>0){s.strokeStyle=K,s.lineWidth=rt,s.globalAlpha=1;let L=4*H;for(let G of ht)s.beginPath(),s.arc(W+G.x,_+G.y,L,0,Math.PI*2),s.stroke()}}if(h){let C=St.map(v=>({x:v.x*H,y:v.y*S}));if(C.length>=3){s.strokeStyle="#00ffff",s.lineWidth=2,s.globalAlpha=.9,s.beginPath(),s.moveTo(W+C[0].x,_+C[0].y);for(let v=1;v<C.length;v++)s.lineTo(W+C[v].x,_+C[v].y);s.closePath(),s.stroke(),s.fillStyle="#00ffff",s.globalAlpha=.15,s.fill(),s.globalAlpha=1}}if(w){s.strokeStyle=r,s.lineWidth=1,s.globalAlpha=.3;for(let C=0;C<=N;C++){let v=W+C*lt;s.beginPath(),s.moveTo(v,_),s.lineTo(v,_+Ot),s.stroke()}for(let C=0;C<=Z;C++){let v=_+C*bt;s.beginPath(),s.moveTo(W,v),s.lineTo(W+Rt,v),s.stroke()}s.globalAlpha=1}if(x){let C=8*H;if(s.lineWidth=2,s.globalAlpha=1,Lt){let v=W+Lt.x*H,E=_+Lt.y*S;s.strokeStyle="#00ff00",s.beginPath(),s.arc(v,E,C,0,Math.PI*2),s.stroke()}if(It){let v=W+It.x*H,E=_+It.y*S;s.strokeStyle="#00ff00",s.beginPath(),s.arc(v,E,C,0,Math.PI*2),s.stroke()}}let Cn={grid:{cols:N,rows:Z,colGap:X.colGap,rowGap:X.rowGap},drawDirection:Me,foldStrategy:p?.type||"random",multiColor:M,showCreaseLines:R,creaseCount:At.length};return{canvas:P,dataUrl:P.toDataURL("image/png"),settings:Cn}}function _e(t,e=1200,n=1697,i=0,o=null){let r=Oe(t),l=on(t),f=nn(t),a=Zn(t),u=o;if(u===null){let j=O(t+9999);u=Math.floor(1+j()*500)}let b=e-145*2,M=n-145*2,{creases:g}=We(b,M,u,t,r,l,a),p=g.length,d=rn(p),m=Un(t,p),c=Bn(t),h,x=null;m?(x=Kn(t),h=Vn(t,c,x)):h=c;let y=m?!1:jn(t),w=null;m?w=qn(h.bg,h.text):y&&(w=zn(t,h.bg,h.text));let I=Pn(e,n,0,t),D=Xn(t),R=$n(t),F=Jn(t),Y=Qn(t),z=Yn(t);return{seed:t,palette:h,cells:I,renderMode:D,showEmptyCells:R,weightRange:r,foldStrategy:l,gradientMode:m,gradientProbability:d,creaseCount:p,multiColor:y,levelColors:w,maxFolds:f,paperProperties:a,showCreaseLines:F,analyticsMode:Y,overlapInfo:z,folds:u}}function po(t,e,n,i=""){let o=_e(e,1200,1697,0,n),r=to(o.paperProperties),l=Math.round(o.gradientProbability*100),f;return o.gradientMode?f=`gradient/${o.palette.anchorType||"background"} (${l}% @ ${o.creaseCount} creases)`:f=`cga/${o.palette.strategy} (${l}% gradient @ ${o.creaseCount} creases)`,{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:i?`${i}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:o.foldStrategy.type},{trait_type:"Render Mode",value:o.renderMode},{trait_type:"Multi-Color",value:o.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${o.cells.cellW}x${o.cells.cellH}`},{trait_type:"Fold Count",value:n},{trait_type:"Max Folds",value:o.maxFolds},{trait_type:"Crease Count",value:o.creaseCount},{trait_type:"Palette Strategy",value:f},{trait_type:"Paper Type",value:r},{trait_type:"Paper Grain",value:o.paperProperties.angleAffinity!==null?"Grain":"Uniform"},...o.showCreaseLines?[{trait_type:"Crease Lines",value:"Visible"}]:[]]}}async function go(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${Qt}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${Qt}`),await document.fonts.ready,!0}catch(n){return console.warn("Failed to load on-chain font:",n),!1}}function xo(t){if(typeof t=="number")return t;if(typeof t!="string")return 0;let e=t.replace(/^0x/,"").slice(0,16),n=BigInt("0x"+e);return Number(n%BigInt(2147483647))}var le=null;function mo(t,e,n){let{seed:i,foldCount:o,params:r}=t,{palette:l,cells:f,renderMode:a,showEmptyCells:u,multiColor:b,levelColors:M,foldStrategy:g,paperProperties:p}=r,{cellW:d,cellH:m}=f,{bg:c,text:h,accent:x}=l,y=e/1200,w=n/1697,I=1200-145*2,D=1697-145*2,R=an(i,d,m,I,D),{cols:F,rows:Y,strideX:z,strideY:j,gridOffsetX:P,gridOffsetY:s}=R,gt=R.cellWidth,H=R.cellHeight,S=(145+P)*y,U=(145+s)*w,T=gt*y,X=H*w,N=z*y,Z=j*w,Xt=Oe(i),$t=ln(p,F,Y),de=R.actualGridWidth,pe=R.actualGridHeight,{creases:ge,firstFoldTarget:Yt,lastFoldTarget:Rt}=We(de,pe,o,i,Xt,g,$t),Ot=ge.map($=>({...$,p1:{x:$.p1.x*y,y:$.p1.y*w},p2:{x:$.p2.x*y,y:$.p2.y*w}})),W=null;if(Yt){let $=Math.max(0,Math.min(F-1,Math.floor(Yt.x/z))),dt=Math.max(0,Math.min(Y-1,Math.floor(Yt.y/j)));W=`${$},${dt}`}let _=null;if(Rt){let $=Math.max(0,Math.min(F-1,Math.floor(Rt.x/z))),dt=Math.max(0,Math.min(Y-1,Math.floor(Rt.y/j)));_=`${$},${dt}`}let{cellWeights:mt,cellMaxGap:yt}=hn(Ot,F,Y,N,Z,o,p),lt=new Set;if(Object.keys(yt).length>0){let $=Math.max(...Object.values(yt));for(let[dt,it]of Object.entries(yt))it===$&&lt.add(dt)}let bt=1+ae+ce,zt=X/bt,wt=zt*Pt,Ct=[" ","\u2591","\u2592","\u2593"],Tt=zt<30?2:3,At=cn(mt),St=($,dt)=>b&&M&&M[$]?M[$]:h,xe=fn(i,F,a),{cellOverflowAmount:Lt,invertedSingleCharOnEmpty:It,getOverlapFactor:me,getCellDirection:te}=xe,ee=145*y,Et=1055*y,ht=[];for(let $=0;$<Y;$++){let dt=U+$*Z;for(let it=0;it<F;it++){let jt=S+it*N,V=`${it},${$}`,tt=mt[V]||0,et=null,B=h,J=-1,Ut=!1;if(W===V?(J=tt>0?xt(tt,At):2,et=Ct[Math.min(Math.max(J,2),Tt)],B=x):a==="normal"?(J=xt(tt,At),J===0?et=null:et=Ct[Math.min(J,Tt)],B=St(J,V),lt.has(V)&&tt>0?B=x:_===V&&(B=h)):a==="binary"?tt===0?u&&(et=Ct[1],Ut=!0,B=h):(J=Tt,et=Ct[J],B=St(J,V),lt.has(V)&&(B=x)):a==="inverted"?(J=Math.min(3-xt(tt,At),Tt),et=Ct[J],B=St(J,V),lt.has(V)&&tt>0&&(B=x)):a==="sparse"?(J=xt(tt,At),J===1?(et=Ct[1],B=St(1,V),lt.has(V)&&(B=x)):et=null):a==="dense"&&(J=xt(tt,At),J>=2?(et=Ct[Math.min(J,Tt)],B=St(J,V),lt.has(V)&&(B=x)):et=null),!et||et===" "||Ut)continue;let He=jt+T,Mt=Math.min(He,Et)-jt;if(Mt<wt*.5)continue;let ye=Ut||tt===0&&a!=="inverted",ne=a==="inverted"&&tt===0&&It,Me=ye||ne?1:me($,it),Kt=wt*Me,Vt=Math.max(1,Math.floor((Mt-wt)/Kt)+1),be=(Vt-1)*Kt+wt,Dt=(Mt-be)/wt,Nt=ne?1:Dt>.3?Vt+1:Vt,Ce=et.repeat(Nt);ht.push({id:`char-${$}-${it}`,char:Ce,editChar:et,x:jt,y:dt,width:T,height:X,fontSize:zt,color:B,row:$,col:it,level:J,numChars:Nt,step:Kt,charWidth:wt,isAccent:lt.has(V),isFoldTarget:W===V||_===V})}}return{characters:ht,background:{color:c,textureColor:h,textureOpacity:.1},grid:{cols:F,rows:Y,cellWidth:T,cellHeight:X,offsetX:S,offsetY:U}}}function yo(t,e){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>t.apply(this,i),e)}}var A={charData:null,charElements:[],textBuffer:[],originalPositions:new Map,cursorIndex:-1,isEditing:!1,dragState:null,hiddenInput:null,container:null,bgCanvas:null,charLayer:null,loading:null},Mo=`
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    overflow: hidden;
  }
  .fold-container {
    position: relative;
    width: min(100vw, calc(100vh * 1200 / 1697));
    height: min(100vh, calc(100vw * 1697 / 1200));
  }
  .fold-loading {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #fff;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "Courier New", monospace;
    font-size: 24px;
    color: #000;
  }
  .fold-bg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
  }
  .fold-chars {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    overflow: hidden;
  }
  .fold-char {
    position: absolute;
    cursor: default;
    user-select: none;
    font-family: "${Qt}", "Courier New", monospace;
    line-height: 1;
    white-space: pre;
  }
  .fold-char.dragging {
    cursor: grabbing;
    z-index: 1000;
    filter: brightness(1.2);
  }
  .fold-char.editing::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 2px;
    height: 60%;
    background: currentColor;
    animation: cursor-blink 1s step-end infinite;
  }
  @keyframes cursor-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
`;function bo(){if(document.getElementById("fold-interactive-css"))return;let t=document.createElement("style");t.id="fold-interactive-css",t.textContent=Mo,document.head.appendChild(t)}function Co(){let t=document.createElement("div");t.className="fold-container",t.id="fold-container",t.style.cssText="position:relative;width:min(100vw,calc(100vh*1200/1697));height:min(100vh,calc(100vw*1697/1200))";let e=document.createElement("div");e.className="fold-loading",e.id="fold-loading",e.textContent="\u2592",e.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;background:#fff;z-index:100;display:flex;align-items:center;justify-content:center;font-family:Courier New,monospace;font-size:24px;color:#000";let n=document.createElement("canvas");n.className="fold-bg",n.id="fold-bg";let i=document.createElement("div");return i.className="fold-chars",i.id="fold-chars",t.appendChild(e),t.appendChild(n),t.appendChild(i),document.body.appendChild(t),A.container=t,A.bgCanvas=n,A.charLayer=i,A.loading=e,{container:t,bgCanvas:n,charLayer:i,loading:e}}function Eo(t,e,n,i){let o=t.getContext("2d"),r=window.devicePixelRatio||2;t.width=n*r,t.height=i*r,t.style.width=n+"px",t.style.height=i+"px",o.setTransform(r,0,0,r,0,0),o.fillStyle=e.color,o.fillRect(0,0,n,i);let f=15*(n/1200);o.font=`${f}px ${Zt}`,o.fillStyle=e.textureColor,o.globalAlpha=e.textureOpacity;let a=f*Pt,u=f*1.13;for(let b=0;b<i+u;b+=u)for(let M=0;M<n+a;M+=a)o.fillText("\u2591",M,b+u);o.globalAlpha=1}function vo(t,e){he(),t.innerHTML="",A.charElements=[],A.originalPositions.clear(),A.textBuffer=[],A.hiddenInput=null;for(let i=0;i<e.length;i++){let o=e[i],r=document.createElement("span");r.className="fold-char",r.textContent=o.char,r.dataset.index=i,r.style.left=o.x+"px",r.style.top=o.y+"px",r.style.fontSize=o.fontSize+"px",r.style.color=o.color,r.style.width=o.width+"px",r.style.height=o.height+"px";let l=o.editChar||o.char.charAt(0),f=o.numChars||o.char.length;A.originalPositions.set(i,{x:o.x,y:o.y,char:o.char,editChar:l,numChars:f}),A.textBuffer.push({char:l,displayChar:o.char,originalChar:l,numChars:f,el:r,color:o.color}),t.appendChild(r),A.charElements.push(r)}let n=document.createElement("input");n.type="text",n.style.cssText="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;",n.addEventListener("input",wo),n.addEventListener("keydown",Ao),n.addEventListener("blur",Io),t.appendChild(n),A.hiddenInput=n}function wo(t){let{isEditing:e,cursorIndex:n,textBuffer:i,hiddenInput:o}=A;if(!e||n<0)return;let r=t.data;if(!r)return;for(let f=0;f<r.length;f++){let a=n+f;if(a>=i.length)break;let u=i[a];u.char=r[f],u.el.textContent=r[f].repeat(u.numChars)}let l=Math.min(n+r.length,i.length-1);l!==n&&(A.cursorIndex=l,Jt()),o.value=""}function Ao(t){let{isEditing:e,cursorIndex:n,textBuffer:i}=A;if(!e)return;if(t.key==="Escape"){he();return}let o=()=>{if(n>=0&&n<i.length){let r=i[n];r.el.textContent=r.char.repeat(r.numChars)}};if(t.key==="ArrowLeft")t.preventDefault(),n>0&&(o(),A.cursorIndex=n-1,Jt());else if(t.key==="ArrowRight")t.preventDefault(),n<i.length-1&&(o(),A.cursorIndex=n+1,Jt());else if(t.key==="Backspace"){t.preventDefault();let r=i[n];r.char=r.originalChar,r.el.textContent=r.originalChar.repeat(r.numChars),n>0&&(A.cursorIndex=n-1,Jt())}else if(t.key==="Delete"){t.preventDefault();let r=i[n];r.char=r.originalChar}}function Io(){setTimeout(()=>{A.hiddenInput&&!A.hiddenInput.matches(":focus")&&he()},100)}function Jt(){let{charElements:t,cursorIndex:e,hiddenInput:n,textBuffer:i}=A;if(t.forEach(o=>o.classList.remove("editing")),e>=0&&e<t.length){let o=i[e];o&&(o.el.textContent=""),t[e].classList.add("editing"),n&&(n.style.left=t[e].style.left,n.style.top=t[e].style.top)}}function Ro(t){A.isEditing=!0,A.cursorIndex=t;let e=A.textBuffer[t];e&&(e.el.textContent=""),Jt(),A.hiddenInput&&A.hiddenInput.focus()}function he(){let{cursorIndex:t,textBuffer:e,charElements:n}=A;if(t>=0&&t<e.length){let i=e[t];i&&i.el.textContent===""&&(i.el.textContent=i.char.repeat(i.numChars))}A.isEditing=!1,A.cursorIndex=-1,n.forEach(i=>i.classList.remove("editing","cursor")),A.hiddenInput&&A.hiddenInput.blur()}function To(t){t.addEventListener("mousedown",So),t.addEventListener("touchstart",Lo,{passive:!1}),document.addEventListener("mousemove",Fo),document.addEventListener("touchmove",Do,{passive:!1}),document.addEventListener("mouseup",ko),document.addEventListener("touchend",Go),t.addEventListener("dblclick",Oo)}function So(t){let e=t.target.closest(".fold-char");e&&(t.preventDefault(),dn(e,t.clientX,t.clientY))}function Lo(t){let e=t.target.closest(".fold-char");if(!e)return;t.preventDefault();let n=t.touches[0];dn(e,n.clientX,n.clientY)}function dn(t,e,n){let i=t.getBoundingClientRect(),o=A.container.getBoundingClientRect();A.dragState={el:t,offsetX:e-i.left,offsetY:n-i.top,containerRect:o},t.classList.add("dragging")}function Fo(t){A.dragState&&pn(t.clientX,t.clientY)}function Do(t){if(!A.dragState)return;t.preventDefault();let e=t.touches[0];pn(e.clientX,e.clientY)}function pn(t,e){let{el:n,containerRect:i,offsetX:o,offsetY:r}=A.dragState,l=t-i.left-o,f=e-i.top-r;n.style.left=l+"px",n.style.top=f+"px"}function ko(){gn()}function Go(){gn()}function gn(){A.dragState&&(A.dragState.el.classList.remove("dragging"),A.dragState=null)}function Oo(t){let e=t.target.closest(".fold-char");if(!e)return;t.preventDefault();let n=parseInt(e.dataset.index,10);isNaN(n)||Ro(n)}function No(t){let{charData:e,charElements:n,container:i}=A;if(!e||!i)return;let o=i.getBoundingClientRect(),r=o.width,l=o.height,f=window.devicePixelRatio||2,a=document.createElement("canvas");a.width=r*f,a.height=l*f;let u=a.getContext("2d");u.setTransform(f,0,0,f,0,0),u.fillStyle=e.background.color,u.fillRect(0,0,r,l);let M=15*(r/1200);u.font=`${M}px ${Zt}`,u.fillStyle=e.background.textureColor,u.globalAlpha=e.background.textureOpacity;let g=M*Pt,p=M*1.13;for(let d=0;d<l+p;d+=p)for(let m=0;m<r+g;m+=g)u.fillText("\u2591",m,d+p);u.globalAlpha=1,u.textBaseline="top";for(let d of n){let m=parseFloat(d.style.left),c=parseFloat(d.style.top),h=parseFloat(d.style.fontSize);u.font=`${h}px ${Zt}`,u.fillStyle=d.style.color,u.fillText(d.textContent,m,c)}a.toBlob(d=>{let m=URL.createObjectURL(d),c=document.createElement("a");c.href=m,c.download=`fold-${t||"edit"}.png`,c.click(),URL.revokeObjectURL(m)},"image/png")}function Wo(){he();let{charElements:t,textBuffer:e,originalPositions:n}=A;for(let i=0;i<t.length;i++){let o=t[i],r=n.get(i);r&&(o.style.left=r.x+"px",o.style.top=r.y+"px",e[i]&&(e[i].char=r.editChar),o.textContent=r.char)}}function _o(t){document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="s"){e.preventDefault(),No(t);return}A.isEditing||e.key==="Escape"&&(e.preventDefault(),Wo())})}function tn(t,e,n){let{bgCanvas:i,charLayer:o}=A,r=mo(t,e,n);A.charData=r,Eo(i,r.background,e,n),vo(o,r.characters)}async function Ge(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,n=typeof window<"u"&&window.LESS_SEED;if(n&&!t&&(t=xo(n)),t&&e===void 0){let o=O(t+9999);e=Math.floor(1+o()*500)}let i=typeof window<"u"&&window.FONT_DATA_URI||en;if(t&&e!==void 0){await go(i),bo(),Co();let o=_e(t,1200,1697,0,e);le={seed:t,foldCount:e,params:o};let l=A.container.getBoundingClientRect();tn(le,l.width,l.height),A.loading&&(A.loading.style.display="none"),To(A.charLayer),_o(t),typeof window<"u"&&(window.RENDER_COMPLETE=!0),window.addEventListener("resize",yo(()=>{if(le){let f=A.container.getBoundingClientRect();tn(le,f.width,f.height)}},150))}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0||window.LESS_SEED)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Ge()):Ge());})();
</script></body></html>