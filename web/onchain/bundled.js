(()=>{var St="FoldMono",le="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",je='"Courier New", Courier, monospace',ce=`"${St}", ${je}`,Yt=[0,51,102,153,204,255];function fe(t,e,n){return"#"+[t,e,n].map(s=>s.toString(16).padStart(2,"0")).join("").toUpperCase()}function Kt(t,e,n){let s=t/255,o=e/255,r=n/255;return(.2126*s+.7152*o+.0722*r)*100}function ue(t,e,n){let s=t-n;return Math.abs(s)<30&&Math.abs(t-e)<30&&Math.abs(e-n)<30?"neutral":s>0?"warm":"cool"}function he(t,e,n){let s=Math.max(t,e,n),o=Math.min(t,e,n),r=s-o;return r<20?"gray":r<80?"muted":r<160?"chromatic":"vivid"}function Be(){let t=[];for(let e=0;e<6;e++)for(let n=0;n<6;n++)for(let s=0;s<6;s++){let o=Yt[e],r=Yt[n],i=Yt[s];t.push({hex:fe(o,r,i),r:o,g:r,b:i,cubePos:{ri:e,gi:n,bi:s},luminance:Kt(o,r,i),temperature:ue(o,r,i),saturation:he(o,r,i),type:"websafe"})}return t}var Ye=[{hex:"#000000",name:"black"},{hex:"#0000AA",name:"blue"},{hex:"#00AA00",name:"green"},{hex:"#00AAAA",name:"cyan"},{hex:"#AA0000",name:"red"},{hex:"#AA00AA",name:"magenta"},{hex:"#AA5500",name:"brown"},{hex:"#AAAAAA",name:"lightGray"},{hex:"#555555",name:"darkGray"},{hex:"#5555FF",name:"lightBlue"},{hex:"#55FF55",name:"lightGreen"},{hex:"#55FFFF",name:"lightCyan"},{hex:"#FF5555",name:"lightRed"},{hex:"#FF55FF",name:"lightMagenta"},{hex:"#FFFF55",name:"yellow"},{hex:"#FFFFFF",name:"white"}];function Xe(){return Ye.map(t=>{let e=parseInt(t.hex.slice(1,3),16),n=parseInt(t.hex.slice(3,5),16),s=parseInt(t.hex.slice(5,7),16);return{hex:t.hex,r:e,g:n,b:s,cubePos:null,luminance:Kt(e,n,s),temperature:ue(e,n,s),saturation:he(e,n,s),type:"cga",name:t.name}})}function Ue(){let t=[];for(let e=0;e<24;e++){let n=Math.round(e/23*255);t.push({hex:fe(n,n,n),r:n,g:n,b:n,cubePos:null,luminance:Kt(n,n,n),temperature:"neutral",saturation:"gray",type:"grayscale",grayIndex:e})}return t}var w=[...Be(),...Xe(),...Ue()],gt={dark:w.filter(t=>t.luminance<30),midDark:w.filter(t=>t.luminance>=20&&t.luminance<50),mid:w.filter(t=>t.luminance>=40&&t.luminance<70),midLight:w.filter(t=>t.luminance>=55&&t.luminance<85),light:w.filter(t=>t.luminance>=70)},Ut={warm:w.filter(t=>t.temperature==="warm"),cool:w.filter(t=>t.temperature==="cool"),neutral:w.filter(t=>t.temperature==="neutral")},ne={gray:w.filter(t=>t.saturation==="gray"),muted:w.filter(t=>t.saturation==="muted"),chromatic:w.filter(t=>t.saturation==="chromatic"),vivid:w.filter(t=>t.saturation==="vivid")},Rn=w.filter(t=>t.saturation==="vivid"||t.type==="cga"&&t.saturation!=="gray");function Tt(t,e){let n=t.r-e.r,s=t.g-e.g,o=t.b-e.b;return Math.sqrt(n*n*.3+s*s*.59+o*o*.11)}function Mt(t,e){if(!t.cubePos)return[];let{ri:n,gi:s,bi:o}=t.cubePos;return w.filter(r=>{if(!r.cubePos)return!1;let i=Math.abs(r.cubePos.ri-n)+Math.abs(r.cubePos.gi-s)+Math.abs(r.cubePos.bi-o);return i>0&&i<=e})}function $e(t){if(!t.cubePos){let h=t.temperature==="warm"?"cool":t.temperature==="cool"?"warm":"neutral";return Ut[h]}let{ri:e,gi:n,bi:s}=t.cubePos,o=e<3?4:1,r=n<3?4:1,i=s<3?4:1;return w.filter(h=>h.cubePos?Math.abs(h.cubePos.ri-o)<=1&&Math.abs(h.cubePos.gi-r)<=1&&Math.abs(h.cubePos.bi-i)<=1:!1)}function Je(t,e,n){if(!t.cubePos||!e.cubePos)return de(t,e,n);let s=[];for(let o=0;o<n;o++){let r=o/(n-1),i=Math.round(t.cubePos.ri+(e.cubePos.ri-t.cubePos.ri)*r),h=Math.round(t.cubePos.gi+(e.cubePos.gi-t.cubePos.gi)*r),u=Math.round(t.cubePos.bi+(e.cubePos.bi-t.cubePos.bi)*r),a=w.find(c=>c.cubePos&&c.cubePos.ri===i&&c.cubePos.gi===h&&c.cubePos.bi===u);a&&s.push(a)}return s}function de(t,e,n){let s=t.luminance,o=e.luminance,r=[];for(let i=0;i<n;i++){let h=i/(n-1),u=s+(o-s)*h,a=w.filter(M=>M.temperature===t.temperature||M.temperature==="neutral"),c=a[0],b=Math.abs(c.luminance-u);for(let M of a){let p=Math.abs(M.luminance-u);p<b&&(b=p,c=M)}r.push(c)}return r}function Z(t,e,n=4.5){let s=t.luminance/100,o=e.luminance/100,r=Math.max(s,o)+.05,i=Math.min(s,o)+.05;return r/i>=n}function O(t,e){return e[Math.floor(t()*e.length)]}function Rt(t,e,n){e/=100,n/=100;let s=e*Math.min(n,1-n),o=r=>{let i=(r+t/30)%12,h=n-s*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*h).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}`}function bt(t){let e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255,o=Math.max(e,n,s),r=Math.min(e,n,s),i,h,u=(o+r)/2;if(o===r)i=h=0;else{let a=o-r;switch(h=u>.5?a/(2-o-r):a/(o+r),o){case e:i=((n-s)/a+(n<s?6:0))/6;break;case n:i=((s-e)/a+2)/6;break;case s:i=((e-n)/a+4)/6;break}}return{h:i*360,s:h*100,l:u*100}}function oe(t,e=10){return w.filter(n=>n.hex!==t.hex&&Math.abs(n.luminance-t.luminance)<e&&(n.temperature!==t.temperature||n.saturation!==t.saturation))}function Ke(t,e){let n=Math.round((t.r+e.r)/2),s=Math.round((t.g+e.g)/2),o=Math.round((t.b+e.b)/2),r=(t.luminance+e.luminance)/2,i=w[0],h=1/0;for(let u of w){let a=Math.sqrt(Math.pow(u.r-n,2)+Math.pow(u.g-s,2)+Math.pow(u.b-o,2)),c=Math.abs(u.luminance-r)*2,b=a+c;b<h&&(h=b,i=u)}return i}function se(t,e,n){let s=[];switch(e){case"value":{let o=t.luminance>50?-40:40,r=Math.max(5,Math.min(95,t.luminance+o));s=w.filter(i=>i.hex!==t.hex&&Math.abs(i.luminance-r)<20&&(i.temperature===t.temperature||i.temperature==="neutral"||t.temperature==="neutral")),s.sort((i,h)=>{let u=i.temperature===t.temperature?0:1,a=h.temperature===t.temperature?0:1;return u!==a?u-a:Math.abs(i.luminance-r)-Math.abs(h.luminance-r)});break}case"temperature":{let o=t.temperature==="warm"?"cool":t.temperature==="cool"||n()<.5?"warm":"cool";s=w.filter(r=>r.hex!==t.hex&&r.temperature===o&&Math.abs(r.luminance-t.luminance)<25),s.sort((r,i)=>Math.abs(r.luminance-t.luminance)-Math.abs(i.luminance-t.luminance));break}case"saturation":{let o=["gray","muted","chromatic","vivid"],r=o.indexOf(t.saturation),i=r<=1?["chromatic","vivid"]:["muted","gray"];s=w.filter(h=>h.hex!==t.hex&&i.includes(h.saturation)&&Math.abs(h.luminance-t.luminance)<30&&(h.temperature===t.temperature||h.temperature==="neutral")),s.sort((h,u)=>{let a=o.indexOf(h.saturation),c=o.indexOf(u.saturation);return Math.abs(c-r)-Math.abs(a-r)});break}case"complement":{s=$e(t),s.sort((o,r)=>Math.abs(r.luminance-t.luminance)-Math.abs(o.luminance-t.luminance));break}case"neighbor":{t.cubePos?(s=Mt(t,1),s.length<3&&(s=Mt(t,2))):s=w.filter(o=>o.hex!==t.hex&&Tt(t,o)<60&&Tt(t,o)>20),s.sort((o,r)=>Tt(t,o)-Tt(t,r));break}}return s}function ze(t){let e=v(t);if(e()<.03)switch(Math.floor(e()*5)){case 0:{let x=e()<.5?gt.midLight:gt.midDark,f=[O(e,x),O(e,x),O(e,x)];return{bg:f[0].hex,text:f[1].hex,accent:f[2].hex,strategy:"glitch/washed"}}case 1:{let x=ne.vivid.filter(A=>A.temperature==="warm"),f=ne.vivid.filter(A=>A.temperature==="cool");return{bg:O(e,x).hex,text:O(e,f).hex,accent:O(e,e()<.5?x:f).hex,strategy:"glitch/acid"}}case 2:{let x=w.filter(A=>A.luminance<15),f=w.filter(A=>A.luminance>=10&&A.luminance<25);return{bg:O(e,x).hex,text:O(e,f).hex,accent:O(e,f).hex,strategy:"glitch/void"}}case 3:{let x=w.filter(A=>A.luminance>85),f=w.filter(A=>A.luminance>=70&&A.luminance<90);return{bg:O(e,x).hex,text:O(e,f).hex,accent:O(e,f).hex,strategy:"glitch/bleach"}}case 4:default:{let x=w.filter(f=>f.type==="cga");return{bg:O(e,x).hex,text:O(e,x).hex,accent:O(e,x).hex,strategy:"glitch/corrupt"}}}let s=w.filter(m=>m.saturation!=="gray"&&m.type==="websafe"),o=O(e,s),r=e(),i;r<.4?i="light":r<.8?i="dark":i="mid";let h=e(),u;h<.3?u="value":h<.5?u="temperature":h<.65?u="saturation":h<.8?u="complement":u="neighbor";let a;i==="light"?a=gt.light.filter(m=>m.temperature===o.temperature||m.temperature==="neutral"||m.saturation==="gray"):i==="dark"?a=gt.dark.filter(m=>m.temperature===o.temperature||m.temperature==="neutral"||m.saturation==="gray"):a=w.filter(m=>m.luminance>=35&&m.luminance<=65&&(m.saturation==="muted"||m.saturation==="gray")&&(m.temperature===o.temperature||m.temperature==="neutral")),a.length===0&&(a=i==="light"?gt.light:gt.dark);let c=O(e,a),b=se(o,u,e);b=b.filter(m=>Z(c,m,4.5)),b.length===0&&(b=se(o,"value",e).filter(m=>Z(c,m,4.5))),b.length===0&&(b=w.filter(m=>Z(c,m,4.5)));let M=b.length>3?b[Math.floor(e()*Math.min(3,b.length))]:b[0]||o,p=e()<.2,y;if(p){let m=oe(c,15),x=oe(M,15),f=[...m,...x].filter(C=>Z(c,C,3)&&C.hex!==M.hex&&C.saturation!=="gray"),A=new Set;if(f=f.filter(C=>A.has(C.hex)?!1:(A.add(C.hex),!0)),f.length>0){let C=f.filter($=>$.saturation==="vivid"||$.saturation==="chromatic");y=O(e,C.length>0?C:f)}else{let C=Ke(c,M);Z(c,C,2.5)?y=C:y=M}}else y=M;return{bg:c.hex,text:M.hex,accent:y.hex,strategy:`${i}/${u}${p?"+accent":""}`}}function re(t,e,n){let s=[];for(let o=e;o<=n;o++)t%o===0&&s.push(o);return s}function Ve(t,e,n,s){let o=1200-n*2-100,r=1500-n*2-50*2,i=re(o,20,600),h=re(r,20,600);i.length===0&&i.push(8),h.length===0&&h.push(12);let u=v(s+9999),a=[];for(let M of i)for(let p of h)Math.max(M/p,p/M)<=3&&a.push({w:M,h:p});if(a.length===0)return{cellW:8,cellH:12};a.sort((M,p)=>M.w*M.h-p.w*p.h);let c=u(),b;if(c<.03){let M=Math.max(1,Math.ceil(a.length*.1)),p=Math.floor(u()*M);b=a[p]}else if(c<.1){let M=Math.floor(a.length*.1),p=Math.floor(a.length*.25),y=M+Math.floor(u()*Math.max(1,p-M));b=a[Math.min(y,a.length-1)]}else if(c<.45){let M=Math.floor(a.length*.25),p=Math.floor(a.length*.75),y=M+Math.floor(u()*(p-M));b=a[Math.min(y,a.length-1)]}else if(c<.95){let M=Math.floor(a.length*.75),p=Math.floor(a.length*.9),y=M+Math.floor(u()*Math.max(1,p-M));b=a[Math.min(y,a.length-1)]}else{let M=Math.floor(a.length*.9),p=M+Math.floor(u()*(a.length-M));b=a[Math.min(p,a.length-1)]}return{cellW:b.w,cellH:b.h}}function qe(t){let n=v(t+5555)();return n<.35?"normal":n<.4?"binary":n<.65?"inverted":n<.825?"sparse":"dense"}function zt(t){let e=v(t+7777),n=e();if(n<.25){let s=.2+e()*.2;return{min:s,max:s+.1+e()*.2}}else if(n<.5){let s=.6+e()*.2;return{min:s,max:s+.1+e()*.1}}else return n<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function Qe(t){let e=v(t+11111);if(!(e()>=.5))return{hasOverlap:!1,amount:"none"};let s=e(),o;return s<.2?o="5%":s<.4?o="25%":s<.6?o="50%":s<.8?o="75%":o="95%",{hasOverlap:!0,amount:o}}function pe(t){let e=v(t+2222);return Math.floor(4+e()*66)}function ge(t){let e=v(t+6666),n=e();return n<.16?{type:"horizontal",jitter:3+e()*12}:n<.32?{type:"vertical",jitter:3+e()*12}:n<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:n<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:n<.68?{type:"grid",jitter:3+e()*10}:n<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function Xt(t){let e=t.toUpperCase();return w.find(n=>n.hex===e)||w[0]}function Ze(t,e,n){let s=v(t+3333),o=Xt(e),r=Xt(n),i=o.luminance>50,h=s();if(h<.45){if(o.cubePos&&r.cubePos){let a=Je(o,r,6);if(a.length>=4)return[a[0].hex,a[Math.floor(a.length*.33)].hex,a[Math.floor(a.length*.66)].hex,a[a.length-1].hex]}let u=de(o,r,6);return[u[0].hex,u[Math.floor(u.length*.33)].hex,u[Math.floor(u.length*.66)].hex,u[u.length-1].hex]}else if(h<.75){let u=Mt(r,1),a=Mt(r,2),c=Mt(r,3),b=(f,A)=>i?A.luminance-f.luminance:f.luminance-A.luminance,M=u.filter(f=>Z(o,f,2)).sort(b),p=a.filter(f=>Z(o,f,3)).sort(b),y=c.filter(f=>Z(o,f,4)).sort(b),m=[r.hex];if(M.length>0?m.push(O(s,M).hex):m.push(r.hex),p.length>0){let f=p.filter(A=>!m.includes(A.hex));m.push(f.length>0?O(s,f).hex:p[0].hex)}else m.push(m[1]);if(y.length>0){let f=y.filter(A=>!m.includes(A.hex));m.push(f.length>0?O(s,f).hex:y[0].hex)}else m.push(r.hex);let x=m.map(f=>Xt(f));return x.sort((f,A)=>i?A.luminance-f.luminance:f.luminance-A.luminance),x.map(f=>f.hex)}else{let u=r.temperature,a=u==="warm"?"cool":"warm",c=Ut[u].filter(f=>Z(o,f,2.5)),b=Ut[a].filter(f=>Z(o,f,2.5)),M=(f,A)=>i?A.luminance-f.luminance:f.luminance-A.luminance;c.sort(M),b.sort(M);let p=[];p.push(c.length>0?c[0].hex:r.hex);let y=c.filter(f=>!p.includes(f.hex));p.push(y.length>0?y[Math.floor(y.length*.3)].hex:r.hex);let m=b.filter(f=>!p.includes(f.hex));p.push(m.length>0?m[Math.floor(m.length*.5)].hex:r.hex);let x=[...c,...b].filter(f=>!p.includes(f.hex));return x.sort(M),p.push(x.length>0?x[x.length-1].hex:r.hex),p}}function tn(t){return v(t+4444)()<.25}function en(t){return v(t+9191)()<.008}function nn(t){let e=v(t+5555),n=.1+e()*.8,s=0,o=e()<.4,r=o?e()*180:null,i=o?.2+e()*.6:0,h=.3+e()*1.4;return{absorbency:n,intersectionThreshold:s,angleAffinity:r,affinityStrength:i,ceilingMultiplier:h}}function on(t){let e=t.absorbency<.35?"Resistant":t.absorbency<.65?"Standard":"Absorbent",n=t.intersectionThreshold<.15?"Fine":t.intersectionThreshold<.35?"Medium":"Coarse",s=t.angleAffinity!==null?"Grain":"Uniform";return`${e}/${n}/${s}`}function sn(t,e,n){return t}var ae=[1/64,1/32,1/16,1/8,1/4,1/2,1,2];function rn(t,e,n,s,o){let r=v(t+12345),i=r()<.4,h=!1,u=!1;if(i){let T=r();T<.33?h=!0:(T<.66||(h=!0),u=!0)}let a=()=>{let T=ae.slice(0,7);return r()<.25&&T.push(ae[7]),T},c=e,b=n,M=1,p=0,y=1/0,m=h?a():[0];for(let T of m){let L=c*T,et=c+L,W=Math.max(1,Math.floor((s+L)/et));if(W===1){let I=Math.min(c,s),R=Math.abs(s-I);R<y&&(y=R,M=1,p=0,c=I)}else{let I=W*c+(W-1)*L;if(I<=s){let R=Math.abs(s-I);R<y&&(y=R,M=W,p=L)}}}M===1&&c<s&&(c=s,p=0);let x=1,f=0,A=1/0,C=u?a():[0];for(let T of C){let L=b*T,et=b+L,W=Math.max(1,Math.floor((o+L)/et));if(W===1){let I=Math.min(b,o),R=Math.abs(o-I);R<A&&(A=R,x=1,f=0,b=I)}else{let I=W*b+(W-1)*L;if(I<=o){let R=Math.abs(o-I);R<A&&(A=R,x=W,f=L)}}}x===1&&b<o&&(b=o,f=0);let $=M,J=x,Q=p,N=f,K=$*c+($>1?($-1)*Q:0),l=J*b+(J>1?(J-1)*N:0),z=s-K,P=o-l;return{cols:$,rows:J,cellWidth:c,cellHeight:b,colGap:Q,rowGap:N,strideX:c+Q,strideY:b+N,gridOffsetX:z>0?z/2:0,gridOffsetY:P>0?P/2:0,actualGridWidth:K,actualGridHeight:l}}function an(t){let e=Object.values(t).filter(h=>h>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((h,u)=>h-u);let n=(h,u)=>{let a=Math.floor(h.length*u);return h[Math.min(a,h.length-1)]},s=n(e,.7),o=n(e,.94),r=n(e,.94)+1,i=n(e,.985);return{t1:Math.max(.01,s),t2:Math.max(s+.01,o),t3:Math.max(o+.01,r),tExtreme:Math.max(r+.01,i)}}function xt(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}function v(t){let e=Math.abs(t)||1;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}var j={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>j.len(j.sub(t,e)),norm:t=>{let e=j.len(t);return e>1e-4?j.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,n)=>({x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>j.dist(t,e)<.5};function Vt(t,e,n,s){let o=j.sub(e,t),r=j.sub(s,n),i=o.x*r.y-o.y*r.x;if(Math.abs(i)<1e-4)return null;let h=j.sub(n,t),u=(h.x*r.y-h.y*r.x)/i,a=(h.x*o.y-h.y*o.x)/i;return u>=.001&&u<=.999&&a>=.001&&a<=.999?{point:j.add(t,j.scale(o,u)),t:u,u:a}:null}function ln(t,e){let n=t.reduce((o,r)=>o+r,0);if(n<=0)return 0;let s=e()*n;for(let o=0;o<t.length;o++)if(s-=t[o],s<=0)return o;return t.length-1}var cn=0,fn=1,un=2,hn=3;function tt(t,e,n,s){switch(t){case cn:return{x:e*n,y:0};case fn:return{x:n,y:e*s};case un:return{x:(1-e)*n,y:s};case hn:return{x:0,y:(1-e)*s};default:return{x:e*n,y:0}}}function xe(t,e,n){switch(t){case 0:return{x:0,y:0};case 1:return{x:e,y:0};case 2:return{x:e,y:n};case 3:return{x:0,y:n};default:return{x:0,y:0}}}function me(t,e){return{x:t.p1.x+(t.p2.x-t.p1.x)*e,y:t.p1.y+(t.p2.y-t.p1.y)*e}}function $t(t,e){let n=e.x-t.x,s=e.y-t.y,o=Math.atan2(s,n)*180/Math.PI;return o<0&&(o+=180),o>=180&&(o-=180),o}function dn(t,e,n,s,o,r){let i=Math.max(.2,1-t*.015);if(r()<i||e.length===0&&n.length===0)if(r()<.15){let a=Math.floor(r()*4);return{point:xe(a,s,o),type:"corner",corner:a}}else{let a=Math.floor(r()*4),c=.05+r()*.9;return{point:tt(a,c,s,o),type:"edge",edge:a,t:c}}else if(n.length>0&&r()<.35){let a=n[Math.floor(r()*n.length)];return{point:{x:a.x,y:a.y},type:"intersection",intersectionIndex:n.indexOf(a)}}else if(e.length>0){let a=e[Math.floor(r()*e.length)],c=.1+r()*.8;return{point:me(a,c),type:"crease",creaseIndex:e.indexOf(a),t:c}}else{let a=Math.floor(r()*4),c=.05+r()*.9;return{point:tt(a,c,s,o),type:"edge",edge:a,t:c}}}function pn(t,e,n,s,o,r,i,h){let u=Math.min(o,r)*.15,a=[];if(t.type==="edge"){let p=(t.edge+2)%4,y=(t.edge+1)%4,m=(t.edge+3)%4,x=e<3?3:1.5;for(let A=0;A<3;A++){let C=.1+i()*.8;a.push({point:tt(p,C,o,r),type:"edge",edge:p,weight:x})}let f=1;for(let A=0;A<2;A++){let C=.1+i()*.8;a.push({point:tt(y,C,o,r),type:"edge",edge:y,weight:f}),a.push({point:tt(m,C,o,r),type:"edge",edge:m,weight:f})}}else if(t.type==="corner"){let p=(t.corner+2)%4;a.push({point:xe(p,o,r),type:"corner",weight:2});for(let y=0;y<4;y++)if(!(y===t.corner||y===(t.corner+3)%4)){let x=.2+i()*.6;a.push({point:tt(y,x,o,r),type:"edge",edge:y,weight:1.5})}}else{for(let p=0;p<4;p++){let y=.1+i()*.8;a.push({point:tt(p,y,o,r),type:"edge",edge:p,weight:1})}if(n.length>1&&e>3)for(let p=0;p<Math.min(3,n.length);p++){let y=Math.floor(i()*n.length),m=n[y];if(t.type==="crease"&&t.creaseIndex===y)continue;let x=.15+i()*.7;a.push({point:me(m,x),type:"crease",creaseIndex:y,weight:.6})}}if(n.length>0&&h)for(let p of a){let y=$t(t.point,p.point);for(let m of n){let x=$t(m.p1,m.p2),f=Math.abs(y-x);f>90&&(f=180-f),h.parallel>0&&f<15&&(p.weight*=1+h.parallel),h.perpendicular>0&&f>75&&(p.weight*=1+h.perpendicular)}}let c=a.filter(p=>j.dist(t.point,p.point)>=u);if(c.length===0){for(let y=0;y<4;y++){let x=tt(y,.5,o,r);if(j.dist(t.point,x)>=u)return{point:x,type:"edge",edge:y}}let p=t.type==="edge"?(t.edge+2)%4:0;return{point:tt(p,.5,o,r),type:"edge",edge:p}}let b=c.map(p=>p.weight),M=ln(b,i);return c[M]}function gn(t){let e=[];for(let n=0;n<t.length;n++)for(let s=n+1;s<t.length;s++){let o=Vt(t[n].p1,t[n].p2,t[s].p1,t[s].p2);o&&e.push({x:o.point.x,y:o.point.y,crease1:n,crease2:s})}return e}function ye(t,e,n,s,o={min:0,max:1},r=null,i=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let h=r||ge(s),u=pe(s),a=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],c=[],b=null,M=null;if(!n||n<=0)return{creases:[],finalShape:a,maxFolds:u,firstFoldTarget:null,lastFoldTarget:null};let p=v(s),y=v(s+8888),m=v(s+6666),x=i||{absorbency:1,intersectionThreshold:0,angleAffinity:null,affinityStrength:0,ceilingMultiplier:1},f=[],A=v(s+1111);for(let N=0;N<u;N++)f[N]=.001+A()*.25;let C=v(s+2222),$={parallel:C()*.8,perpendicular:C()*.8},J=Math.max(t,e)*.05,Q=[];for(let N=0;N<n;N++){let K=N%u,l=Math.floor(N/u);if(K===0&&l>0)for(let Y of c)Y.reductionMultiplier!==void 0&&(Y.weight=Math.max(.01,Y.weight*Y.reductionMultiplier));N%5===0&&c.length>1&&(Q=gn(c));let z=dn(N,c,Q,t,e,p),P=pn(z,N,c,Q,t,e,p,$),T=z.point,L=P.point;if(j.dist(T,L)<Math.min(t,e)*.1)continue;let W=m()<x.absorbency,I=o.min+y()*(o.max-o.min);if(x.angleAffinity!==null&&x.affinityStrength>0){let Y=$t(T,L),X=Math.abs(Y-x.angleAffinity);X>90&&(X=180-X);let nt=1-X/90*x.affinityStrength;I*=nt}if(W&&I>.01&&(c.push({p1:j.copy(T),p2:j.copy(L),depth:c.length,weight:I,cyclePosition:K,reductionMultiplier:f[K],anchorType:z.type,terminusType:P.type}),c.length>1)){let Y=c[c.length-1];for(let X=0;X<c.length-1;X++){let nt=Vt(Y.p1,Y.p2,c[X].p1,c[X].p2);nt&&Q.push({x:nt.point.x,y:nt.point.y,crease1:X,crease2:c.length-1})}}let R=j.mid(T,L),it={x:Math.max(J,Math.min(t-J,R.x)),y:Math.max(J,Math.min(e-J,R.y))};N===0&&b===null&&(b=it),M=it}return{creases:c,finalShape:a,maxFolds:u,firstFoldTarget:b,lastFoldTarget:M}}function xn(t){let e=[];for(let n=0;n<t.length;n++)for(let s=n+1;s<t.length;s++){let o=Vt(t[n].p1,t[n].p2,t[s].p1,t[s].p2);if(o){let r=t[n].weight||1,i=t[s].weight||1;e.push({x:o.point.x,y:o.point.y,depth1:t[n].depth,depth2:t[s].depth,gap:Math.abs(t[s].depth-t[n].depth),weight:r+i})}}return e}function mn(t,e,n,s,o,r=null,i=null){let h=xn(t),u=i||{intersectionThreshold:0,ceilingMultiplier:1},a=h.filter(x=>x.weight>=u.intersectionThreshold),c={},b={},M={};for(let x of a){let f=Math.floor(x.x/s),A=Math.floor(x.y/o);if(f>=0&&f<e&&A>=0&&A<n){let C=`${f},${A}`;c[C]=(c[C]||0)+x.weight,b[C]=Math.max(b[C]||0,x.gap),M[C]=(M[C]||0)+1}}let y=e*n*.5*u.ceilingMultiplier,m=Object.values(c).reduce((x,f)=>x+f,0);if(m>y&&m>0){let x=y/m,f=x+(1-x)*.3;for(let A of Object.keys(c))c[A]*=f}return{activeCreases:t,intersections:a,cellWeights:c,cellMaxGap:b,cellIntersectionCounts:M,destroyed:0,maxFolds:r}}function be({folds:t,seed:e,outputWidth:n,outputHeight:s,bgColor:o,textColor:r,accentColor:i,cellWidth:h,cellHeight:u,renderMode:a,multiColor:c,levelColors:b,foldStrategy:M=null,paperProperties:p=null,padding:y=0,showCreases:m=!1,showPaperShape:x=!1,showFoldTargets:f=!1,showIntersections:A=!1,showGrid:C=!1,showHitCounts:$=!1,showCellOutlines:J=!1,showCreaseLines:Q=!1,fontFamily:N=ce}){fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2378",message:"renderToCanvas entry",data:{outputWidth:n,outputHeight:s,padding:y,DRAWING_MARGIN:50,REFERENCE_WIDTH:1200,REFERENCE_HEIGHT:1500},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A,B,C"})}).catch(()=>{});let K=document.createElement("canvas"),l=K.getContext("2d"),z=2;K.width=n*z,K.height=s*z,l.setTransform(z,0,0,z,0,0),l.fillStyle=o,l.fillRect(0,0,n,s);let P=n/1200,T=s/1500,L=1200-y*2-50*2,et=1500-y*2-50*2;fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2420",message:"inner dimensions calculated",data:{refInnerWidth:L,refInnerHeight:et,scaleX:P,scaleY:T},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A,B"})}).catch(()=>{});let W=rn(e,h,u,L,et),{cols:I,rows:R,strideX:it,strideY:Y,gridOffsetX:X,gridOffsetY:nt}=W,Me=W.cellWidth,Ae=W.cellHeight,Ft=L*P,Ot=et*T,_=(y+50+X)*P,H=(y+50+nt)*T,lt=Me*P,mt=Ae*T,ct=it*P,yt=Y*T;fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2434",message:"drawing dimensions calculated",data:{drawWidth:Ft,drawHeight:Ot,offsetX:_,offsetY:H,cols:I,rows:R,gridOffsetX:X,gridOffsetY:nt},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C,D,E"})}).catch(()=>{});let Ee=zt(e),we=sn(p,I,R),Ce=W.actualGridWidth,Ie=W.actualGridHeight,{creases:Te,finalShape:Re,maxFolds:ve,firstFoldTarget:ft,lastFoldTarget:ut}=ye(Ce,Ie,t,e,Ee,M,we),Se=Te.map(d=>({...d,p1:{x:d.p1.x*P,y:d.p1.y*T},p2:{x:d.p2.x*P,y:d.p2.y*T}})),Gt=null;if(ft){let d=Math.max(0,Math.min(I-1,Math.floor(ft.x/it))),g=Math.max(0,Math.min(R-1,Math.floor(ft.y/Y)));Gt=`${d},${g}`}let Pt=null;if(ut){let d=Math.max(0,Math.min(I-1,Math.floor(ut.x/it))),g=Math.max(0,Math.min(R-1,Math.floor(ut.y/Y)));Pt=`${d},${g}`}let{activeCreases:Dt,intersections:Nt,cellWeights:Lt,cellMaxGap:_t}=mn(Se,I,R,ct,yt,ve,p),st=new Set;if(Object.keys(_t).length>0){let d=Math.max(...Object.values(_t));for(let[g,E]of Object.entries(_t))E===d&&st.add(g)}let kt=mt-2*T,wn=kt>350?"large":kt>100?"medium":"small";l.font=`${kt}px ${N}`,l.textBaseline="top";let V=[" ","\u2591","\u2592","\u2593"],Qt={};for(let d of V){let g=l.measureText(d);Qt[d]={width:g.width}}let ht=an(Lt),At=v(e+11111),Wt=At()>=.5,Fe=(()=>{if(!Wt)return 1;let d=At();return d<.2?.95:d<.4?.75:d<.6?.5:d<.8?.25:.05})(),Oe=Wt?Math.floor(At()*5):0,dt=[.95,.75,.5,.25,.05],Zt=dt.indexOf(Fe),Et=Math.floor(At()*3)+1,Ge=(d,g)=>{if(!Wt)return 1;let E=Zt===-1?0:Zt;switch(Oe){case 1:E=(E+Math.floor(d/2)*Et)%dt.length;break;case 2:E=(E+Math.floor(g/2)*Et)%dt.length;break;case 3:E=(E+(d+g)%2*Et)%dt.length;break;case 4:E=(E+Math.floor((d+g)/2)*Et)%dt.length;break;default:break}return dt[E]},ot=(d,g)=>c&&b?b[Math.min(d,3)]:r,wt=v(e+22222),Ht=wt()<.1,Pe=Math.round(2+wt()*2)*P,De=Math.round(1+wt()*2)*T,Ne=Ht?.4+wt()*.3:0,Le=(d,g)=>{let E=v(e+22222+d*1e3+g),q=Math.floor(E()*3);return{x:q!==1?Pe:0,y:q!==0?De:0}},_e=Ht?(()=>{let d=bt(r),g;return i&&i!==r?g=bt(i):g={h:(d.h+180)%360,s:Math.min(100,d.s+20),l:d.l},g.l<=d.l&&(g.l=Math.min(95,d.l+25)),Rt(g.h,g.s,g.l)})():null,rt=n,te=s;if(fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2653",message:"boundary calculations",data:{drawAreaRight:rt,drawAreaBottom:te,outputWidth:n,outputHeight:s,offsetX:_,offsetY:H,drawWidth:Ft,drawHeight:Ot},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"C"})}).catch(()=>{}),$){let d=Math.floor(Math.min(lt*.45,mt*.7));l.font=`bold ${d}px monospace`,l.textAlign="center",l.textBaseline="middle",l.fillStyle=r;for(let g=0;g<R;g++)for(let E=0;E<I;E++){let q=Math.round(_+E*ct+lt/2),S=Math.round(H+g*yt+mt/2),G=`${E},${g}`,B=Lt[G]||0;B>0&&l.fillText(Math.round(B).toString(),q,S)}l.textAlign="left",l.textBaseline="top"}else for(let d=0;d<R;d++)for(let g=0;g<I;g++){let E=Math.round(_+g*ct),q=Math.round(H+d*yt),S=`${g},${d}`,G=Lt[S]||0;d===R-1&&g===I-1&&fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2699",message:"last cell position",data:{lastRow:d,lastCol:g,lastX:E,lastY:q,cellEndX:E+lt,cellEndY:q+mt,outputWidth:n,outputHeight:s,drawAreaRight:rt,drawAreaBottom:te},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C,D"})}).catch(()=>{});let B=null,k=r,F=-1,Ct=!1;if(Gt===S)F=G>0?xt(G,ht):2,B=V[Math.max(F,2)],k=i;else if(a==="normal")if(F=xt(G,ht),B=V[F],F===0&&(B=V[1],Ct=!0),k=ot(F,S),G>=1.5){let pt=G-1.5,U=30+Math.min(pt*300,150),D=bt(r);k=Rt((D.h+U+360)%360,Math.min(100,D.s+20),Math.min(85,D.l+10))}else st.has(S)&&G>0?k=i:Pt===S&&(k=r);else if(a==="binary")G===0?(B=V[0],F=0,k=ot(0,S)):(B=V[3],F=3,k=ot(3,S),st.has(S)&&(k=i));else if(a==="inverted")if(F=3-xt(G,ht),B=V[F],k=ot(F,S),G>=1.5){let pt=G-1.5,U=30+Math.min(pt*300,150),D=bt(r);k=Rt((D.h+U+360)%360,Math.min(100,D.s+20),Math.min(85,D.l+10))}else st.has(S)&&G>0&&(k=i);else if(a==="sparse")F=xt(G,ht),F===1&&(B=V[1],k=ot(1,S),st.has(S)&&(k=i));else if(a==="dense")if(F=xt(G,ht),F>=2)if(B=V[F],k=ot(F,S),G>=1.5){let pt=G-1.5,U=30+Math.min(pt*300,150),D=bt(r);k=Rt((D.h+U+360)%360,Math.min(100,D.s+20),Math.min(85,D.l+10))}else st.has(S)&&(k=i);else G===0&&(B=V[0],F=0,k=ot(0,S));if(B){if(Gt===S||Pt===S)l.fillStyle=k;else{let at=ot(xt(G,ht),S);l.fillStyle=st.has(S)&&G>0?i:at}Ct&&(l.globalAlpha=.1,l.fillStyle=r);let pt=l.measureText(B).width,U=E+lt;g===I-1&&fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2923",message:"last column cell boundary",data:{col:g,row:d,x:E,actualCellWidth:lt,cellEndX:U,drawAreaRight:rt,outputWidth:n,offsetX:_,actualStrideX:ct},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{});let D=E,jt=0,ke=Ge(d,g),It=g===I-1?Math.max(U,rt):U;for(g===I-1&&It!==U&&fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2930",message:"extending cell boundary for last column",data:{col:g,cellEndX:U,effectiveCellEndX:It,drawAreaRight:rt},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{});D<It&&F>=0;){let at=B;F>=2&&jt>0&&jt%2===0&&(at=V[Math.max(0,F-1)]);let Bt=Qt[at]?.width||l.measureText(at).width;if(It-D<=0)break;if(D+Bt>rt){fetch("http://127.0.0.1:7242/ingest/74d4f25e-0fce-432d-aa79-8bfa524124c4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"fold-core.js:2826",message:"character clipped at right edge",data:{currentX:D,nextCharWidth:Bt,drawAreaRight:rt,row:d,col:g,cellEndX:U},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{});break}if(Ht&&!Ct){let ee=Le(d,g),We=l.globalAlpha,He=l.fillStyle;l.globalAlpha=Ne,l.fillStyle=_e,l.fillText(at,D+ee.x,q+ee.y),l.globalAlpha=We,l.fillStyle=He}l.fillText(at,D,q),D+=Bt*ke,jt++}Ct&&(l.globalAlpha=1)}}if(J){l.strokeStyle=i,l.lineWidth=.5,l.globalAlpha=1;for(let d=0;d<R;d++)for(let g=0;g<I;g++){let E=Math.round(_+g*ct),q=Math.round(H+d*yt);l.strokeRect(E,q,lt,mt)}}if(Q&&Dt.length>0){let g=v(e+9292)()<.6;l.strokeStyle=g?i:r,l.lineWidth=1.5*P,l.globalAlpha=.85,l.lineCap="round";for(let E of Dt)l.beginPath(),l.moveTo(_+E.p1.x,H+E.p1.y),l.lineTo(_+E.p2.x,H+E.p2.y),l.stroke();l.globalAlpha=1}if(m){l.strokeStyle="#ff00ff",l.lineWidth=1,l.globalAlpha=.7;for(let d of Dt)l.beginPath(),l.moveTo(_+d.p1.x,H+d.p1.y),l.lineTo(_+d.p2.x,H+d.p2.y),l.stroke();l.globalAlpha=1}if(x){let d=Re.map(g=>({x:g.x*P,y:g.y*T}));if(d.length>=3){l.strokeStyle="#00ffff",l.lineWidth=2,l.globalAlpha=.9,l.beginPath(),l.moveTo(_+d[0].x,H+d[0].y);for(let g=1;g<d.length;g++)l.lineTo(_+d[g].x,H+d[g].y);l.closePath(),l.stroke(),l.fillStyle="#00ffff",l.globalAlpha=.15,l.fill(),l.globalAlpha=1}}if(C){l.strokeStyle=r,l.lineWidth=1,l.globalAlpha=.3;for(let d=0;d<=I;d++){let g=_+d*ct;l.beginPath(),l.moveTo(g,H),l.lineTo(g,H+Ot),l.stroke()}for(let d=0;d<=R;d++){let g=H+d*yt;l.beginPath(),l.moveTo(_,g),l.lineTo(_+Ft,g),l.stroke()}l.globalAlpha=1}if(f){let d=8*P;if(l.lineWidth=2,l.globalAlpha=1,ft){let g=_+ft.x*P,E=H+ft.y*T;l.strokeStyle="#00ff00",l.beginPath(),l.arc(g,E,d,0,Math.PI*2),l.stroke()}if(ut){let g=_+ut.x*P,E=H+ut.y*T;l.strokeStyle="#00ff00",l.beginPath(),l.arc(g,E,d,0,Math.PI*2),l.stroke()}}if(A&&Nt&&Nt.length>0){l.strokeStyle="#ff0000",l.fillStyle="rgba(255, 0, 0, 0)",l.lineWidth=1.5,l.globalAlpha=1;let d=3;for(let g of Nt)l.beginPath(),l.arc(_+g.x,H+g.y,d,0,Math.PI*2),l.fill(),l.stroke()}return K.toDataURL("image/png")}function qt(t,e=1200,n=1500,s=0,o=null){let r=ze(t),i=Ve(e,n,s,t),h=qe(t),u=zt(t),a=ge(t),c=tn(t),b=c?Ze(t,r.bg,r.text):null,M=pe(t),p=nn(t),y=en(t),m=Qe(t),x=o;if(x===null){let f=v(t+9999);x=Math.floor(1+f()*500)}return{seed:t,palette:r,cells:i,renderMode:h,weightRange:u,foldStrategy:a,multiColor:c,levelColors:b,maxFolds:M,paperProperties:p,showCreaseLines:y,overlapInfo:m,folds:x}}function yn(t,e,n,s=""){let o=qt(e,1200,1500,0,n),r=zt(e),i=1200-50*2,h=1500-50*2,{creases:u}=ye(i,h,n,e,r,o.foldStrategy,o.paperProperties),a=on(o.paperProperties);return{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:s?`${s}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:o.foldStrategy.type},{trait_type:"Render Mode",value:o.renderMode},{trait_type:"Multi-Color",value:o.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${o.cells.cellW}x${o.cells.cellH}`},{trait_type:"Fold Count",value:n},{trait_type:"Max Folds",value:o.maxFolds},{trait_type:"Crease Count",value:u.length},{trait_type:"Palette Strategy",value:o.palette.strategy},{trait_type:"Paper Type",value:a},{trait_type:"Paper Grain",value:o.paperProperties.angleAffinity!==null?"Grain":"Uniform"},...o.showCreaseLines?[{trait_type:"Crease Lines",value:"Visible"}]:[]]}}async function bn(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${St}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${St}`),!0}catch(n){return console.warn("Failed to load on-chain font:",n),!1}}function Mn(t){if(typeof t=="number")return t;if(typeof t!="string")return 0;let e=t.replace(/^0x/,"").slice(0,16),n=BigInt("0x"+e);return Number(n%BigInt(2147483647))}function An(){let t=window.devicePixelRatio||1,e=window.innerWidth,n=window.innerHeight,s=4/5,o,r;e/n>s?(r=n,o=Math.floor(r*s)):(o=e,r=Math.floor(o/s));let i=Math.floor(o*t),h=Math.floor(r*t);return{width:o,height:r,renderWidth:i,renderHeight:h,dpr:t}}var vt=null;function ie(t,e){let n=An(),s=be({folds:e.foldCount,seed:e.seed,outputWidth:n.renderWidth,outputHeight:n.renderHeight,bgColor:e.params.palette.bg,textColor:e.params.palette.text,accentColor:e.params.palette.accent,cellWidth:e.params.cells.cellW,cellHeight:e.params.cells.cellH,renderMode:e.params.renderMode,multiColor:e.params.multiColor,levelColors:e.params.levelColors,foldStrategy:e.params.foldStrategy,paperProperties:e.params.paperProperties,showCreaseLines:e.params.showCreaseLines}),o=new Image;o.onload=()=>{let r=t.getContext("2d");t.width=n.renderWidth*2,t.height=n.renderHeight*2,t.style.width=n.width+"px",t.style.height=n.height+"px",r.drawImage(o,0,0,t.width,t.height),typeof window.scaleCanvas=="function"&&window.scaleCanvas()},o.src=s}function En(t,e){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>t.apply(this,s),e)}}async function Jt(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,n=typeof window<"u"&&window.LESS_SEED;if(n&&!t&&(t=Mn(n)),t&&e===void 0){let o=v(t+9999);e=Math.floor(1+o()*500)}let s=typeof window<"u"&&window.FONT_DATA_URI||le;if(t&&e!==void 0){let o=document.getElementById("c")||document.querySelector("canvas");o||(o=document.createElement("canvas"),o.id="c",document.body.appendChild(o),document.body.style.cssText="margin:0;padding:0;background:#000;display:flex;align-items:center;justify-content:center;min-height:100vh;overflow:hidden;"),await bn(s);let r=qt(t,1200,1500,0,e);vt={seed:t,foldCount:e,params:r},ie(o,vt),window.addEventListener("resize",En(()=>{vt&&ie(o,vt)},150))}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0||window.LESS_SEED)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Jt()):Jt());})();
