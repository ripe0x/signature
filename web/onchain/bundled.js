(()=>{var Qt="FoldMono",Ue="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",Pn='"Courier New", Courier, monospace',$e=`"${Qt}", ${Pn}`,ye=.6,Me=.08,be=.06,Bn=.03,Xn=.05;function Ne(t,e,o){let s=t/255,n=e/255,r=o/255;return(.2126*s+.7152*n+.0722*r)*100}var X=[{hex:"#000000",name:"black",luminance:0,temperature:"neutral",r:0,g:0,b:0},{hex:"#0000AA",name:"blue",luminance:10,temperature:"cool",r:0,g:0,b:170},{hex:"#AA0000",name:"red",luminance:20,temperature:"warm",r:170,g:0,b:0},{hex:"#AA00AA",name:"magenta",luminance:25,temperature:"warm",r:170,g:0,b:170},{hex:"#FFFFFF",name:"white",luminance:100,temperature:"neutral",r:255,g:255,b:255},{hex:"#FFFF55",name:"yellow",luminance:93,temperature:"warm",r:255,g:255,b:85},{hex:"#55FFFF",name:"lightCyan",luminance:85,temperature:"cool",r:85,g:255,b:255},{hex:"#55FF55",name:"lightGreen",luminance:77,temperature:"cool",r:85,g:255,b:85},{hex:"#00AA00",name:"green",luminance:30,temperature:"cool",r:0,g:170,b:0},{hex:"#00AAAA",name:"cyan",luminance:40,temperature:"cool",r:0,g:170,b:170},{hex:"#5555FF",name:"lightBlue",luminance:45,temperature:"cool",r:85,g:85,b:255},{hex:"#FF5555",name:"lightRed",luminance:45,temperature:"warm",r:255,g:85,b:85},{hex:"#FF55FF",name:"lightMagenta",luminance:60,temperature:"warm",r:255,g:85,b:255}],jn=X.filter(t=>t.luminance<30||t.luminance>70),Yn={black:.2,white:.15,blue:.15,red:.15,magenta:.1,yellow:.1,lightCyan:.08,lightGreen:.07},Ft=X,Un=X.filter(t=>t.temperature!=="neutral"),$n=X.filter(t=>t.temperature!=="neutral"),De=X,Yo={dark:X.filter(t=>t.luminance<30),light:X.filter(t=>t.luminance>70)},We={warm:X.filter(t=>t.temperature==="warm"),cool:X.filter(t=>t.temperature==="cool"),neutral:X.filter(t=>t.temperature==="neutral")};function zn(t,e){let o=t.r-e.r,s=t.g-e.g,n=t.b-e.b;return Math.sqrt(o*o*.3+s*s*.59+n*n*.11)}function Kn(t,e,o){let s=t.luminance,n=e.luminance,r=[];for(let i=0;i<o;i++){let u=i/(o-1),c=s+(n-s)*u,f=X.filter(E=>E.temperature===t.temperature||E.temperature==="neutral"),x=f[0],b=Math.abs(x.luminance-c);for(let E of f){let g=Math.abs(E.luminance-c);g<b&&(b=g,x=E)}r.push(x)}return r}function He(t,e,o=4.5){let s=t.luminance/100,n=e.luminance/100,r=Math.max(s,n)+.05,i=Math.min(s,n)+.05;return r/i>=o}function Zt(t,e){return e[Math.floor(t()*e.length)]}function Vn(t,e,o){let s=t(),n=0;for(let r of e)if(n+=o[r.name]||0,s<n)return r;return e[e.length-1]}function Kt(t,e,o){e/=100,o/=100;let s=e*Math.min(o,1-o),n=r=>{let i=(r+t/30)%12,u=o-s*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*u).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}function vt(t){let e=parseInt(t.slice(1,3),16)/255,o=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255,n=Math.max(e,o,s),r=Math.min(e,o,s),i,u,c=(n+r)/2;if(n===r)i=u=0;else{let f=n-r;switch(u=c>.5?f/(2-n-r):f/(n+r),n){case e:i=((o-s)/f+(o<s?6:0))/6;break;case o:i=((s-e)/f+2)/6;break;case s:i=((e-o)/f+4)/6;break}}return{h:i*360,s:u*100,l:c*100}}var qn={red:["cyan","lightCyan"],magenta:["green","lightGreen"],blue:["yellow"],lightRed:["cyan","lightCyan"],lightMagenta:["green","lightGreen"],lightBlue:["yellow"],cyan:["red","lightRed"],lightCyan:["red","lightRed"],green:["magenta","lightMagenta"],lightGreen:["magenta","lightMagenta"],yellow:["blue","lightBlue"],black:["white","yellow","lightCyan"],white:["black","blue","magenta"]};function Jn(t,e,o){let n=[];switch(e){case"value":{let r=t.luminance<50;n=Ft.filter(i=>r?i.luminance>60:i.luminance<40);break}case"temperature":{if(t.temperature==="neutral")n=Ft.filter(r=>r.temperature!=="neutral"&&Math.abs(r.luminance-t.luminance)>25);else{let r=t.temperature==="warm"?"cool":"warm";n=Ft.filter(i=>i.temperature===r&&Math.abs(i.luminance-t.luminance)>25)}break}case"complement":{let r=qn[t.name]||[];if(n=Ft.filter(i=>r.includes(i.name)),n.length===0){let i=t.luminance<50;n=Ft.filter(u=>i?u.luminance>60:u.luminance<40)}break}case"clash":{n=Ft.filter(r=>r.name!==t.name&&Math.abs(r.luminance-t.luminance)>20&&Math.abs(r.luminance-t.luminance)<50);break}}return n.sort((r,i)=>Math.abs(i.luminance-t.luminance)-Math.abs(r.luminance-t.luminance)),n.length>0?Zt(o,n):t.luminance<50?X.find(r=>r.name==="white"):X.find(r=>r.name==="black")}function Qn(t,e,o){if(o()<.4)return e;let s=Un.filter(r=>r.name!==t.name&&r.name!==e.name&&Math.abs(r.luminance-t.luminance)>20);if(s.length===0)return e;let n=s.filter(r=>["yellow","lightCyan","lightMagenta","lightGreen"].includes(r.name));return n.length>0&&o()<.6?Zt(o,n):Zt(o,s)}function Zn(t){let e=Zt(t,$n),o;return e.luminance>50?o=X.find(s=>s.name==="black"):e.luminance<30?o=t()<.75?X.find(s=>s.name==="black"):X.find(s=>s.name==="white"):o=t()<.6?X.find(s=>s.name==="black"):X.find(s=>s.name==="white"),{bg:o.hex,text:e.hex,accent:e.hex,strategy:`monochrome/${e.name}`,colorCount:2}}function to(t){let e=G(t);if(e()<.12)return Zn(e);let o=Vn(e,jn,Yn),s=e(),n;s<.4?n="value":s<.68?n="temperature":s<.9?n="complement":n="clash";let r=Jn(o,n,e),i=Qn(o,r,e),u=i.hex===r.hex?2:3;return Math.abs(o.luminance-r.luminance)<25?{bg:o.luminance<50?"#000000":"#FFFFFF",text:o.luminance<50?"#FFFFFF":"#000000",accent:"#FFFF55",strategy:n,colorCount:u}:{bg:o.hex,text:r.hex,accent:i.hex,strategy:n,colorCount:u}}function Pe(t,e,o){let s=[];for(let n=e;n<=o;n++)t%n===0&&s.push(n);return s}function eo(t,e,o,s){let n=1200-o*2-290,r=1697-o*2-145*2,i=Pe(n,20,600),u=Pe(r,20,600);i.length===0&&i.push(8),u.length===0&&u.push(12);let c=G(s+9999),f=1+Me+be,x=ye/f,b=[];for(let d of i)for(let A of u){let a=Math.max(d/A,A/d),h=A*x;a<=3&&d>=h&&b.push({w:d,h:A})}if(b.length===0)return{cellW:8,cellH:12};b.sort((d,A)=>d.w*d.h-A.w*A.h);let E=c(),g;if(E<.03){let d=Math.max(1,Math.ceil(b.length*.1)),A=Math.floor(c()*d);g=b[A]}else if(E<.1){let d=Math.floor(b.length*.1),A=Math.floor(b.length*.25),a=d+Math.floor(c()*Math.max(1,A-d));g=b[Math.min(a,b.length-1)]}else if(E<.45){let d=Math.floor(b.length*.25),A=Math.floor(b.length*.75),a=d+Math.floor(c()*(A-d));g=b[Math.min(a,b.length-1)]}else if(E<.95){let d=Math.floor(b.length*.75),A=Math.floor(b.length*.9),a=d+Math.floor(c()*Math.max(1,A-d));g=b[Math.min(a,b.length-1)]}else{let d=Math.floor(b.length*.9),A=d+Math.floor(c()*(b.length-d));g=b[Math.min(A,b.length-1)]}return{cellW:g.w,cellH:g.h}}function no(t){let o=G(t+5555)();return o<.4?"normal":o<.7?"inverted":o<.8?"binary":o<.9?"sparse":"dense"}function oo(t){return G(t+5556)()<.3}function ze(t){let e=G(t+7777),o=e();if(o<.25){let s=.2+e()*.2;return{min:s,max:s+.1+e()*.2}}else if(o<.5){let s=.6+e()*.2;return{min:s,max:s+.1+e()*.1}}else return o<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function ro(t){let e=G(t+11111);if(!(e()>=.5))return{hasOverlap:!1,amount:"none"};let s=e(),n;return s<.2?n="5%":s<.4?n="25%":s<.6?n="50%":s<.8?n="75%":n="95%",{hasOverlap:!0,amount:n}}function Ke(t){let e=G(t+2222);return Math.floor(4+e()*66)}function Ve(t){let e=G(t+6666),o=e();return o<.16?{type:"horizontal",jitter:3+e()*12}:o<.32?{type:"vertical",jitter:3+e()*12}:o<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:o<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:o<.68?{type:"grid",jitter:3+e()*10}:o<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function Ae(t){let e=t.toUpperCase();return De.find(o=>o.hex===e)||De[0]}function so(t,e,o){let s=G(t+3333),n=Ae(e),r=Ae(o),i=n.luminance>50,u=(f,x)=>i?x.luminance-f.luminance:f.luminance-x.luminance;if(s()<.5){let f=Kn(n,r,6);return[f[0].hex,f[Math.floor(f.length*.33)].hex,f[Math.floor(f.length*.66)].hex,f[f.length-1].hex]}else{let f=r.temperature,x=f==="warm"?"cool":"warm",b=We[f].filter(M=>He(n,M,2)).sort(u),E=We[x].filter(M=>He(n,M,2)).sort(u),g=[],d=new Set;b.length>0?(g.push(b[0].hex),d.add(b[0].hex)):(g.push(r.hex),d.add(r.hex));let A=b.filter(M=>!d.has(M.hex));if(A.length>0){let M=A[Math.floor(A.length*.4)];g.push(M.hex),d.add(M.hex)}else g.push(r.hex);let a=E.filter(M=>!d.has(M.hex));if(a.length>0){let M=a[Math.floor(a.length*.5)];g.push(M.hex),d.add(M.hex)}else g.push(r.hex);let h=[...b,...E].filter(M=>!d.has(M.hex)).sort(u);return h.length>0?g.push(h[h.length-1].hex):g.push(r.hex),g}}function io(t){return G(t+4444)()<.25}function qe(t){return .08+(.35-.08)*Math.exp(-.03*t)}function lo(t,e=0){let o=(t*2654435761^3735928559)>>>0,s=G(o),n=qe(e);return s()<n}function ao(t){let e=(t*2654435761^4277009102)>>>0,s=G(e)();return s<.5?"background":s<.85?"text":"accent"}function xe(t){let e=[0,51,102,153,204,255],o=e[0],s=Math.abs(t-o);for(let n of e){let r=Math.abs(t-n);r<s&&(s=r,o=n)}return o}function Je(t,e,o){let s=xe(t),n=xe(e),r=xe(o);return"#"+s.toString(16).padStart(2,"0").toUpperCase()+n.toString(16).padStart(2,"0").toUpperCase()+r.toString(16).padStart(2,"0").toUpperCase()}function te(t){let e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function Vt(t){let e=te(t);return(.299*e.r+.587*e.g+.114*e.b)/255}function Be(t,e,o){let s=te(t),r=e*o*51,i=Math.max(0,Math.min(255,s.r+r)),u=Math.max(0,Math.min(255,s.g+r)),c=Math.max(0,Math.min(255,s.b+r));return Je(i,u,c)}function Gt(t,e,o,s){let n=(t*2654435761^s.charCodeAt(0)*4919)>>>0,r=G(n),i=Vt(e),u=Vt(o),c;s==="background"?i<.3?c=r()<.75?1:-1:i>.7?c=r()<.75?-1:1:c=r()<.5?1:-1:s==="text"?u<.4?c=i>.5&&r()<.6?-1:1:c=i<.5&&r()<.6?1:-1:c=r()<.5?1:-1;let f=r(),x=f<.5?1:f<.85?2:3,b=Be(e,c,x),E=Vt(b),g=Math.abs(E-u);if(s!=="accent"&&g<.2){let d=Be(e,-c,x+1),A=Vt(d);if(Math.abs(A-u)>g)return d}return b}function co(t,e,o){let s={...e,anchorType:o,cgaBg:e.bg,cgaText:e.text,cgaAccent:e.accent};return o==="background"?(s.bg=e.bg,s.text=Gt(t,e.text,e.bg,"text"),s.accent=Gt(t+1,e.accent,e.bg,"accent")):o==="text"?(s.bg=Gt(t,e.bg,e.text,"background"),s.text=e.text,s.accent=Gt(t+1,e.accent,e.text,"accent")):(s.bg=Gt(t,e.bg,e.accent,"background"),s.text=Gt(t+1,e.text,s.bg,"text"),s.accent=e.accent),s}function fo(t,e){let o=te(t),s=te(e);return[.25,.5,.75,1].map(i=>{let u=Math.round(o.r+(s.r-o.r)*i),c=Math.round(o.g+(s.g-o.g)*i),f=Math.round(o.b+(s.b-o.b)*i);return Je(u,c,f)})}function uo(t){return G(t+9191)()<.008}function ho(t){let e=G(t+5555),o=.1+e()*.8,s=0,n=e()<.4,r=n?e()*180:null,i=n?.2+e()*.6:0,u=.3+e()*1.4;return{absorbency:o,intersectionThreshold:s,angleAffinity:r,affinityStrength:i,ceilingMultiplier:u}}function po(t){let e=t.absorbency<.35?"Resistant":t.absorbency<.65?"Standard":"Absorbent",o=t.intersectionThreshold<.15?"Fine":t.intersectionThreshold<.35?"Medium":"Coarse",s=t.angleAffinity!==null?"Grain":"Uniform";return`${e}/${o}/${s}`}function go(t,e,o){return t}var Uo=[-1/1,-1/2,-1/4,-1/8,-1/16,1/64,1/32,1/16,1/8,1/4,1/2,1,2];function xo(t,e,o,s,n){let r=G(t+12345),i=r()<.6,u=!1,c=!1,f=!1,x=!1;if(i){let q=r();q<.33?u=!0:(q<.66||(u=!0),c=!0),u&&r()<.3&&(f=!0),c&&r()<.3&&(x=!0)}let b=[-1/16,-1/8,-1/4,-1/2],E=q=>{if(q)return b[Math.floor(r()*b.length)];let k=r();return k<.4?0:k<.525?1/64:k<.65?1/32:k<.75?1/16:k<.85?1/8:k<.9?1/4:k<.95?1/2:k<.98?1:2},g=e,d=o,A=u?E(f):0,a=g*A,h=g+a,M=h>0?Math.max(1,Math.floor((s+a)/h)):1,w=M>1?a:0;M===1&&g<s&&(g=s,w=0);let T=c?E(x):0,C=d*T,F=d+C,I=F>0?Math.max(1,Math.floor((n+C)/F)):1,S=I>1?C:0;I===1&&d<n&&(d=n,S=0);let z=M,N=I,l=w,W=S,v=z*g+(z>1?(z-1)*l:0),V=N*d+(N>1?(N-1)*W:0),gt=s-v,ct=n-V;return{cols:z,rows:N,cellWidth:g,cellHeight:d,colGap:l,rowGap:W,strideX:g+l,strideY:d+W,gridOffsetX:gt>0?gt/2:0,gridOffsetY:ct>0?ct/2:0,actualGridWidth:v,actualGridHeight:V}}function mo(t){let e=Object.values(t).filter(u=>u>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((u,c)=>u-c);let o=(u,c)=>{let f=Math.floor(u.length*c);return u[Math.min(f,u.length-1)]},s=o(e,.7),n=o(e,.94),r=o(e,.94)+1,i=o(e,.985);return{t1:Math.max(.01,s),t2:Math.max(s+.01,n),t3:Math.max(n+.01,r),tExtreme:Math.max(r+.01,i)}}function Ot(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}var yo=1103515245n,Mo=12345n,Xe=0x7fffffffn;function G(t){let e=BigInt(Math.abs(t)||1);return()=>(e=e*yo+Mo&Xe,Number(e)/Number(Xe))}var j={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>j.len(j.sub(t,e)),norm:t=>{let e=j.len(t);return e>1e-4?j.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,o)=>({x:t.x+(e.x-t.x)*o,y:t.y+(e.y-t.y)*o}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>j.dist(t,e)<.5};function Te(t,e,o,s){let n=j.sub(e,t),r=j.sub(s,o),i=n.x*r.y-n.y*r.x;if(Math.abs(i)<1e-4)return null;let u=j.sub(o,t),c=(u.x*r.y-u.y*r.x)/i,f=(u.x*n.y-u.y*n.x)/i;return c>=.001&&c<=.999&&f>=.001&&f<=.999?{point:j.add(t,j.scale(n,c)),t:c,u:f}:null}function je(t,e){let o=t.reduce((n,r)=>n+r,0);if(o<=0)return 0;let s=e()*o;for(let n=0;n<t.length;n++)if(s-=t[n],s<=0)return n;return t.length-1}var bo=0,Ao=1,Eo=2,wo=3;function rt(t,e,o,s){switch(t){case bo:return{x:e*o,y:0};case Ao:return{x:o,y:e*s};case Eo:return{x:(1-e)*o,y:s};case wo:return{x:0,y:(1-e)*s};default:return{x:e*o,y:0}}}function Ee(t,e,o){switch(t){case 0:return{x:0,y:0};case 1:return{x:e,y:0};case 2:return{x:e,y:o};case 3:return{x:0,y:o};default:return{x:0,y:0}}}function Qe(t,e){return{x:t.p1.x+(t.p2.x-t.p1.x)*e,y:t.p1.y+(t.p2.y-t.p1.y)*e}}function we(t,e){let o=e.x-t.x,s=e.y-t.y,n=Math.atan2(s,o)*180/Math.PI;return n<0&&(n+=180),n>=180&&(n-=180),n}function Ro(t,e,o,s,n,r,i){let c=(()=>{if(!i)return[0,1,2,3];switch(i.type){case"horizontal":return[1,3];case"vertical":return[0,2];case"grid":return t%2===0?[1,3]:[0,2];case"diagonal":return[0,1,2,3];case"radial":case"clustered":case"random":default:return[0,1,2,3]}})();if(i&&i.type==="radial"){let E=i.focalX*s,g=i.focalY*n;if(t<10||e.length===0||r()<.6){let d=[{edge:0,dist:g},{edge:1,dist:s-E},{edge:2,dist:n-g},{edge:3,dist:E}];d.sort((M,w)=>M.dist-w.dist);let A=r(),a=A<.5?d[0].edge:A<.8?d[1].edge:d[Math.floor(r()*4)].edge,h;return a===0||a===2?h=.1+E/s*.8+(r()-.5)*.3:h=.1+g/n*.8+(r()-.5)*.3,h=Math.max(.05,Math.min(.95,h)),{point:rt(a,h,s,n),type:"edge",edge:a,t:h}}}if(i&&i.type==="clustered"){let E=i.clusterX*s,g=i.clusterY*n,d=i.spread;if(t<15||r()<.7){let A=[{edge:0,weight:1+(1-Math.abs(g/n))*2},{edge:1,weight:1+E/s*2},{edge:2,weight:1+g/n*2},{edge:3,weight:1+(1-E/s)*2}],a=A.reduce((T,C)=>T+C.weight,0),h=r()*a,M=0;for(let T of A)if(h-=T.weight,h<=0){M=T.edge;break}let w;return M===0||M===2?w=E/s+(r()-.5)*d:w=g/n+(r()-.5)*d,w=Math.max(.05,Math.min(.95,w)),{point:rt(M,w,s,n),type:"edge",edge:M,t:w}}}let f=Math.max(.2,1-t*.015),x=i&&(i.type==="horizontal"||i.type==="vertical"||i.type==="grid");if(x||r()<f||e.length===0&&o.length===0){let E=x?0:i&&i.type==="diagonal"?.5:.15;if(r()<E){let d=Math.floor(r()*4);return{point:Ee(d,s,n),type:"corner",corner:d}}else{let d=c[Math.floor(r()*c.length)],A=i&&i.jitter?i.jitter/100:0,a=.05+r()*.9,h=Math.max(.05,Math.min(.95,a+(r()-.5)*A));return{point:rt(d,h,s,n),type:"edge",edge:d,t:h}}}else if(o.length>0&&r()<.35){let g=o[Math.floor(r()*o.length)];return{point:{x:g.x,y:g.y},type:"intersection",intersectionIndex:o.indexOf(g)}}else if(e.length>0){let g=e[Math.floor(r()*e.length)],d=.1+r()*.8;return{point:Qe(g,d),type:"crease",creaseIndex:e.indexOf(g),t:d}}else{let g=c[Math.floor(r()*c.length)],d=.05+r()*.9;return{point:rt(g,d,s,n),type:"edge",edge:g,t:d}}}function Co(t,e,o,s,n,r,i,u,c){let f=Math.min(n,r)*.15,x=a=>a===0||a===2,b=a=>a===1||a===3;if(c&&(c.type==="horizontal"||c.type==="vertical"||c.type==="grid")){let a=c.type==="horizontal"||c.type==="grid"&&e%2===0;if(t.type==="edge"){let h=(t.edge+2)%4,M=b(t.edge);if(a&&M||!a&&!M){let w=c.jitter?c.jitter/100:0,T=t.t!==void 0?t.t:.5,C=Math.max(.05,Math.min(.95,T+(i()-.5)*w));return C=1-C,{point:rt(h,C,n,r),type:"edge",edge:h}}}}if(c&&c.type==="diagonal"){let a=c.angle||(i()<.5?45:135);if(t.type==="corner"){let h=(t.corner+2)%4;return{point:Ee(h,n,r),type:"corner"}}else if(t.type==="edge"){let h=c.jitter?(i()-.5)*c.jitter:0,M=(a+h)*Math.PI/180,w=t.point.x,T=t.point.y,C=Math.cos(M),F=Math.sin(M),I=null,S=0,z=[{edge:0,y:0},{edge:2,y:r},{edge:3,x:0},{edge:1,x:n}];for(let N of z){let l=null;if(N.y!==void 0){let W=(N.y-T)/F;if(W>0){let v=w+C*W;v>=0&&v<=n&&(l={x:v,y:N.y})}}else{let W=(N.x-w)/C;if(W>0){let v=T+F*W;v>=0&&v<=r&&(l={x:N.x,y:v})}}if(l){let W=j.dist(t.point,l);W>S&&W>=f&&(S=W,I=l)}}if(I)return{point:I,type:"edge"}}}if(c&&c.type==="radial"){let a=c.focalX*n,h=c.focalY*r,M={x:a,y:h},w=t.point.x-a,T=t.point.y-h,C=Math.sqrt(w*w+T*T);if(C>0){let F=w/C,I=T/C,S=1/0;F>0&&(S=Math.min(S,(n-t.point.x)/F)),F<0&&(S=Math.min(S,-t.point.x/F)),I>0&&(S=Math.min(S,(r-t.point.y)/I)),I<0&&(S=Math.min(S,-t.point.y/I));let z={x:Math.max(0,Math.min(n,t.point.x+F*S*.95)),y:Math.max(0,Math.min(r,t.point.y+I*S*.95))};if(j.dist(t.point,z)>=f)return{point:z,type:"edge"}}}if(c&&c.type==="clustered"){let a=c.clusterX*n,h=c.clusterY*r,M={x:a,y:h},w=[];for(let C=0;C<4;C++)for(let F=0;F<3;F++){let I=.1+i()*.8,S=rt(C,I,n,r),z=To(M,t.point,S),N=Math.max(n,r)*.5,l=Math.max(.1,1-z/N)*3;w.push({point:S,type:"edge",edge:C,weight:l})}let T=w.filter(C=>j.dist(t.point,C.point)>=f);if(T.length>0){let C=T.map(I=>I.weight),F=je(C,i);return T[F]}}let E=[];if(t.type==="edge"){let a=(t.edge+2)%4,h=(t.edge+1)%4,M=(t.edge+3)%4,w=e<3?3:1.5;for(let C=0;C<3;C++){let F=.1+i()*.8;E.push({point:rt(a,F,n,r),type:"edge",edge:a,weight:w})}let T=1;for(let C=0;C<2;C++){let F=.1+i()*.8;E.push({point:rt(h,F,n,r),type:"edge",edge:h,weight:T}),E.push({point:rt(M,F,n,r),type:"edge",edge:M,weight:T})}}else if(t.type==="corner"){let a=(t.corner+2)%4;E.push({point:Ee(a,n,r),type:"corner",weight:2});for(let h=0;h<4;h++)if(!(h===t.corner||h===(t.corner+3)%4)){let w=.2+i()*.6;E.push({point:rt(h,w,n,r),type:"edge",edge:h,weight:1.5})}}else{for(let a=0;a<4;a++){let h=.1+i()*.8;E.push({point:rt(a,h,n,r),type:"edge",edge:a,weight:1})}if(o.length>1&&e>3)for(let a=0;a<Math.min(3,o.length);a++){let h=Math.floor(i()*o.length),M=o[h];if(t.type==="crease"&&t.creaseIndex===h)continue;let w=.15+i()*.7;E.push({point:Qe(M,w),type:"crease",creaseIndex:h,weight:.6})}}if(o.length>0&&u)for(let a of E){let h=we(t.point,a.point);for(let M of o){let w=we(M.p1,M.p2),T=Math.abs(h-w);T>90&&(T=180-T),u.parallel>0&&T<15&&(a.weight*=1+u.parallel),u.perpendicular>0&&T>75&&(a.weight*=1+u.perpendicular)}}let g=E.filter(a=>j.dist(t.point,a.point)>=f);if(g.length===0){for(let h=0;h<4;h++){let w=rt(h,.5,n,r);if(j.dist(t.point,w)>=f)return{point:w,type:"edge",edge:h}}let a=t.type==="edge"?(t.edge+2)%4:0;return{point:rt(a,.5,n,r),type:"edge",edge:a}}let d=g.map(a=>a.weight),A=je(d,i);return g[A]}function To(t,e,o){let s=o.x-e.x,n=o.y-e.y,r=s*s+n*n;if(r===0)return j.dist(t,e);let i=((t.x-e.x)*s+(t.y-e.y)*n)/r;i=Math.max(0,Math.min(1,i));let u={x:e.x+i*s,y:e.y+i*n};return j.dist(t,u)}function Io(t){let e=[];for(let o=0;o<t.length;o++)for(let s=o+1;s<t.length;s++){let n=Te(t[o].p1,t[o].p2,t[s].p1,t[s].p2);n&&e.push({x:n.point.x,y:n.point.y,crease1:o,crease2:s})}return e}function Ze(t,e,o,s,n={min:0,max:1},r=null,i=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let u=r||Ve(s),c=Ke(s),f=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],x=[],b=null,E=null;if(!o||o<=0)return{creases:[],finalShape:f,maxFolds:c,firstFoldTarget:null,lastFoldTarget:null};let g=G(s),d=G(s+8888),A=G(s+6666),a=i||{absorbency:1,intersectionThreshold:0,angleAffinity:null,affinityStrength:0,ceilingMultiplier:1},h=[],M=G(s+1111);for(let I=0;I<c;I++)h[I]=.001+M()*.25;let w=G(s+2222),T={parallel:w()*.8,perpendicular:w()*.8},C=Math.max(t,e)*.05,F=[];for(let I=0;I<o;I++){let S=I%c,z=Math.floor(I/c);if(S===0&&z>0)for(let Y of x)Y.reductionMultiplier!==void 0&&(Y.weight=Math.max(.01,Y.weight*Y.reductionMultiplier));I%5===0&&x.length>1&&(F=Io(x));let N=Ro(I,x,F,t,e,g,u),l=Co(N,I,x,F,t,e,g,T,u),W=N.point,v=l.point,gt=A()<a.absorbency,ct=n.min+d()*(n.max-n.min);if(a.angleAffinity!==null&&a.affinityStrength>0){let Y=we(W,v),Q=Math.abs(Y-a.angleAffinity);Q>90&&(Q=180-Q);let ft=1-Q/90*a.affinityStrength;ct*=ft}if(gt&&ct>.01&&(x.push({p1:j.copy(W),p2:j.copy(v),depth:x.length,weight:ct,cyclePosition:S,reductionMultiplier:h[S],anchorType:N.type,terminusType:l.type}),x.length>1)){let Y=x[x.length-1];for(let Q=0;Q<x.length-1;Q++){let ft=Te(Y.p1,Y.p2,x[Q].p1,x[Q].p2);ft&&F.push({x:ft.point.x,y:ft.point.y,crease1:Q,crease2:x.length-1})}}let q=j.mid(W,v),k={x:Math.max(C,Math.min(t-C,q.x)),y:Math.max(C,Math.min(e-C,q.y))};I===0&&b===null&&(b=k),E=k}return{creases:x,finalShape:f,maxFolds:c,firstFoldTarget:b,lastFoldTarget:E}}function Fo(t){let e=[];for(let o=0;o<t.length;o++)for(let s=o+1;s<t.length;s++){let n=Te(t[o].p1,t[o].p2,t[s].p1,t[s].p2);if(n){let r=t[o].weight||1,i=t[s].weight||1;e.push({x:n.point.x,y:n.point.y,depth1:t[o].depth,depth2:t[s].depth,gap:Math.abs(t[s].depth-t[o].depth),weight:r+i})}}return e}function vo(t,e,o,s,n,r=null,i=null){let u=Fo(t),c=i||{intersectionThreshold:0,ceilingMultiplier:1},f=u.filter(a=>a.weight>=c.intersectionThreshold),x={},b={},E={};for(let a of f){let h=Math.floor(a.x/s),M=Math.floor(a.y/n);if(h>=0&&h<e&&M>=0&&M<o){let w=`${h},${M}`;x[w]=(x[w]||0)+a.weight,b[w]=Math.max(b[w]||0,a.gap),E[w]=(E[w]||0)+1}}let d=e*o*.5*c.ceilingMultiplier,A=Object.values(x).reduce((a,h)=>a+h,0);if(A>d&&A>0){let a=d/A,h=a+(1-a)*.3;for(let M of Object.keys(x))x[M]*=h}return{activeCreases:t,intersections:f,cellWeights:x,cellMaxGap:b,cellIntersectionCounts:E,destroyed:0,maxFolds:r}}function tn({folds:t,seed:e,outputWidth:o,outputHeight:s,bgColor:n,textColor:r,accentColor:i,cellWidth:u,cellHeight:c,renderMode:f,showEmptyCells:x=!1,multiColor:b,levelColors:E,foldStrategy:g=null,paperProperties:d=null,padding:A=0,showCreases:a=!1,showPaperShape:h=!1,showFoldTargets:M=!1,showIntersections:w=!1,showGrid:T=!1,showHitCounts:C=!1,showCellOutlines:F=!1,showCreaseLines:I=!1,fontFamily:S=$e,linesOnlyMode:z=!1}){let N=document.createElement("canvas"),l=N.getContext("2d"),W=2;N.width=o*W,N.height=s*W,l.setTransform(W,0,0,W,0,0),l.fillStyle=n,l.fillRect(0,0,o,s);let v=o/1200,V=s/1697,gt=1200-A*2-145*2,ct=1697-A*2-145*2;if(f!=="inverted"){let m=15*v;l.font=`${m}px ${S}`,l.fillStyle=r,l.globalAlpha=.1;let y=m*ye,_=m*1.13;for(let L=0;L<s+_;L+=_)for(let P=0;P<o+y;P+=y)l.fillText("\u2591",P,L+_);l.globalAlpha=1}let q=xo(e,u,c,gt,ct),{cols:k,rows:Y,strideX:Q,strideY:ft,gridOffsetX:nn,gridOffsetY:on}=q,rn=q.cellWidth,sn=q.cellHeight,Fe=gt*v,ee=ct*V,U=(A+145+nn)*v,$=(A+145+on)*V,St=rn*v,Xt=sn*V,_t=Q*v,Lt=ft*V,ln=ze(e),an=go(d,k,Y),cn=q.actualGridWidth,fn=q.actualGridHeight,{creases:ve,finalShape:un,maxFolds:hn,firstFoldTarget:bt,lastFoldTarget:At}=Ze(cn,fn,t,e,ln,g,an),dn=ve.map(p=>({...p,p1:{x:p.p1.x*v,y:p.p1.y*V},p2:{x:p.p2.x*v,y:p.p2.y*V}})),ne=null;if(bt){let p=Math.max(0,Math.min(k-1,Math.floor(bt.x/Q))),m=Math.max(0,Math.min(Y-1,Math.floor(bt.y/ft)));ne=`${p},${m}`}let oe=null;if(At){let p=Math.max(0,Math.min(k-1,Math.floor(At.x/Q))),m=Math.max(0,Math.min(Y-1,Math.floor(At.y/ft)));oe=`${p},${m}`}let{activeCreases:kt,intersections:Et,cellWeights:re,cellMaxGap:se}=vo(dn,k,Y,_t,Lt,hn,d),xt=new Set;if(Object.keys(se).length>0){let p=Math.max(...Object.values(se));for(let[m,y]of Object.entries(se))y===p&&xt.add(m)}let pn=1+Me+be,mt=Xt/pn;l.font=`${mt}px ${S}`,l.textBaseline="top";let lt=[" ","\u2591","\u2592","\u2593"],Nt=mt<30?2:3,nt=mt*ye,gn=mt*Me,xn=mt*be,No=mt*Bn,mn=mt*Xn,wt=mo(re),jt=G(e+22222)(),Rt;jt<.6?Rt=0:jt<.8?Rt=1:jt<.9?Rt=2:jt<.97?Rt=3:Rt=5;let Yt=G(e+33333),Ct=Yt(),J;Ct<.22?J="ltr":Ct<.44?J="rtl":Ct<.65?J="center":Ct<.8?J="alternate":Ct<.9?J="diagonal":Ct<.96?J="randomMid":J="checkerboard";let yn=Yt()<.5,Mn=Math.floor(Yt()*k),bn=Yt()<.5,Z=G(e+11111),ie=Z()>=.65,An=(()=>{if(!ie)return 1;let p=Z();return p<.1?.95:p<.2?.75:p<.3?.65:p<.6?.5:p<.8?.25:.05})(),En=ie?Math.floor(Z()*5):0,tt=[.95,.75,.5,.25,.05],Ge=tt.indexOf(An),st=Math.floor(Z()*3)+1,dt=Math.floor(Z()*3),le=Math.floor(Z()*4)+1,ae=[],ce=[],Oe=[],wn=.3+Z()*.4,Rn=.3+Z()*.4,Cn=.3+Z()*.4;for(let p=0;p<20;p++)ae.push(Z()<wn),ce.push(Z()<Rn),Oe.push(Z()<Cn);let Tn=Math.floor(Z()*2),In=Z()<.1,Fn=(p,m)=>{if(!ie)return 1;let y=Ge===-1?0:Ge;switch(En){case 1:dt===1?ae[p%20]&&(y=(y+st)%tt.length):dt===2?y=(y+p%3*st)%tt.length:y=(y+Math.floor(p/le)*st)%tt.length;break;case 2:dt===1?ce[m%20]&&(y=(y+st)%tt.length):dt===2?y=(y+m%3*st)%tt.length:y=(y+Math.floor(m/le)*st)%tt.length;break;case 3:if(dt===1){let _=ae[p%20],L=ce[m%20];(Tn===0?_||L:_!==L)&&(y=(y+st)%tt.length)}else dt===2?y=(y+(p+m)%3*st)%tt.length:y=(y+(p+m)%2*st)%tt.length;break;case 4:if(dt===1){let _=(p+m)%20;Oe[_]&&(y=(y+st)%tt.length)}else dt===2?y=(y+(p+m)%4*st)%tt.length:y=(y+Math.floor((p+m)/le)*st)%tt.length;break;default:break}return tt[y]},Tt=(p,m)=>E&&E.length>0?E[Math.min(p,3)]:r,Dt=G(e+22222),fe=Dt()<.25,vn=Math.round(2+Dt()*2)*v,Gn=Math.round(1+Dt()*2)*V,On=fe?.4+Dt()*.3:0,Sn=(p,m)=>{let y=G(e+22222+p*1e3+m),_=Math.floor(y()*3);return{x:_!==1?vn:0,y:_!==0?Gn:0}},_n=fe?(()=>{let p=vt(r),m;if(i&&i!==r)m=vt(i);else{let y=Ae(r),_=X.filter(R=>R.hex!==r&&R.hex!==n&&zn(R,y)>100),L=Math.floor(Dt()*_.length),P=_.length>0?_[L]:X[0];m=vt(P.hex)}return m.l<=p.l&&(m.l=Math.min(95,p.l+25)),Kt(m.h,m.s,m.l)})():null,Se=(A+145)*v,ue=(A+145)*V,he=Se+mn,Ln=ue+gn,de=Se+Fe,Po=ue+ee-xn;if(z){let p=R=>{let O=parseInt(R.slice(1,3),16),K=parseInt(R.slice(3,5),16),D=parseInt(R.slice(5,7),16);return Ne(O,K,D)},m=p(n),y=p(r),_=p(i),L=Math.abs(m-y)>Math.abs(m-_)?r:i,P=2*v;if(kt.length>0){l.strokeStyle=L,l.lineWidth=P,l.globalAlpha=1,l.lineCap="round";for(let R of kt)l.beginPath(),l.moveTo(U+R.p1.x,$+R.p1.y),l.lineTo(U+R.p2.x,$+R.p2.y),l.stroke()}if(Et&&Et.length>0){l.strokeStyle=L,l.lineWidth=P,l.globalAlpha=1;let R=4*v;for(let O of Et)l.beginPath(),l.arc(U+O.x,$+O.y,R,0,Math.PI*2),l.stroke()}l.globalAlpha=1}else if(C){let p=Math.floor(Math.min(St*.45,Xt*.7));l.font=`bold ${p}px monospace`,l.textAlign="center",l.textBaseline="middle",l.fillStyle=r;for(let m=0;m<Y;m++)for(let y=0;y<k;y++){let _=Math.round(U+y*_t+St/2),L=Math.round($+m*Lt+Xt/2),P=`${y},${m}`,R=re[P]||0;R>0&&l.fillText(Math.round(R).toString(),_,L)}l.textAlign="left",l.textBaseline="top"}else{let p=Math.max(U,he),m=Math.max($,Ln);for(let y=0;y<Y;y++){let _=Math.round(m+y*Lt);if(!(_>ue+ee))for(let L=0;L<k;L++){let P=Math.round(p+L*_t),R=`${L},${y}`,O=re[R]||0,K=null,D=r,H=-1,ut=!1;if(ne===R)H=O>0?Ot(O,wt):2,K=lt[Math.min(Math.max(H,2),Nt)],D=i;else if(f==="normal")if(H=Ot(O,wt),K=lt[Math.min(H,Nt)],H===0&&(K=lt[1],ut=!0),D=Tt(H,R),O>=1.5){let It=O-1.5,yt=30+Math.min(It*300,150),et=vt(r);D=Kt((et.h+yt+360)%360,Math.min(100,et.s+20),Math.min(85,et.l+10))}else xt.has(R)&&O>0?D=i:oe===R&&(D=r);else if(f==="binary")O===0?x&&(K=lt[1],H=0,ut=!0,D=r):(H=Nt,K=lt[H],D=Tt(H,R),xt.has(R)&&(D=i));else if(f==="inverted")if(H=Math.min(3-Ot(O,wt),Nt),K=lt[H],D=Tt(H,R),O>=1.5){let It=O-1.5,yt=30+Math.min(It*300,150),et=vt(r);D=Kt((et.h+yt+360)%360,Math.min(100,et.s+20),Math.min(85,et.l+10))}else xt.has(R)&&O>0&&(D=i);else if(f==="sparse")H=Ot(O,wt),H===1?(K=lt[1],D=Tt(1,R),xt.has(R)&&(D=i)):(K=lt[1],ut=!0,D=r);else if(f==="dense")if(H=Ot(O,wt),H>=2)if(K=lt[Math.min(H,Nt)],D=Tt(H,R),O>=1.5){let It=O-1.5,yt=30+Math.min(It*300,150),et=vt(r);D=Kt((et.h+yt+360)%360,Math.min(100,et.s+20),Math.min(85,et.l+10))}else xt.has(R)&&(D=i);else K=lt[1],ut=!0,D=r;if(K){if(ne===R||oe===R)l.fillStyle=D;else{let B=Tt(Ot(O,wt),R);l.fillStyle=xt.has(R)&&O>0?i:B}ut&&(l.globalAlpha=.1,l.fillStyle=r);let It=l.measureText(K).width,yt=P+St,et=Math.min(yt,de),Wt=et-P;if(Wt<nt*.5)continue;let Nn=ut||O===0&&f!=="inverted",pe=f==="inverted"&&O===0&&In,Dn=Nn||pe?1:Fn(y,L),_e=nt*Dn,ge=Math.max(1,Math.floor((Wt-nt)/_e)+1),Wn=(ge-1)*_e+nt,ht=(Wt-Wn)/nt>.3?ge+1:ge,Mt=ht<=1?nt:(Wt-nt)/(ht-1),Le=ut||pe?0:Rt*St,ke=0;Le>0&&(ke=Math.ceil(Le/Mt));let Hn=pe?1:ht+ke,at;if(J==="ltr")at="ltr";else if(J==="rtl")at="rtl";else if(J==="center")at="center";else if(J==="alternate")at=y%2===1!==yn?"rtl":"ltr";else if(J==="diagonal"){let B=(Mn+(bn?y:-y)+k*100)%k;at=L<B?"ltr":"rtl"}else if(J==="randomMid"){let B=G(e+55555+y),Ht=Math.floor(B()*k);at=L<Ht?"ltr":"rtl"}else J==="checkerboard"?at=(y+L)%2===0?"ltr":"rtl":at="ltr";let Ut=P+Wt/2;for(let B=0;B<Hn&&H>=0;B++){let Ht=K;H>=2&&B>0&&B%2===0&&(Ht=lt[Math.max(0,H-1)]);let ot;if(at==="center")if(B<ht){let it=Math.floor((B+1)/2)*Mt;B%2===0?ot=Ut+(B===0?-nt/2:it-nt/2):ot=Ut-it-nt/2}else{let it=B-ht,$t=Math.floor(ht/2)*Mt,zt=Math.floor((it+1)/2)*Mt;if(it%2===0){if(ot=Ut+$t+zt,ot+nt>de)break}else if(ot=Ut-$t-zt-nt,ot<he)break}else if(B<ht)ot=P+B*Mt;else if(at==="rtl"){let it=B-ht;if(ot=P-(it+1)*Mt,ot<he)break}else{let it=B-ht;if(ot=et+it*Mt,ot+nt>de)break}if(fe&&!ut){let it=Sn(y,L),$t=l.globalAlpha,zt=l.fillStyle;l.globalAlpha=On,l.fillStyle=_n,l.fillText(Ht,ot+it.x,_+it.y),l.globalAlpha=$t,l.fillStyle=zt}l.fillText(Ht,ot,_)}ut&&(l.globalAlpha=1)}}}}if(F){l.strokeStyle=i,l.lineWidth=.5,l.globalAlpha=1;for(let p=0;p<Y;p++)for(let m=0;m<k;m++){let y=Math.round(U+m*_t),_=Math.round($+p*Lt);l.strokeRect(y,_,St,Xt)}}if(I&&kt.length>0){let m=G(e+9292)()<.6;l.strokeStyle=m?i:r,l.lineWidth=1.5*v,l.globalAlpha=.85,l.lineCap="round";for(let y of kt)l.beginPath(),l.moveTo(U+y.p1.x,$+y.p1.y),l.lineTo(U+y.p2.x,$+y.p2.y),l.stroke();l.globalAlpha=1}if(a){let p=R=>{let O=parseInt(R.slice(1,3),16),K=parseInt(R.slice(3,5),16),D=parseInt(R.slice(5,7),16);return Ne(O,K,D)},m=p(n),y=p(r),_=p(i),L=Math.abs(m-y)>Math.abs(m-_)?r:i,P=2*v;l.strokeStyle=L,l.lineWidth=P,l.globalAlpha=1,l.lineCap="round";for(let R of kt)l.beginPath(),l.moveTo(U+R.p1.x,$+R.p1.y),l.lineTo(U+R.p2.x,$+R.p2.y),l.stroke();if(Et&&Et.length>0){l.strokeStyle=L,l.lineWidth=P,l.globalAlpha=1;let R=4*v;for(let O of Et)l.beginPath(),l.arc(U+O.x,$+O.y,R,0,Math.PI*2),l.stroke()}}if(h){let p=un.map(m=>({x:m.x*v,y:m.y*V}));if(p.length>=3){l.strokeStyle="#00ffff",l.lineWidth=2,l.globalAlpha=.9,l.beginPath(),l.moveTo(U+p[0].x,$+p[0].y);for(let m=1;m<p.length;m++)l.lineTo(U+p[m].x,$+p[m].y);l.closePath(),l.stroke(),l.fillStyle="#00ffff",l.globalAlpha=.15,l.fill(),l.globalAlpha=1}}if(T){l.strokeStyle=r,l.lineWidth=1,l.globalAlpha=.3;for(let p=0;p<=k;p++){let m=U+p*_t;l.beginPath(),l.moveTo(m,$),l.lineTo(m,$+ee),l.stroke()}for(let p=0;p<=Y;p++){let m=$+p*Lt;l.beginPath(),l.moveTo(U,m),l.lineTo(U+Fe,m),l.stroke()}l.globalAlpha=1}if(M){let p=8*v;if(l.lineWidth=2,l.globalAlpha=1,bt){let m=U+bt.x*v,y=$+bt.y*V;l.strokeStyle="#00ff00",l.beginPath(),l.arc(m,y,p,0,Math.PI*2),l.stroke()}if(At){let m=U+At.x*v,y=$+At.y*V;l.strokeStyle="#00ff00",l.beginPath(),l.arc(m,y,p,0,Math.PI*2),l.stroke()}}let kn={grid:{cols:k,rows:Y,colGap:q.colGap,rowGap:q.rowGap},drawDirection:J,foldStrategy:g?.type||"random",multiColor:b,showCreaseLines:I,creaseCount:ve.length};return{canvas:N,dataUrl:N.toDataURL("image/png"),settings:kn}}function Ie(t,e=1200,o=1697,s=0,n=null){let r=ze(t),i=Ve(t),u=Ke(t),c=ho(t),f=n;if(f===null){let N=G(t+9999);f=Math.floor(1+N()*500)}let x=e-145*2,b=o-145*2,{creases:E}=Ze(x,b,f,t,r,i,c),g=E.length,d=qe(g),A=lo(t,g),a=to(t),h,M=null;A?(M=ao(t),h=co(t,a,M)):h=a;let w=A?!1:io(t),T=null;A?T=fo(h.bg,h.text):w&&(T=so(t,h.bg,h.text));let C=eo(e,o,0,t),F=no(t),I=oo(t),S=uo(t),z=ro(t);return{seed:t,palette:h,cells:C,renderMode:F,showEmptyCells:I,weightRange:r,foldStrategy:i,gradientMode:A,gradientProbability:d,creaseCount:g,multiColor:w,levelColors:T,maxFolds:u,paperProperties:c,showCreaseLines:S,overlapInfo:z,folds:f}}function Go(t,e,o,s=""){let n=Ie(e,1200,1697,0,o),r=po(n.paperProperties),i=Math.round(n.gradientProbability*100),u;return n.gradientMode?u=`gradient/${n.palette.anchorType||"background"} (${i}% @ ${n.creaseCount} creases)`:u=`cga/${n.palette.strategy} (${i}% gradient @ ${n.creaseCount} creases)`,{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:s?`${s}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:n.foldStrategy.type},{trait_type:"Render Mode",value:n.renderMode},{trait_type:"Multi-Color",value:n.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${n.cells.cellW}x${n.cells.cellH}`},{trait_type:"Fold Count",value:o},{trait_type:"Max Folds",value:n.maxFolds},{trait_type:"Crease Count",value:n.creaseCount},{trait_type:"Palette Strategy",value:u},{trait_type:"Paper Type",value:r},{trait_type:"Paper Grain",value:n.paperProperties.angleAffinity!==null?"Grain":"Uniform"},...n.showCreaseLines?[{trait_type:"Crease Lines",value:"Visible"}]:[]]}}async function Oo(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${Qt}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${Qt}`),await document.fonts.ready,!0}catch(o){return console.warn("Failed to load on-chain font:",o),!1}}function So(t){if(typeof t=="number")return t;if(typeof t!="string")return 0;let e=t.replace(/^0x/,"").slice(0,16),o=BigInt("0x"+e);return Number(o%BigInt(2147483647))}function _o(){let t=window.devicePixelRatio||1,e=window.innerWidth||1200,o=window.innerHeight||1697,s=1/Math.sqrt(2),n,r;e/o>s?(r=o,n=Math.floor(r*s)):(n=e,r=Math.floor(n/s)),n=Math.max(n,100),r=Math.max(r,141);let i=Math.floor(n*t),u=Math.floor(r*t);return{width:n,height:r,renderWidth:i,renderHeight:u,dpr:t}}var Pt=null;var Re=!1,pt=!1,qt=0,me=null,Jt=null,Bt=null;function Lo(t,e,o={}){let{onRender:s,getDimensions:n}=o;Bt&&Bt();function r(x,b,E){let g=e();if(!g)return;let d=n?n():{};en(t,g,{foldOverride:x,linesOnly:b,isAnimating:E,width:d.width,height:d.height}),s&&s()}function i(){let x=e();if(!pt||!x||qt>x.foldCount){c();return}r(qt,me==="lines-only",!0),qt++,Jt=setTimeout(i,50)}function u(x){pt=!0,qt=0,me=x,i()}function c(){pt=!1,me=null,Jt&&(clearTimeout(Jt),Jt=null)}function f(x){e()&&(x.shiftKey&&x.key==="F"&&(x.preventDefault(),Re=!Re,pt||r()),x.shiftKey&&x.key==="A"&&(x.preventDefault(),pt&&c(),u("full")),x.shiftKey&&x.key==="L"&&(x.preventDefault(),pt&&c(),u("lines-only")),x.key==="Escape"&&pt&&(x.preventDefault(),c()))}return document.addEventListener("keydown",f),Bt=()=>{document.removeEventListener("keydown",f),c(),Bt=null},Bt}function en(t,e,o={}){let{foldOverride:s,linesOnly:n=!1,isAnimating:r=!1,width:i,height:u,showOverlays:c}=o,f;if(i&&u){let w=.7071302298173247,T=i/u,C,F;T>w?(F=u,C=Math.round(u*w)):(C=i,F=Math.round(i/w)),f={renderWidth:C,renderHeight:F,width:i,height:u}}else f=_o();let x=s!==void 0?s:e.foldCount,b=c!==void 0?c:r?n:n||Re,{canvas:E,dataUrl:g,settings:d}=tn({folds:x,seed:e.seed,outputWidth:f.renderWidth,outputHeight:f.renderHeight,bgColor:e.params.palette.bg,textColor:e.params.palette.text,accentColor:e.params.palette.accent,cellWidth:e.params.cells.cellW,cellHeight:e.params.cells.cellH,renderMode:e.params.renderMode,showEmptyCells:e.params.showEmptyCells,multiColor:e.params.multiColor,levelColors:e.params.levelColors,foldStrategy:e.params.foldStrategy,paperProperties:e.params.paperProperties,showCreaseLines:e.params.showCreaseLines,showCreases:b,showIntersections:b,linesOnlyMode:n}),A=t.getContext("2d"),a=2;t.width=f.width*a,t.height=f.height*a,t.style.width=f.width+"px",t.style.height=f.height+"px",A.fillStyle=e.params.palette.bg,A.fillRect(0,0,t.width,t.height);let h=(f.width-f.renderWidth)/2*a,M=(f.height-f.renderHeight)/2*a;return A.drawImage(E,h,M,f.renderWidth*a,f.renderHeight*a),typeof window<"u"&&typeof window.scaleCanvas=="function"&&window.scaleCanvas(),{dataUrl:g,settings:d}}function Ye(t,e,o,s,n){return en(t,e,{foldOverride:o,linesOnly:s,isAnimating:n})}function ko(t,e){let o;return function(...s){clearTimeout(o),o=setTimeout(()=>t.apply(this,s),e)}}async function Ce(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,o=typeof window<"u"&&window.LESS_SEED;if(o&&!t&&(t=So(o)),t&&e===void 0){let n=G(t+9999);e=Math.floor(1+n()*500)}let s=typeof window<"u"&&window.FONT_DATA_URI||Ue;if(t&&e!==void 0){let n=document.getElementById("c")||document.querySelector("canvas");n||(n=document.createElement("canvas"),n.id="c",document.body.appendChild(n),document.body.style.cssText="margin:0;padding:0;background:#000;display:flex;align-items:center;justify-content:center;min-height:100vh;overflow:hidden;"),await Oo(s);let r=Ie(t,1200,1697,0,e);Pt={seed:t,foldCount:e,params:r},Ye(n,Pt),typeof window<"u"&&(window.RENDER_COMPLETE=!0),window.addEventListener("resize",ko(()=>{Pt&&!pt&&Ye(n,Pt)},150)),Lo(n,()=>Pt)}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0||window.LESS_SEED)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Ce()):Ce());})();
