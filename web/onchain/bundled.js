(()=>{var ee="FoldMono",rn="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",Yn='"Courier New", Courier, monospace',ne=`"${ee}", ${Yn}`,zt=.6,ue=.08,he=.06,$n=.03,jn=.05;function Ve(t,e,n){let o=t/255,r=e/255,i=n/255;return(.2126*o+.7152*r+.0722*i)*100}var Q=[{hex:"#000000",name:"black",luminance:0,temperature:"neutral",r:0,g:0,b:0},{hex:"#0000AA",name:"blue",luminance:10,temperature:"cool",r:0,g:0,b:170},{hex:"#AA0000",name:"red",luminance:20,temperature:"warm",r:170,g:0,b:0},{hex:"#AA00AA",name:"magenta",luminance:25,temperature:"warm",r:170,g:0,b:170},{hex:"#FFFFFF",name:"white",luminance:100,temperature:"neutral",r:255,g:255,b:255},{hex:"#FFFF55",name:"yellow",luminance:93,temperature:"warm",r:255,g:255,b:85},{hex:"#55FFFF",name:"lightCyan",luminance:85,temperature:"cool",r:85,g:255,b:255},{hex:"#55FF55",name:"lightGreen",luminance:77,temperature:"cool",r:85,g:255,b:85},{hex:"#00AA00",name:"green",luminance:30,temperature:"cool",r:0,g:170,b:0},{hex:"#00AAAA",name:"cyan",luminance:40,temperature:"cool",r:0,g:170,b:170},{hex:"#5555FF",name:"lightBlue",luminance:45,temperature:"cool",r:85,g:85,b:255},{hex:"#FF5555",name:"lightRed",luminance:45,temperature:"warm",r:255,g:85,b:85},{hex:"#FF55FF",name:"lightMagenta",luminance:60,temperature:"warm",r:255,g:85,b:255}],zn=Q.filter(t=>t.luminance<30||t.luminance>70),Un={black:.2,white:.15,blue:.15,red:.15,magenta:.1,yellow:.1,lightCyan:.08,lightGreen:.07},$t=Q,Kn=Q.filter(t=>t.temperature!=="neutral"),Vn=Q.filter(t=>t.temperature!=="neutral"),qe=Q,fr={dark:Q.filter(t=>t.luminance<30),light:Q.filter(t=>t.luminance>70)},Je={warm:Q.filter(t=>t.temperature==="warm"),cool:Q.filter(t=>t.temperature==="cool"),neutral:Q.filter(t=>t.temperature==="neutral")};function qn(t,e){let n=t.r-e.r,o=t.g-e.g,r=t.b-e.b;return Math.sqrt(n*n*.3+o*o*.59+r*r*.11)}function Jn(t,e,n){let o=t.luminance,r=e.luminance,i=[];for(let l=0;l<n;l++){let f=l/(n-1),a=o+(r-o)*f,p=Q.filter(E=>E.temperature===t.temperature||E.temperature==="neutral"),v=p[0],b=Math.abs(v.luminance-a);for(let E of p){let x=Math.abs(E.luminance-a);x<b&&(b=x,v=E)}i.push(v)}return i}function Qe(t,e,n=4.5){let o=t.luminance/100,r=e.luminance/100,i=Math.max(o,r)+.05,l=Math.min(o,r)+.05;return i/l>=n}function de(t,e){return e[Math.floor(t()*e.length)]}function Qn(t,e,n){let o=t(),r=0;for(let i of e)if(r+=n[i.name]||0,o<r)return i;return e[e.length-1]}function Se(t,e,n){e/=100,n/=100;let o=e*Math.min(n,1-n),r=i=>{let l=(i+t/30)%12,f=n-o*Math.max(Math.min(l-3,9-l,1),-1);return Math.round(255*f).toString(16).padStart(2,"0")};return`#${r(0)}${r(8)}${r(4)}`}function Fe(t){let e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,o=parseInt(t.slice(5,7),16)/255,r=Math.max(e,n,o),i=Math.min(e,n,o),l,f,a=(r+i)/2;if(r===i)l=f=0;else{let p=r-i;switch(f=a>.5?p/(2-r-i):p/(r+i),r){case e:l=((n-o)/p+(n<o?6:0))/6;break;case n:l=((o-e)/p+2)/6;break;case o:l=((e-n)/p+4)/6;break}}return{h:l*360,s:f*100,l:a*100}}var Zn={red:["cyan","lightCyan"],magenta:["green","lightGreen"],blue:["yellow"],lightRed:["cyan","lightCyan"],lightMagenta:["green","lightGreen"],lightBlue:["yellow"],cyan:["red","lightRed"],lightCyan:["red","lightRed"],green:["magenta","lightMagenta"],lightGreen:["magenta","lightMagenta"],yellow:["blue","lightBlue"],black:["white","yellow","lightCyan"],white:["black","blue","magenta"]};function to(t,e,n){let r=[];switch(e){case"value":{let i=t.luminance<50;r=$t.filter(l=>i?l.luminance>60:l.luminance<40);break}case"temperature":{if(t.temperature==="neutral")r=$t.filter(i=>i.temperature!=="neutral"&&Math.abs(i.luminance-t.luminance)>25);else{let i=t.temperature==="warm"?"cool":"warm";r=$t.filter(l=>l.temperature===i&&Math.abs(l.luminance-t.luminance)>25)}break}case"complement":{let i=Zn[t.name]||[];if(r=$t.filter(l=>i.includes(l.name)),r.length===0){let l=t.luminance<50;r=$t.filter(f=>l?f.luminance>60:f.luminance<40)}break}case"clash":{r=$t.filter(i=>i.name!==t.name&&Math.abs(i.luminance-t.luminance)>20&&Math.abs(i.luminance-t.luminance)<50);break}}return r.sort((i,l)=>Math.abs(l.luminance-t.luminance)-Math.abs(i.luminance-t.luminance)),r.length>0?de(n,r):t.luminance<50?Q.find(i=>i.name==="white"):Q.find(i=>i.name==="black")}function eo(t,e,n){if(n()<.4)return e;let o=Kn.filter(i=>i.name!==t.name&&i.name!==e.name&&Math.abs(i.luminance-t.luminance)>20);if(o.length===0)return e;let r=o.filter(i=>["yellow","lightCyan","lightMagenta","lightGreen"].includes(i.name));return r.length>0&&n()<.6?de(n,r):de(n,o)}function no(t){let e=de(t,Vn),n;return e.luminance>50?n=Q.find(o=>o.name==="black"):e.luminance<30?n=t()<.75?Q.find(o=>o.name==="black"):Q.find(o=>o.name==="white"):n=t()<.6?Q.find(o=>o.name==="black"):Q.find(o=>o.name==="white"),{bg:n.hex,text:e.hex,accent:e.hex,strategy:`monochrome/${e.name}`,colorCount:2}}function oo(t){let e=D(t);if(e()<.12)return no(e);let n=Qn(e,zn,Un),o=e(),r;o<.4?r="value":o<.68?r="temperature":o<.9?r="complement":r="clash";let i=to(n,r,e),l=eo(n,i,e),f=l.hex===i.hex?2:3;return Math.abs(n.luminance-i.luminance)<25?{bg:n.luminance<50?"#000000":"#FFFFFF",text:n.luminance<50?"#FFFFFF":"#000000",accent:"#FFFF55",strategy:r,colorCount:f}:{bg:n.hex,text:i.hex,accent:l.hex,strategy:r,colorCount:f}}function Ze(t,e,n){let o=[];for(let r=e;r<=n;r++)t%r===0&&o.push(r);return o}function ro(t,e,n,o){let r=1200-n*2-290,i=1697-n*2-145*2,l=Ze(r,20,600),f=Ze(i,20,600);l.length===0&&l.push(8),f.length===0&&f.push(12);let a=D(o+9999),p=1+ue+he,v=zt/p,b=[];for(let u of l)for(let M of f){let c=Math.max(u/M,M/u),h=M*v;c<=3&&u>=h&&b.push({w:u,h:M})}if(b.length===0)return{cellW:8,cellH:12};b.sort((u,M)=>u.w*u.h-M.w*M.h);let E=a(),x;if(E<.03){let u=Math.max(1,Math.ceil(b.length*.1)),M=Math.floor(a()*u);x=b[M]}else if(E<.1){let u=Math.floor(b.length*.1),M=Math.floor(b.length*.25),c=u+Math.floor(a()*Math.max(1,M-u));x=b[Math.min(c,b.length-1)]}else if(E<.45){let u=Math.floor(b.length*.25),M=Math.floor(b.length*.75),c=u+Math.floor(a()*(M-u));x=b[Math.min(c,b.length-1)]}else if(E<.95){let u=Math.floor(b.length*.75),M=Math.floor(b.length*.9),c=u+Math.floor(a()*Math.max(1,M-u));x=b[Math.min(c,b.length-1)]}else{let u=Math.floor(b.length*.9),M=u+Math.floor(a()*(b.length-u));x=b[Math.min(M,b.length-1)]}return{cellW:x.w,cellH:x.h}}function io(t){let n=D(t+5555)();return n<.4?"normal":n<.7?"inverted":n<.8?"binary":n<.9?"sparse":"dense"}function so(t){return D(t+5556)()<.3}function We(t){let e=D(t+7777),n=e();if(n<.25){let o=.2+e()*.2;return{min:o,max:o+.1+e()*.2}}else if(n<.5){let o=.6+e()*.2;return{min:o,max:o+.1+e()*.1}}else return n<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function lo(t){let e=D(t+11111);if(!(e()>=.5))return{hasOverlap:!1,amount:"none"};let o=e(),r;return o<.2?r="5%":o<.4?r="25%":o<.6?r="50%":o<.8?r="75%":r="95%",{hasOverlap:!0,amount:r}}function sn(t){let e=D(t+2222);return Math.floor(4+e()*66)}function ln(t){let e=D(t+6666),n=e();return n<.16?{type:"horizontal",jitter:3+e()*12}:n<.32?{type:"vertical",jitter:3+e()*12}:n<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:n<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:n<.68?{type:"grid",jitter:3+e()*10}:n<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function Ge(t){let e=t.toUpperCase();return qe.find(n=>n.hex===e)||qe[0]}function ao(t,e,n){let o=D(t+3333),r=Ge(e),i=Ge(n),l=r.luminance>50,f=(p,v)=>l?v.luminance-p.luminance:p.luminance-v.luminance;if(o()<.5){let p=Jn(r,i,6);return[p[0].hex,p[Math.floor(p.length*.33)].hex,p[Math.floor(p.length*.66)].hex,p[p.length-1].hex]}else{let p=i.temperature,v=p==="warm"?"cool":"warm",b=Je[p].filter(m=>Qe(r,m,2)).sort(f),E=Je[v].filter(m=>Qe(r,m,2)).sort(f),x=[],u=new Set;b.length>0?(x.push(b[0].hex),u.add(b[0].hex)):(x.push(i.hex),u.add(i.hex));let M=b.filter(m=>!u.has(m.hex));if(M.length>0){let m=M[Math.floor(M.length*.4)];x.push(m.hex),u.add(m.hex)}else x.push(i.hex);let c=E.filter(m=>!u.has(m.hex));if(c.length>0){let m=c[Math.floor(c.length*.5)];x.push(m.hex),u.add(m.hex)}else x.push(i.hex);let h=[...b,...E].filter(m=>!u.has(m.hex)).sort(f);return h.length>0?x.push(h[h.length-1].hex):x.push(i.hex),x}}function co(t){return D(t+4444)()<.25}function an(t){return .08+(.35-.08)*Math.exp(-.03*t)}function fo(t,e=0){let n=D(t+77777),o=an(e);return n()<o}function uo(t){let n=D(t+88888)();return n<.5?"background":n<.85?"text":"accent"}function De(t){let e=[0,51,102,153,204,255],n=e[0],o=Math.abs(t-n);for(let r of e){let i=Math.abs(t-r);i<o&&(o=i,n=r)}return n}function cn(t,e,n){let o=De(t),r=De(e),i=De(n);return"#"+o.toString(16).padStart(2,"0").toUpperCase()+r.toString(16).padStart(2,"0").toUpperCase()+i.toString(16).padStart(2,"0").toUpperCase()}function pe(t){let e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function ce(t){let e=pe(t);return(.299*e.r+.587*e.g+.114*e.b)/255}function tn(t,e,n){let o=pe(t),i=e*n*51,l=Math.max(0,Math.min(255,o.r+i)),f=Math.max(0,Math.min(255,o.g+i)),a=Math.max(0,Math.min(255,o.b+i));return cn(l,f,a)}function jt(t,e,n,o){let i=D(t+(o==="background"?11111:o==="text"?22222:33333)),l=ce(e),f=ce(n),a;o==="background"?l<.3?a=i()<.75?1:-1:l>.7?a=i()<.75?-1:1:a=i()<.5?1:-1:o==="text"?f<.4?a=l>.5&&i()<.6?-1:1:a=l<.5&&i()<.6?1:-1:a=i()<.5?1:-1;let p=i(),v=p<.5?1:p<.85?2:3,b=tn(e,a,v),E=ce(b),x=Math.abs(E-f);if(o!=="accent"&&x<.2){let u=tn(e,-a,v+1),M=ce(u);if(Math.abs(M-f)>x)return u}return b}function ho(t,e,n){let o={...e,anchorType:n,cgaBg:e.bg,cgaText:e.text,cgaAccent:e.accent};return n==="background"?(o.bg=e.bg,o.text=jt(t,e.text,e.bg,"text"),o.accent=jt(t+1,e.accent,e.bg,"accent")):n==="text"?(o.bg=jt(t,e.bg,e.text,"background"),o.text=e.text,o.accent=jt(t+1,e.accent,e.text,"accent")):(o.bg=jt(t,e.bg,e.accent,"background"),o.text=jt(t+1,e.text,o.bg,"text"),o.accent=e.accent),o}function po(t,e){let n=pe(t),o=pe(e);return[.25,.5,.75,1].map(l=>{let f=Math.round(n.r+(o.r-n.r)*l),a=Math.round(n.g+(o.g-n.g)*l),p=Math.round(n.b+(o.b-n.b)*l);return cn(f,a,p)})}function go(t){return D(t+9191)()<.008}function xo(t){return D(t+9393)()<.008}function mo(t){let e=D(t+5555),n=.1+e()*.8,o=0,r=e()<.4,i=r?e()*180:null,l=r?.2+e()*.6:0,f=.3+e()*1.4;return{absorbency:n,intersectionThreshold:o,angleAffinity:i,affinityStrength:l,ceilingMultiplier:f}}function yo(t){let e=t.absorbency<.35?"Resistant":t.absorbency<.65?"Standard":"Absorbent",n=t.intersectionThreshold<.15?"Fine":t.intersectionThreshold<.35?"Medium":"Coarse",o=t.angleAffinity!==null?"Grain":"Uniform";return`${e}/${n}/${o}`}function fn(t,e,n){return t}var ur=[-1/1,-1/2,-1/4,-1/8,-1/16,1/64,1/32,1/16,1/8,1/4,1/2,1,2];function un(t,e,n,o,r){let i=D(t+12345),l=i()<.6,f=!1,a=!1,p=!1,v=!1;if(l){let ft=i();ft<.33?f=!0:(ft<.66||(f=!0),a=!0),f&&i()<.3&&(p=!0),a&&i()<.3&&(v=!0)}let b=[-1/16,-1/8,-1/4,-1/2],E=ft=>{if(ft)return b[Math.floor(i()*b.length)];let z=i();return z<.4?0:z<.525?1/64:z<.65?1/32:z<.75?1/16:z<.85?1/8:z<.9?1/4:z<.95?1/2:z<.98?1:2},x=e,u=n,M=f?E(p):0,c=x*M,h=x+c,m=h>0?Math.max(1,Math.floor((o+c)/h)):1,C=m>1?c:0;m===1&&x<o&&(x=o,C=0);let w=a?E(v):0,R=u*w,S=u+R,T=S>0?Math.max(1,Math.floor((r+R)/S)):1,k=T>1?R:0;T===1&&u<r&&(u=r,k=0);let Y=m,$=T,B=C,s=k,K=Y*x+(Y>1?(Y-1)*B:0),P=$*u+($>1?($-1)*s:0),et=o-K,pt=r-P;return{cols:Y,rows:$,cellWidth:x,cellHeight:u,colGap:B,rowGap:s,strideX:x+B,strideY:u+s,gridOffsetX:et>0?et/2:0,gridOffsetY:pt>0?pt/2:0,actualGridWidth:K,actualGridHeight:P}}function hn(t){let e=Object.values(t).filter(f=>f>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((f,a)=>f-a);let n=(f,a)=>{let p=Math.floor(f.length*a);return f[Math.min(p,f.length-1)]},o=n(e,.7),r=n(e,.94),i=n(e,.94)+1,l=n(e,.985);return{t1:Math.max(.01,o),t2:Math.max(o+.01,r),t3:Math.max(r+.01,i),tExtreme:Math.max(i+.01,l)}}function Et(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}var Mo=1103515245n,bo=12345n,en=0x7fffffffn;function D(t){let e=BigInt(Math.abs(t)||1);return()=>(e=e*Mo+bo&en,Number(e)/Number(en))}var Z={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>Z.len(Z.sub(t,e)),norm:t=>{let e=Z.len(t);return e>1e-4?Z.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,n)=>({x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>Z.dist(t,e)<.5};function He(t,e,n,o){let r=Z.sub(e,t),i=Z.sub(o,n),l=r.x*i.y-r.y*i.x;if(Math.abs(l)<1e-4)return null;let f=Z.sub(n,t),a=(f.x*i.y-f.y*i.x)/l,p=(f.x*r.y-f.y*r.x)/l;return a>=.001&&a<=.999&&p>=.001&&p<=.999?{point:Z.add(t,Z.scale(r,a)),t:a,u:p}:null}function nn(t,e){let n=t.reduce((r,i)=>r+i,0);if(n<=0)return 0;let o=e()*n;for(let r=0;r<t.length;r++)if(o-=t[r],o<=0)return r;return t.length-1}var Eo=0,vo=1,Co=2,Ao=3;function dt(t,e,n,o){switch(t){case Eo:return{x:e*n,y:0};case vo:return{x:n,y:e*o};case Co:return{x:(1-e)*n,y:o};case Ao:return{x:0,y:(1-e)*o};default:return{x:e*n,y:0}}}function Oe(t,e,n){switch(t){case 0:return{x:0,y:0};case 1:return{x:e,y:0};case 2:return{x:e,y:n};case 3:return{x:0,y:n};default:return{x:0,y:0}}}function dn(t,e){return{x:t.p1.x+(t.p2.x-t.p1.x)*e,y:t.p1.y+(t.p2.y-t.p1.y)*e}}function Ne(t,e){let n=e.x-t.x,o=e.y-t.y,r=Math.atan2(o,n)*180/Math.PI;return r<0&&(r+=180),r>=180&&(r-=180),r}function Io(t,e,n,o,r,i,l){let a=(()=>{if(!l)return[0,1,2,3];switch(l.type){case"horizontal":return[1,3];case"vertical":return[0,2];case"grid":return t%2===0?[1,3]:[0,2];case"diagonal":return[0,1,2,3];case"radial":case"clustered":case"random":default:return[0,1,2,3]}})();if(l&&l.type==="radial"){let E=l.focalX*o,x=l.focalY*r;if(t<10||e.length===0||i()<.6){let u=[{edge:0,dist:x},{edge:1,dist:o-E},{edge:2,dist:r-x},{edge:3,dist:E}];u.sort((m,C)=>m.dist-C.dist);let M=i(),c=M<.5?u[0].edge:M<.8?u[1].edge:u[Math.floor(i()*4)].edge,h;return c===0||c===2?h=.1+E/o*.8+(i()-.5)*.3:h=.1+x/r*.8+(i()-.5)*.3,h=Math.max(.05,Math.min(.95,h)),{point:dt(c,h,o,r),type:"edge",edge:c,t:h}}}if(l&&l.type==="clustered"){let E=l.clusterX*o,x=l.clusterY*r,u=l.spread;if(t<15||i()<.7){let M=[{edge:0,weight:1+(1-Math.abs(x/r))*2},{edge:1,weight:1+E/o*2},{edge:2,weight:1+x/r*2},{edge:3,weight:1+(1-E/o)*2}],c=M.reduce((w,R)=>w+R.weight,0),h=i()*c,m=0;for(let w of M)if(h-=w.weight,h<=0){m=w.edge;break}let C;return m===0||m===2?C=E/o+(i()-.5)*u:C=x/r+(i()-.5)*u,C=Math.max(.05,Math.min(.95,C)),{point:dt(m,C,o,r),type:"edge",edge:m,t:C}}}let p=Math.max(.2,1-t*.015),v=l&&(l.type==="horizontal"||l.type==="vertical"||l.type==="grid");if(v||i()<p||e.length===0&&n.length===0){let E=v?0:l&&l.type==="diagonal"?.5:.15;if(i()<E){let u=Math.floor(i()*4);return{point:Oe(u,o,r),type:"corner",corner:u}}else{let u=a[Math.floor(i()*a.length)],M=l&&l.jitter?l.jitter/100:0,c=.05+i()*.9,h=Math.max(.05,Math.min(.95,c+(i()-.5)*M));return{point:dt(u,h,o,r),type:"edge",edge:u,t:h}}}else if(n.length>0&&i()<.35){let x=n[Math.floor(i()*n.length)];return{point:{x:x.x,y:x.y},type:"intersection",intersectionIndex:n.indexOf(x)}}else if(e.length>0){let x=e[Math.floor(i()*e.length)],u=.1+i()*.8;return{point:dn(x,u),type:"crease",creaseIndex:e.indexOf(x),t:u}}else{let x=a[Math.floor(i()*a.length)],u=.05+i()*.9;return{point:dt(x,u,o,r),type:"edge",edge:x,t:u}}}function wo(t,e,n,o,r,i,l,f,a){let p=Math.min(r,i)*.15,v=c=>c===0||c===2,b=c=>c===1||c===3;if(a&&(a.type==="horizontal"||a.type==="vertical"||a.type==="grid")){let c=a.type==="horizontal"||a.type==="grid"&&e%2===0;if(t.type==="edge"){let h=(t.edge+2)%4,m=b(t.edge);if(c&&m||!c&&!m){let C=a.jitter?a.jitter/100:0,w=t.t!==void 0?t.t:.5,R=Math.max(.05,Math.min(.95,w+(l()-.5)*C));return R=1-R,{point:dt(h,R,r,i),type:"edge",edge:h}}}}if(a&&a.type==="diagonal"){let c=a.angle||(l()<.5?45:135);if(t.type==="corner"){let h=(t.corner+2)%4;return{point:Oe(h,r,i),type:"corner"}}else if(t.type==="edge"){let h=a.jitter?(l()-.5)*a.jitter:0,m=(c+h)*Math.PI/180,C=t.point.x,w=t.point.y,R=Math.cos(m),S=Math.sin(m),T=null,k=0,Y=[{edge:0,y:0},{edge:2,y:i},{edge:3,x:0},{edge:1,x:r}];for(let $ of Y){let B=null;if($.y!==void 0){let s=($.y-w)/S;if(s>0){let K=C+R*s;K>=0&&K<=r&&(B={x:K,y:$.y})}}else{let s=($.x-C)/R;if(s>0){let K=w+S*s;K>=0&&K<=i&&(B={x:$.x,y:K})}}if(B){let s=Z.dist(t.point,B);s>k&&s>=p&&(k=s,T=B)}}if(T)return{point:T,type:"edge"}}}if(a&&a.type==="radial"){let c=a.focalX*r,h=a.focalY*i,m={x:c,y:h},C=t.point.x-c,w=t.point.y-h,R=Math.sqrt(C*C+w*w);if(R>0){let S=C/R,T=w/R,k=1/0;S>0&&(k=Math.min(k,(r-t.point.x)/S)),S<0&&(k=Math.min(k,-t.point.x/S)),T>0&&(k=Math.min(k,(i-t.point.y)/T)),T<0&&(k=Math.min(k,-t.point.y/T));let Y={x:Math.max(0,Math.min(r,t.point.x+S*k*.95)),y:Math.max(0,Math.min(i,t.point.y+T*k*.95))};if(Z.dist(t.point,Y)>=p)return{point:Y,type:"edge"}}}if(a&&a.type==="clustered"){let c=a.clusterX*r,h=a.clusterY*i,m={x:c,y:h},C=[];for(let R=0;R<4;R++)for(let S=0;S<3;S++){let T=.1+l()*.8,k=dt(R,T,r,i),Y=Ro(m,t.point,k),$=Math.max(r,i)*.5,B=Math.max(.1,1-Y/$)*3;C.push({point:k,type:"edge",edge:R,weight:B})}let w=C.filter(R=>Z.dist(t.point,R.point)>=p);if(w.length>0){let R=w.map(T=>T.weight),S=nn(R,l);return w[S]}}let E=[];if(t.type==="edge"){let c=(t.edge+2)%4,h=(t.edge+1)%4,m=(t.edge+3)%4,C=e<3?3:1.5;for(let R=0;R<3;R++){let S=.1+l()*.8;E.push({point:dt(c,S,r,i),type:"edge",edge:c,weight:C})}let w=1;for(let R=0;R<2;R++){let S=.1+l()*.8;E.push({point:dt(h,S,r,i),type:"edge",edge:h,weight:w}),E.push({point:dt(m,S,r,i),type:"edge",edge:m,weight:w})}}else if(t.type==="corner"){let c=(t.corner+2)%4;E.push({point:Oe(c,r,i),type:"corner",weight:2});for(let h=0;h<4;h++)if(!(h===t.corner||h===(t.corner+3)%4)){let C=.2+l()*.6;E.push({point:dt(h,C,r,i),type:"edge",edge:h,weight:1.5})}}else{for(let c=0;c<4;c++){let h=.1+l()*.8;E.push({point:dt(c,h,r,i),type:"edge",edge:c,weight:1})}if(n.length>1&&e>3)for(let c=0;c<Math.min(3,n.length);c++){let h=Math.floor(l()*n.length),m=n[h];if(t.type==="crease"&&t.creaseIndex===h)continue;let C=.15+l()*.7;E.push({point:dn(m,C),type:"crease",creaseIndex:h,weight:.6})}}if(n.length>0&&f)for(let c of E){let h=Ne(t.point,c.point);for(let m of n){let C=Ne(m.p1,m.p2),w=Math.abs(h-C);w>90&&(w=180-w),f.parallel>0&&w<15&&(c.weight*=1+f.parallel),f.perpendicular>0&&w>75&&(c.weight*=1+f.perpendicular)}}let x=E.filter(c=>Z.dist(t.point,c.point)>=p);if(x.length===0){for(let h=0;h<4;h++){let C=dt(h,.5,r,i);if(Z.dist(t.point,C)>=p)return{point:C,type:"edge",edge:h}}let c=t.type==="edge"?(t.edge+2)%4:0;return{point:dt(c,.5,r,i),type:"edge",edge:c}}let u=x.map(c=>c.weight),M=nn(u,l);return x[M]}function Ro(t,e,n){let o=n.x-e.x,r=n.y-e.y,i=o*o+r*r;if(i===0)return Z.dist(t,e);let l=((t.x-e.x)*o+(t.y-e.y)*r)/i;l=Math.max(0,Math.min(1,l));let f={x:e.x+l*o,y:e.y+l*r};return Z.dist(t,f)}function To(t){let e=[];for(let n=0;n<t.length;n++)for(let o=n+1;o<t.length;o++){let r=He(t[n].p1,t[n].p2,t[o].p1,t[o].p2);r&&e.push({x:r.point.x,y:r.point.y,crease1:n,crease2:o})}return e}function Be(t,e,n,o,r={min:0,max:1},i=null,l=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let f=i||ln(o),a=sn(o),p=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],v=[],b=null,E=null;if(!n||n<=0)return{creases:[],finalShape:p,maxFolds:a,firstFoldTarget:null,lastFoldTarget:null};let x=D(o),u=D(o+8888),M=D(o+6666),c=l||{absorbency:1,intersectionThreshold:0,angleAffinity:null,affinityStrength:0,ceilingMultiplier:1},h=[],m=D(o+1111);for(let T=0;T<a;T++)h[T]=.001+m()*.25;let C=D(o+2222),w={parallel:C()*.8,perpendicular:C()*.8},R=Math.max(t,e)*.05,S=[];for(let T=0;T<n;T++){let k=T%a,Y=Math.floor(T/a);if(k===0&&Y>0)for(let O of v)O.reductionMultiplier!==void 0&&(O.weight=Math.max(.01,O.weight*O.reductionMultiplier));T%5===0&&v.length>1&&(S=To(v));let $=Io(T,v,S,t,e,x,f),B=wo($,T,v,S,t,e,x,w,f),s=$.point,K=B.point,et=M()<c.absorbency,pt=r.min+u()*(r.max-r.min);if(c.angleAffinity!==null&&c.affinityStrength>0){let O=Ne(s,K),X=Math.abs(O-c.angleAffinity);X>90&&(X=180-X);let gt=1-X/90*c.affinityStrength;pt*=gt}if(et&&pt>.01&&(v.push({p1:Z.copy(s),p2:Z.copy(K),depth:v.length,weight:pt,cyclePosition:k,reductionMultiplier:h[k],anchorType:$.type,terminusType:B.type}),v.length>1)){let O=v[v.length-1];for(let X=0;X<v.length-1;X++){let gt=He(O.p1,O.p2,v[X].p1,v[X].p2);gt&&S.push({x:gt.point.x,y:gt.point.y,crease1:X,crease2:v.length-1})}}let ft=Z.mid(s,K),z={x:Math.max(R,Math.min(t-R,ft.x)),y:Math.max(R,Math.min(e-R,ft.y))};T===0&&b===null&&(b=z),E=z}return{creases:v,finalShape:p,maxFolds:a,firstFoldTarget:b,lastFoldTarget:E}}function Lo(t){let e=[];for(let n=0;n<t.length;n++)for(let o=n+1;o<t.length;o++){let r=He(t[n].p1,t[n].p2,t[o].p1,t[o].p2);if(r){let i=t[n].weight||1,l=t[o].weight||1;e.push({x:r.point.x,y:r.point.y,depth1:t[n].depth,depth2:t[o].depth,gap:Math.abs(t[o].depth-t[n].depth),weight:i+l})}}return e}function pn(t,e,n,o,r,i=null,l=null){let f=Lo(t),a=l||{intersectionThreshold:0,ceilingMultiplier:1},p=f.filter(c=>c.weight>=a.intersectionThreshold),v={},b={},E={};for(let c of p){let h=Math.floor(c.x/o),m=Math.floor(c.y/r);if(h>=0&&h<e&&m>=0&&m<n){let C=`${h},${m}`;v[C]=(v[C]||0)+c.weight,b[C]=Math.max(b[C]||0,c.gap),E[C]=(E[C]||0)+1}}let u=e*n*.5*a.ceilingMultiplier,M=Object.values(v).reduce((c,h)=>c+h,0);if(M>u&&M>0){let c=u/M,h=c+(1-c)*.3;for(let m of Object.keys(v))v[m]*=h}return{activeCreases:t,intersections:p,cellWeights:v,cellMaxGap:b,cellIntersectionCounts:E,destroyed:0,maxFolds:i}}function ko({folds:t,seed:e,outputWidth:n,outputHeight:o,bgColor:r,textColor:i,accentColor:l,cellWidth:f,cellHeight:a,renderMode:p,showEmptyCells:v=!1,multiColor:b,levelColors:E,foldStrategy:x=null,paperProperties:u=null,padding:M=0,showCreases:c=!1,showPaperShape:h=!1,showFoldTargets:m=!1,showIntersections:C=!1,showGrid:w=!1,showHitCounts:R=!1,showCellOutlines:S=!1,showCreaseLines:T=!1,fontFamily:k=ne,linesOnlyMode:Y=!1,analyticsMode:$=!1}){let B=document.createElement("canvas"),s=B.getContext("2d"),K=2;B.width=n*K,B.height=o*K,s.setTransform(K,0,0,K,0,0),s.fillStyle=r,s.fillRect(0,0,n,o);let P=n/1200,et=o/1697,pt=1200-M*2-145*2,ft=1697-M*2-145*2;{let y=15*P;s.font=`${y}px ${k}`,s.fillStyle=i,s.globalAlpha=.1;let d=y*zt,L=y*1.13;for(let G=0;G<o+L;G+=L)for(let q=0;q<n+d;q+=d)s.fillText("\u2591",q,G+L);s.globalAlpha=1}let z=un(e,f,a,pt,ft),{cols:O,rows:X,strideX:gt,strideY:Ut,gridOffsetX:xe,gridOffsetY:me}=z,ye=z.cellWidth,Me=z.cellHeight,Ft=pt*P,Tt=ft*et,W=(M+145+xe)*P,N=(M+145+me)*et,Mt=ye*P,At=Me*et,bt=gt*P,it=Ut*et,be=We(e),Kt=fn(u,O,X),Xe=z.actualGridWidth,It=z.actualGridHeight,{creases:Lt,finalShape:Dt,maxFolds:Gt,firstFoldTarget:wt,lastFoldTarget:_}=Be(Xe,It,t,e,be,x,Kt),vt=Lt.map(g=>({...g,p1:{x:g.p1.x*P,y:g.p1.y*et},p2:{x:g.p2.x*P,y:g.p2.y*et}})),xt=null;if(wt){let g=Math.max(0,Math.min(O-1,Math.floor(wt.x/gt))),y=Math.max(0,Math.min(X-1,Math.floor(wt.y/Ut)));xt=`${g},${y}`}let Vt=null;if(_){let g=Math.max(0,Math.min(O-1,Math.floor(_.x/gt))),y=Math.max(0,Math.min(X-1,Math.floor(_.y/Ut)));Vt=`${g},${y}`}let{activeCreases:j,intersections:tt,cellWeights:nt,cellMaxGap:ot}=pn(vt,O,X,bt,it,Gt,u),H=new Set;if(Object.keys(ot).length>0){let g=Math.max(...Object.values(ot));for(let[y,d]of Object.entries(ot))d===g&&H.add(y)}let oe=1+ue+he,Ot=At/oe;s.font=`${Ot}px ${k}`,s.textBaseline="top";let kt=[" ","\u2591","\u2592","\u2593"],qt=Ot<30?2:3,ut=Ot*zt,yn=Ot*ue,Mn=Ot*he,nr=Ot*$n,bn=Ot*jn,Wt=hn(nt),re=D(e+22222)(),Ht;re<.6?Ht=0:re<.8?Ht=1:re<.9?Ht=2:re<.97?Ht=3:Ht=5;let ie=D(e+33333),Bt=ie(),st;Bt<.22?st="ltr":Bt<.44?st="rtl":Bt<.65?st="center":Bt<.8?st="alternate":Bt<.9?st="diagonal":Bt<.96?st="randomMid":st="checkerboard";let En=ie()<.5,vn=Math.floor(ie()*O),Cn=ie()<.5,lt=D(e+11111),Ee=lt()>=.65,An=(()=>{if(!Ee)return 1;let g=lt();return g<.1?.95:g<.2?.75:g<.3?.65:g<.6?.5:g<.8?.25:.05})(),In=Ee?Math.floor(lt()*5):0,at=[.95,.75,.5,.25,.05],Ye=at.indexOf(An),mt=Math.floor(lt()*3)+1,St=Math.floor(lt()*3),ve=Math.floor(lt()*4)+1,Ce=[],Ae=[],$e=[],wn=.3+lt()*.4,Rn=.3+lt()*.4,Tn=.3+lt()*.4;for(let g=0;g<20;g++)Ce.push(lt()<wn),Ae.push(lt()<Rn),$e.push(lt()<Tn);let Ln=Math.floor(lt()*2),kn=lt()<.1,Sn=(g,y)=>{if(!Ee)return 1;let d=Ye===-1?0:Ye;switch(In){case 1:St===1?Ce[g%20]&&(d=(d+mt)%at.length):St===2?d=(d+g%3*mt)%at.length:d=(d+Math.floor(g/ve)*mt)%at.length;break;case 2:St===1?Ae[y%20]&&(d=(d+mt)%at.length):St===2?d=(d+y%3*mt)%at.length:d=(d+Math.floor(y/ve)*mt)%at.length;break;case 3:if(St===1){let L=Ce[g%20],G=Ae[y%20];(Ln===0?L||G:L!==G)&&(d=(d+mt)%at.length)}else St===2?d=(d+(g+y)%3*mt)%at.length:d=(d+(g+y)%2*mt)%at.length;break;case 4:if(St===1){let L=(g+y)%20;$e[L]&&(d=(d+mt)%at.length)}else St===2?d=(d+(g+y)%4*mt)%at.length:d=(d+Math.floor((g+y)/ve)*mt)%at.length;break;default:break}return at[d]},Pt=(g,y)=>E&&E.length>0?E[Math.min(g,3)]:i,Jt=D(e+22222),Ie=Jt()<.25,Fn=Math.round(2+Jt()*2)*P,Dn=Math.round(1+Jt()*2)*et,Gn=Ie?.4+Jt()*.3:0,On=(g,y)=>{let d=D(e+22222+g*1e3+y),L=Math.floor(d()*3);return{x:L!==1?Fn:0,y:L!==0?Dn:0}},Nn=Ie?(()=>{if(l&&l!==i)return l;let g=Ge(i),y=Q.filter(G=>G.hex!==i&&G.hex!==r&&qn(G,g)>100),d=Math.floor(Jt()*y.length);return(y.length>0?y[d]:Q[0]).hex})():null,je=(M+145)*P,we=(M+145)*et,Re=je+bn,_n=we+yn,Te=je+Ft,sr=we+Tt-Mn;if(Y){let g=I=>{let F=parseInt(I.slice(1,3),16),rt=parseInt(I.slice(3,5),16),V=parseInt(I.slice(5,7),16);return Ve(F,rt,V)},y=g(r),d=g(i),L=g(l),G=Math.abs(y-d)>Math.abs(y-L)?i:l,q=2*P;if(j.length>0){s.strokeStyle=G,s.lineWidth=q,s.globalAlpha=1,s.lineCap="round";for(let I of j)s.beginPath(),s.moveTo(W+I.p1.x,N+I.p1.y),s.lineTo(W+I.p2.x,N+I.p2.y),s.stroke()}if(tt&&tt.length>0){s.strokeStyle=G,s.lineWidth=q,s.globalAlpha=1;let I=4*P;for(let F of tt)s.beginPath(),s.arc(W+F.x,N+F.y,I,0,Math.PI*2),s.stroke()}s.globalAlpha=1}else if($){let g=2*P;s.strokeStyle=l,s.lineWidth=1,s.globalAlpha=.4;for(let d=0;d<=O;d++){let L=W+d*bt;s.beginPath(),s.moveTo(L,N),s.lineTo(L,N+Tt),s.stroke()}for(let d=0;d<=X;d++){let L=N+d*it;s.beginPath(),s.moveTo(W,L),s.lineTo(W+Ft,L),s.stroke()}if(s.globalAlpha=1,j.length>0){s.strokeStyle=l,s.lineWidth=g,s.globalAlpha=1,s.lineCap="round";for(let d of j)s.beginPath(),s.moveTo(W+d.p1.x,N+d.p1.y),s.lineTo(W+d.p2.x,N+d.p2.y),s.stroke()}if(tt&&tt.length>0){s.strokeStyle=l,s.lineWidth=g,s.globalAlpha=1;let d=4*P;for(let L of tt)s.beginPath(),s.arc(W+L.x,N+L.y,d,0,Math.PI*2),s.stroke()}let y=Math.floor(Math.min(Mt*.45,At*.7));s.font=`bold ${y}px monospace`,s.textAlign="center",s.textBaseline="middle",s.fillStyle=l;for(let d=0;d<X;d++)for(let L=0;L<O;L++){let G=Math.round(W+L*bt+Mt/2),q=Math.round(N+d*it+At/2),I=`${L},${d}`,F=nt[I]||0;s.fillText(Math.round(F).toString(),G,q)}s.textAlign="left",s.textBaseline="top"}else if(R){let g=Math.floor(Math.min(Mt*.45,At*.7));s.font=`bold ${g}px monospace`,s.textAlign="center",s.textBaseline="middle",s.fillStyle=i;for(let y=0;y<X;y++)for(let d=0;d<O;d++){let L=Math.round(W+d*bt+Mt/2),G=Math.round(N+y*it+At/2),q=`${d},${y}`,I=nt[q]||0;s.fillText(Math.round(I).toString(),L,G)}s.textAlign="left",s.textBaseline="top"}else{let g=Math.max(W,Re),y=Math.max(N,_n);for(let d=0;d<X;d++){let L=Math.round(y+d*it);if(!(L>we+Tt))for(let G=0;G<O;G++){let q=Math.round(g+G*bt),I=`${G},${d}`,F=nt[I]||0,rt=null,V=i,U=-1,Xt=!1;if(xt===I)U=F>0?Et(F,Wt):2,rt=kt[Math.min(Math.max(U,2),qt)],V=l;else if(p==="normal")if(U=Et(F,Wt),U===0?rt=null:rt=kt[Math.min(U,qt)],V=Pt(U,I),F>=1.5){let Yt=F-1.5,Nt=30+Math.min(Yt*300,150),ct=Fe(i);V=Se((ct.h+Nt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else H.has(I)&&F>0?V=l:Vt===I&&(V=i);else if(p==="binary")F===0?v&&(rt=kt[1],U=0,Xt=!0,V=i):(U=qt,rt=kt[U],V=Pt(U,I),H.has(I)&&(V=l));else if(p==="inverted")if(U=Math.min(3-Et(F,Wt),qt),rt=kt[U],V=Pt(U,I),F>=1.5){let Yt=F-1.5,Nt=30+Math.min(Yt*300,150),ct=Fe(i);V=Se((ct.h+Nt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else H.has(I)&&F>0&&(V=l);else if(p==="sparse")U=Et(F,Wt),U===1?(rt=kt[1],V=Pt(1,I),H.has(I)&&(V=l)):rt=null;else if(p==="dense")if(U=Et(F,Wt),U>=2)if(rt=kt[Math.min(U,qt)],V=Pt(U,I),F>=1.5){let Yt=F-1.5,Nt=30+Math.min(Yt*300,150),ct=Fe(i);V=Se((ct.h+Nt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else H.has(I)&&(V=l);else rt=null;if(rt){if(xt===I||Vt===I)s.fillStyle=V;else{let J=Pt(Et(F,Wt),I);s.fillStyle=H.has(I)&&F>0?l:J}Xt&&(s.globalAlpha=.1,s.fillStyle=i);let Yt=s.measureText(rt).width,Nt=q+Mt,ct=Math.min(Nt,Te),Qt=ct-q;if(Qt<ut*.5)continue;let Hn=Xt||F===0&&p!=="inverted",Le=p==="inverted"&&F===0&&kn,Bn=Hn||Le?1:Sn(d,G),ze=ut*Bn,ke=Math.max(1,Math.floor((Qt-ut)/ze)+1),Pn=(ke-1)*ze+ut,Rt=(Qt-Pn)/ut>.3?ke+1:ke,_t=Rt<=1?ut:(Qt-ut)/(Rt-1),Ue=Xt||Le?0:Ht*Mt,Ke=0;Ue>0&&(Ke=Math.ceil(Ue/_t));let Xn=Le?1:Rt+Ke,Ct;if(st==="ltr")Ct="ltr";else if(st==="rtl")Ct="rtl";else if(st==="center")Ct="center";else if(st==="alternate")Ct=d%2===1!==En?"rtl":"ltr";else if(st==="diagonal"){let J=(vn+(Cn?d:-d)+O*100)%O;Ct=G<J?"ltr":"rtl"}else if(st==="randomMid"){let J=D(e+55555+d),Zt=Math.floor(J()*O);Ct=G<Zt?"ltr":"rtl"}else st==="checkerboard"?Ct=(d+G)%2===0?"ltr":"rtl":Ct="ltr";let se=q+Qt/2;for(let J=0;J<Xn&&U>=0;J++){let Zt=rt;U>=2&&J>0&&J%2===0&&(Zt=kt[Math.max(0,U-1)]);let ht;if(Ct==="center")if(J<Rt){let yt=Math.floor((J+1)/2)*_t;J%2===0?ht=se+(J===0?-ut/2:yt-ut/2):ht=se-yt-ut/2}else{let yt=J-Rt,le=Math.floor(Rt/2)*_t,ae=Math.floor((yt+1)/2)*_t;if(yt%2===0){if(ht=se+le+ae,ht+ut>Te)break}else if(ht=se-le-ae-ut,ht<Re)break}else if(J<Rt)ht=q+J*_t;else if(Ct==="rtl"){let yt=J-Rt;if(ht=q-(yt+1)*_t,ht<Re)break}else{let yt=J-Rt;if(ht=ct+yt*_t,ht+ut>Te)break}if(Ie&&!Xt){let yt=On(d,G),le=s.globalAlpha,ae=s.fillStyle;s.globalAlpha=Gn,s.fillStyle=Nn,s.fillText(Zt,ht+yt.x,L+yt.y),s.globalAlpha=le,s.fillStyle=ae}s.fillText(Zt,ht,L)}Xt&&(s.globalAlpha=1)}}}}if(S){s.strokeStyle=l,s.lineWidth=.5,s.globalAlpha=1;for(let g=0;g<X;g++)for(let y=0;y<O;y++){let d=Math.round(W+y*bt),L=Math.round(N+g*it);s.strokeRect(d,L,Mt,At)}}if(T&&j.length>0){let y=D(e+9292)()<.6;s.strokeStyle=y?l:i,s.lineWidth=1.5*P,s.globalAlpha=.85,s.lineCap="round";for(let d of j)s.beginPath(),s.moveTo(W+d.p1.x,N+d.p1.y),s.lineTo(W+d.p2.x,N+d.p2.y),s.stroke();s.globalAlpha=1}if(c){let g=I=>{let F=parseInt(I.slice(1,3),16),rt=parseInt(I.slice(3,5),16),V=parseInt(I.slice(5,7),16);return Ve(F,rt,V)},y=g(r),d=g(i),L=g(l),G=Math.abs(y-d)>Math.abs(y-L)?i:l,q=2*P;s.strokeStyle=G,s.lineWidth=q,s.globalAlpha=1,s.lineCap="round";for(let I of j)s.beginPath(),s.moveTo(W+I.p1.x,N+I.p1.y),s.lineTo(W+I.p2.x,N+I.p2.y),s.stroke();if(tt&&tt.length>0){s.strokeStyle=G,s.lineWidth=q,s.globalAlpha=1;let I=4*P;for(let F of tt)s.beginPath(),s.arc(W+F.x,N+F.y,I,0,Math.PI*2),s.stroke()}}if(h){let g=Dt.map(y=>({x:y.x*P,y:y.y*et}));if(g.length>=3){s.strokeStyle="#00ffff",s.lineWidth=2,s.globalAlpha=.9,s.beginPath(),s.moveTo(W+g[0].x,N+g[0].y);for(let y=1;y<g.length;y++)s.lineTo(W+g[y].x,N+g[y].y);s.closePath(),s.stroke(),s.fillStyle="#00ffff",s.globalAlpha=.15,s.fill(),s.globalAlpha=1}}if(w){s.strokeStyle=i,s.lineWidth=1,s.globalAlpha=.3;for(let g=0;g<=O;g++){let y=W+g*bt;s.beginPath(),s.moveTo(y,N),s.lineTo(y,N+Tt),s.stroke()}for(let g=0;g<=X;g++){let y=N+g*it;s.beginPath(),s.moveTo(W,y),s.lineTo(W+Ft,y),s.stroke()}s.globalAlpha=1}if(m){let g=8*P;if(s.lineWidth=2,s.globalAlpha=1,wt){let y=W+wt.x*P,d=N+wt.y*et;s.strokeStyle="#00ff00",s.beginPath(),s.arc(y,d,g,0,Math.PI*2),s.stroke()}if(_){let y=W+_.x*P,d=N+_.y*et;s.strokeStyle="#00ff00",s.beginPath(),s.arc(y,d,g,0,Math.PI*2),s.stroke()}}let Wn={grid:{cols:O,rows:X,colGap:z.colGap,rowGap:z.rowGap},drawDirection:st,foldStrategy:x?.type||"random",multiColor:b,showCreaseLines:T,creaseCount:Lt.length};return{canvas:B,dataUrl:B.toDataURL("image/png"),settings:Wn}}function Pe(t,e=1200,n=1697,o=0,r=null){let i=We(t),l=ln(t),f=sn(t),a=mo(t),p=r;if(p===null){let B=D(t+9999);p=Math.floor(1+B()*500)}let v=e-145*2,b=n-145*2,{creases:E}=Be(v,b,p,t,i,l,a),x=E.length,u=an(x),M=fo(t,x),c=oo(t),h,m=null;M?(m=uo(t),h=ho(t,c,m)):h=c;let C=M?!1:co(t),w=null;M?w=po(h.bg,h.text):C&&(w=ao(t,h.bg,h.text));let R=ro(e,n,0,t),S=io(t),T=so(t),k=go(t),Y=xo(t),$=lo(t);return{seed:t,palette:h,cells:R,renderMode:S,showEmptyCells:T,weightRange:i,foldStrategy:l,gradientMode:M,gradientProbability:u,creaseCount:x,multiColor:C,levelColors:w,maxFolds:f,paperProperties:a,showCreaseLines:k,analyticsMode:Y,overlapInfo:$,folds:p}}function So(t,e,n,o=""){let r=Pe(e,1200,1697,0,n),i=yo(r.paperProperties),l=Math.round(r.gradientProbability*100),f;return r.gradientMode?f=`gradient/${r.palette.anchorType||"background"} (${l}% @ ${r.creaseCount} creases)`:f=`cga/${r.palette.strategy} (${l}% gradient @ ${r.creaseCount} creases)`,{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:o?`${o}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:r.foldStrategy.type},{trait_type:"Render Mode",value:r.renderMode},{trait_type:"Multi-Color",value:r.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${r.cells.cellW}x${r.cells.cellH}`},{trait_type:"Fold Count",value:n},{trait_type:"Max Folds",value:r.maxFolds},{trait_type:"Crease Count",value:r.creaseCount},{trait_type:"Palette Strategy",value:f},{trait_type:"Paper Type",value:i},{trait_type:"Paper Grain",value:r.paperProperties.angleAffinity!==null?"Grain":"Uniform"},...r.showCreaseLines?[{trait_type:"Crease Lines",value:"Visible"}]:[]]}}async function Fo(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${ee}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${ee}`),await document.fonts.ready,!0}catch(n){return console.warn("Failed to load on-chain font:",n),!1}}function Do(t){if(typeof t=="number")return t;if(typeof t!="string")return 0;let e=t.replace(/^0x/,"").slice(0,16),n=BigInt("0x"+e);return Number(n%BigInt(2147483647))}var fe=null;function Go(t,e,n){let{seed:o,foldCount:r,params:i}=t,{palette:l,cells:f,renderMode:a,showEmptyCells:p,multiColor:v,levelColors:b,foldStrategy:E,paperProperties:x}=i,{cellW:u,cellH:M}=f,{bg:c,text:h,accent:m}=l,C=e/1200,w=n/1697,R=1200-145*2,S=1697-145*2,T=un(o,u,M,R,S),{cols:k,rows:Y,strideX:$,strideY:B,gridOffsetX:s,gridOffsetY:K}=T,P=T.cellWidth,et=T.cellHeight,pt=(145+s)*C,ft=(145+K)*w,z=P*C,O=et*w,X=$*C,gt=B*w,Ut=We(o),xe=fn(x,k,Y),me=T.actualGridWidth,ye=T.actualGridHeight,{creases:Me,firstFoldTarget:Ft,lastFoldTarget:Tt}=Be(me,ye,r,o,Ut,E,xe),W=Me.map(_=>({..._,p1:{x:_.p1.x*C,y:_.p1.y*w},p2:{x:_.p2.x*C,y:_.p2.y*w}})),N=null;if(Ft){let _=Math.max(0,Math.min(k-1,Math.floor(Ft.x/$))),vt=Math.max(0,Math.min(Y-1,Math.floor(Ft.y/B)));N=`${_},${vt}`}let Mt=null;if(Tt){let _=Math.max(0,Math.min(k-1,Math.floor(Tt.x/$))),vt=Math.max(0,Math.min(Y-1,Math.floor(Tt.y/B)));Mt=`${_},${vt}`}let{cellWeights:At,cellMaxGap:bt}=pn(W,k,Y,X,gt,r,x),it=new Set;if(Object.keys(bt).length>0){let _=Math.max(...Object.values(bt));for(let[vt,xt]of Object.entries(bt))xt===_&&it.add(vt)}let be=1+ue+he,Kt=O/be,Xe=Kt*zt,It=[" ","\u2591","\u2592","\u2593"],Lt=Kt<30?2:3,Dt=hn(At),Gt=(_,vt)=>v&&b&&b[_]?b[_]:h,wt=[];for(let _=0;_<Y;_++){let vt=ft+_*gt;for(let xt=0;xt<k;xt++){let Vt=pt+xt*X,j=`${xt},${_}`,tt=At[j]||0,nt=null,ot=h,H=-1,oe=!1;N===j?(H=tt>0?Et(tt,Dt):2,nt=It[Math.min(Math.max(H,2),Lt)],ot=m):a==="normal"?(H=Et(tt,Dt),H===0?nt=null:nt=It[Math.min(H,Lt)],ot=Gt(H,j),it.has(j)&&tt>0?ot=m:Mt===j&&(ot=h)):a==="binary"?tt===0?p&&(nt=It[1],oe=!0,ot=h):(H=Lt,nt=It[H],ot=Gt(H,j),it.has(j)&&(ot=m)):a==="inverted"?(H=Math.min(3-Et(tt,Dt),Lt),nt=It[H],ot=Gt(H,j),it.has(j)&&tt>0&&(ot=m)):a==="sparse"?(H=Et(tt,Dt),H===1?(nt=It[1],ot=Gt(1,j),it.has(j)&&(ot=m)):nt=null):a==="dense"&&(H=Et(tt,Dt),H>=2?(nt=It[Math.min(H,Lt)],ot=Gt(H,j),it.has(j)&&(ot=m)):nt=null),!(!nt||nt===" ")&&(oe||wt.push({id:`char-${_}-${xt}`,char:nt,x:Vt,y:vt,width:z,height:O,fontSize:Kt,color:ot,row:_,col:xt,level:H,isAccent:it.has(j),isFoldTarget:N===j||Mt===j}))}}return{characters:wt,background:{color:c,textureColor:h,textureOpacity:.1},grid:{cols:k,rows:Y,cellWidth:z,cellHeight:O,offsetX:pt,offsetY:ft}}}function Oo(t,e){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>t.apply(this,o),e)}}var A={charData:null,charElements:[],textBuffer:[],originalPositions:new Map,cursorIndex:-1,isEditing:!1,dragState:null,hiddenInput:null,container:null,bgCanvas:null,charLayer:null,loading:null},No=`
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    overflow: hidden;
  }
  .fold-container {
    position: relative;
    width: min(100vw, calc(100vh * 1200 / 1697));
    height: min(100vh, calc(100vw * 1697 / 1200));
  }
  .fold-loading {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #fff;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "Courier New", monospace;
    font-size: 24px;
    color: #000;
  }
  .fold-bg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
  }
  .fold-chars {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    overflow: hidden;
  }
  .fold-char {
    position: absolute;
    cursor: default;
    user-select: none;
    font-family: "${ee}", "Courier New", monospace;
    line-height: 1;
    white-space: pre;
  }
  .fold-char:hover { filter: brightness(1.1); }
  .fold-char.dragging {
    cursor: grabbing;
    z-index: 1000;
    filter: brightness(1.2);
  }
  .fold-char.editing::after {
    content: '';
    position: absolute;
    left: 0;
    top: 10%;
    width: 2px;
    height: 80%;
    background: currentColor;
    animation: cursor-blink 1s step-end infinite;
  }
  @keyframes cursor-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
`;function _o(){if(document.getElementById("fold-interactive-css"))return;let t=document.createElement("style");t.id="fold-interactive-css",t.textContent=No,document.head.appendChild(t)}function Wo(){let t=document.createElement("div");t.className="fold-container",t.id="fold-container",t.style.cssText="position:relative;width:min(100vw,calc(100vh*1200/1697));height:min(100vh,calc(100vw*1697/1200))";let e=document.createElement("div");e.className="fold-loading",e.id="fold-loading",e.textContent="\u2592",e.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;background:#fff;z-index:100;display:flex;align-items:center;justify-content:center;font-family:Courier New,monospace;font-size:24px;color:#000";let n=document.createElement("canvas");n.className="fold-bg",n.id="fold-bg";let o=document.createElement("div");return o.className="fold-chars",o.id="fold-chars",t.appendChild(e),t.appendChild(n),t.appendChild(o),document.body.appendChild(t),A.container=t,A.bgCanvas=n,A.charLayer=o,A.loading=e,{container:t,bgCanvas:n,charLayer:o,loading:e}}function Ho(t,e,n,o){let r=t.getContext("2d"),i=window.devicePixelRatio||2;t.width=n*i,t.height=o*i,t.style.width=n+"px",t.style.height=o+"px",r.setTransform(i,0,0,i,0,0),r.fillStyle=e.color,r.fillRect(0,0,n,o);let f=15*(n/1200);r.font=`${f}px ${ne}`,r.fillStyle=e.textureColor,r.globalAlpha=e.textureOpacity;let a=f*zt,p=f*1.13;for(let v=0;v<o+p;v+=p)for(let b=0;b<n+a;b+=a)r.fillText("\u2591",b,v+p);r.globalAlpha=1}function Bo(t,e){ge(),t.innerHTML="",A.charElements=[],A.originalPositions.clear(),A.textBuffer=[],A.hiddenInput=null;for(let o=0;o<e.length;o++){let r=e[o],i=document.createElement("span");i.className="fold-char",i.textContent=r.char,i.dataset.index=o,i.style.left=r.x+"px",i.style.top=r.y+"px",i.style.fontSize=r.fontSize+"px",i.style.color=r.color,i.style.width=r.width+"px",i.style.height=r.height+"px",A.originalPositions.set(o,{x:r.x,y:r.y,char:r.char}),A.textBuffer.push({char:r.char,originalChar:r.char,el:i,color:r.color}),t.appendChild(i),A.charElements.push(i)}let n=document.createElement("input");n.type="text",n.style.cssText="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;",n.addEventListener("input",Po),n.addEventListener("keydown",Xo),n.addEventListener("blur",Yo),t.appendChild(n),A.hiddenInput=n}function Po(t){let{isEditing:e,cursorIndex:n,textBuffer:o,hiddenInput:r}=A;if(!e||n<0)return;let i=t.data;if(!i)return;for(let f=0;f<i.length;f++){let a=n+f;if(a>=o.length)break;o[a].char=i[f],o[a].el.textContent=i[f]}let l=Math.min(n+i.length,o.length-1);l!==n&&(A.cursorIndex=l,te()),r.value=""}function Xo(t){let{isEditing:e,cursorIndex:n,textBuffer:o}=A;if(!e)return;if(t.key==="Escape"){ge();return}let r=()=>{if(n>=0&&n<o.length){let i=o[n];i.el.textContent=i.char}};t.key==="ArrowLeft"?(t.preventDefault(),n>0&&(r(),A.cursorIndex=n-1,te())):t.key==="ArrowRight"?(t.preventDefault(),n<o.length-1&&(r(),A.cursorIndex=n+1,te())):t.key==="Backspace"?(t.preventDefault(),o[n].char=o[n].originalChar,o[n].el.textContent=o[n].originalChar,n>0&&(A.cursorIndex=n-1,te())):t.key==="Delete"&&(t.preventDefault(),o[n].char=o[n].originalChar)}function Yo(){setTimeout(()=>{A.hiddenInput&&!A.hiddenInput.matches(":focus")&&ge()},100)}function te(){let{charElements:t,cursorIndex:e,hiddenInput:n,textBuffer:o}=A;if(t.forEach(r=>r.classList.remove("editing")),e>=0&&e<t.length){let r=o[e];r&&(r.el.textContent=""),t[e].classList.add("editing"),n&&(n.style.left=t[e].style.left,n.style.top=t[e].style.top)}}function $o(t){A.isEditing=!0,A.cursorIndex=t;let e=A.textBuffer[t];e&&(e.el.textContent=""),te(),A.hiddenInput&&A.hiddenInput.focus()}function ge(){let{cursorIndex:t,textBuffer:e,charElements:n}=A;if(t>=0&&t<e.length){let o=e[t];o&&o.el.textContent===""&&(o.el.textContent=o.char)}A.isEditing=!1,A.cursorIndex=-1,n.forEach(o=>o.classList.remove("editing","cursor")),A.hiddenInput&&A.hiddenInput.blur()}function jo(t){t.addEventListener("mousedown",zo),t.addEventListener("touchstart",Uo,{passive:!1}),document.addEventListener("mousemove",Ko),document.addEventListener("touchmove",Vo,{passive:!1}),document.addEventListener("mouseup",qo),document.addEventListener("touchend",Jo),t.addEventListener("dblclick",Qo)}function zo(t){let e=t.target.closest(".fold-char");e&&(t.preventDefault(),gn(e,t.clientX,t.clientY))}function Uo(t){let e=t.target.closest(".fold-char");if(!e)return;t.preventDefault();let n=t.touches[0];gn(e,n.clientX,n.clientY)}function gn(t,e,n){let o=t.getBoundingClientRect(),r=A.container.getBoundingClientRect();A.dragState={el:t,offsetX:e-o.left,offsetY:n-o.top,containerRect:r},t.classList.add("dragging")}function Ko(t){A.dragState&&xn(t.clientX,t.clientY)}function Vo(t){if(!A.dragState)return;t.preventDefault();let e=t.touches[0];xn(e.clientX,e.clientY)}function xn(t,e){let{el:n,containerRect:o,offsetX:r,offsetY:i}=A.dragState,l=t-o.left-r,f=e-o.top-i;n.style.left=l+"px",n.style.top=f+"px"}function qo(){mn()}function Jo(){mn()}function mn(){A.dragState&&(A.dragState.el.classList.remove("dragging"),A.dragState=null)}function Qo(t){let e=t.target.closest(".fold-char");if(!e)return;t.preventDefault();let n=parseInt(e.dataset.index,10);isNaN(n)||$o(n)}function Zo(t){let{charData:e,charElements:n,container:o}=A;if(!e||!o)return;let r=o.getBoundingClientRect(),i=r.width,l=r.height,f=window.devicePixelRatio||2,a=document.createElement("canvas");a.width=i*f,a.height=l*f;let p=a.getContext("2d");p.setTransform(f,0,0,f,0,0),p.fillStyle=e.background.color,p.fillRect(0,0,i,l);let b=15*(i/1200);p.font=`${b}px ${ne}`,p.fillStyle=e.background.textureColor,p.globalAlpha=e.background.textureOpacity;let E=b*zt,x=b*1.13;for(let u=0;u<l+x;u+=x)for(let M=0;M<i+E;M+=E)p.fillText("\u2591",M,u+x);p.globalAlpha=1,p.textBaseline="top";for(let u of n){let M=parseFloat(u.style.left),c=parseFloat(u.style.top),h=parseFloat(u.style.fontSize);p.font=`${h}px ${ne}`,p.fillStyle=u.style.color,p.fillText(u.textContent,M,c)}a.toBlob(u=>{let M=URL.createObjectURL(u),c=document.createElement("a");c.href=M,c.download=`fold-${t||"edit"}.png`,c.click(),URL.revokeObjectURL(M)},"image/png")}function tr(){ge();let{charElements:t,textBuffer:e,originalPositions:n}=A;for(let o=0;o<t.length;o++){let r=t[o],i=n.get(o);i&&(r.style.left=i.x+"px",r.style.top=i.y+"px",e[o]&&(e[o].char=i.char),r.textContent=i.char)}}function er(t){document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="s"){e.preventDefault(),Zo(t);return}A.isEditing||e.key==="Escape"&&(e.preventDefault(),tr())})}function on(t,e,n){let{bgCanvas:o,charLayer:r}=A,i=Go(t,e,n);A.charData=i,Ho(o,i.background,e,n),Bo(r,i.characters)}async function _e(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,n=typeof window<"u"&&window.LESS_SEED;if(n&&!t&&(t=Do(n)),t&&e===void 0){let r=D(t+9999);e=Math.floor(1+r()*500)}let o=typeof window<"u"&&window.FONT_DATA_URI||rn;if(t&&e!==void 0){await Fo(o),_o(),Wo();let r=Pe(t,1200,1697,0,e);fe={seed:t,foldCount:e,params:r};let l=A.container.getBoundingClientRect();on(fe,l.width,l.height),A.loading&&(A.loading.style.display="none"),jo(A.charLayer),er(t),typeof window<"u"&&(window.RENDER_COMPLETE=!0),window.addEventListener("resize",Oo(()=>{if(fe){let f=A.container.getBoundingClientRect();on(fe,f.width,f.height)}},150))}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0||window.LESS_SEED)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>_e()):_e());})();
