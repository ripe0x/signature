var At="FoldMono",Bt="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",ee='"Courier New", Courier, monospace',jt=`"${At}", ${ee}`,vt=[0,51,102,153,204,255];function Ut(t,e,n){return"#"+[t,e,n].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function kt(t,e,n){let r=t/255,o=e/255,s=n/255;return(.2126*r+.7152*o+.0722*s)*100}function Kt(t,e,n){let r=t-n;return Math.abs(r)<30&&Math.abs(t-e)<30&&Math.abs(e-n)<30?"neutral":r>0?"warm":"cool"}function $t(t,e,n){let r=Math.max(t,e,n),o=Math.min(t,e,n),s=r-o;return s<20?"gray":s<80?"muted":s<160?"chromatic":"vivid"}function ne(){let t=[];for(let e=0;e<6;e++)for(let n=0;n<6;n++)for(let r=0;r<6;r++){let o=vt[e],s=vt[n],l=vt[r];t.push({hex:Ut(o,s,l),r:o,g:s,b:l,cubePos:{ri:e,gi:n,bi:r},luminance:kt(o,s,l),temperature:Kt(o,s,l),saturation:$t(o,s,l),type:"websafe"})}return t}var oe=[{hex:"#000000",name:"black"},{hex:"#0000AA",name:"blue"},{hex:"#00AA00",name:"green"},{hex:"#00AAAA",name:"cyan"},{hex:"#AA0000",name:"red"},{hex:"#AA00AA",name:"magenta"},{hex:"#AA5500",name:"brown"},{hex:"#AAAAAA",name:"lightGray"},{hex:"#555555",name:"darkGray"},{hex:"#5555FF",name:"lightBlue"},{hex:"#55FF55",name:"lightGreen"},{hex:"#55FFFF",name:"lightCyan"},{hex:"#FF5555",name:"lightRed"},{hex:"#FF55FF",name:"lightMagenta"},{hex:"#FFFF55",name:"yellow"},{hex:"#FFFFFF",name:"white"}];function re(){return oe.map(t=>{let e=parseInt(t.hex.slice(1,3),16),n=parseInt(t.hex.slice(3,5),16),r=parseInt(t.hex.slice(5,7),16);return{hex:t.hex,r:e,g:n,b:r,cubePos:null,luminance:kt(e,n,r),temperature:Kt(e,n,r),saturation:$t(e,n,r),type:"cga",name:t.name}})}function se(){let t=[];for(let e=0;e<24;e++){let n=Math.round(e/23*255);t.push({hex:Ut(n,n,n),r:n,g:n,b:n,cubePos:null,luminance:kt(n,n,n),temperature:"neutral",saturation:"gray",type:"grayscale",grayIndex:e})}return t}var b=[...ne(),...re(),...se()],it={dark:b.filter(t=>t.luminance<30),midDark:b.filter(t=>t.luminance>=20&&t.luminance<50),mid:b.filter(t=>t.luminance>=40&&t.luminance<70),midLight:b.filter(t=>t.luminance>=55&&t.luminance<85),light:b.filter(t=>t.luminance>=70)},Pt={warm:b.filter(t=>t.temperature==="warm"),cool:b.filter(t=>t.temperature==="cool"),neutral:b.filter(t=>t.temperature==="neutral")},Ot={gray:b.filter(t=>t.saturation==="gray"),muted:b.filter(t=>t.saturation==="muted"),chromatic:b.filter(t=>t.saturation==="chromatic"),vivid:b.filter(t=>t.saturation==="vivid")},Fe=b.filter(t=>t.saturation==="vivid"||t.type==="cga"&&t.saturation!=="gray");function Mt(t,e){let n=t.r-e.r,r=t.g-e.g,o=t.b-e.b;return Math.sqrt(n*n*.3+r*r*.59+o*o*.11)}function dt(t,e){if(!t.cubePos)return[];let{ri:n,gi:r,bi:o}=t.cubePos;return b.filter(s=>{if(!s.cubePos)return!1;let l=Math.abs(s.cubePos.ri-n)+Math.abs(s.cubePos.gi-r)+Math.abs(s.cubePos.bi-o);return l>0&&l<=e})}function ae(t){if(!t.cubePos){let i=t.temperature==="warm"?"cool":t.temperature==="cool"?"warm":"neutral";return Pt[i]}let{ri:e,gi:n,bi:r}=t.cubePos,o=e<3?4:1,s=n<3?4:1,l=r<3?4:1;return b.filter(i=>i.cubePos?Math.abs(i.cubePos.ri-o)<=1&&Math.abs(i.cubePos.gi-s)<=1&&Math.abs(i.cubePos.bi-l)<=1:!1)}function ie(t,e,n){if(!t.cubePos||!e.cubePos)return qt(t,e,n);let r=[];for(let o=0;o<n;o++){let s=o/(n-1),l=Math.round(t.cubePos.ri+(e.cubePos.ri-t.cubePos.ri)*s),i=Math.round(t.cubePos.gi+(e.cubePos.gi-t.cubePos.gi)*s),a=Math.round(t.cubePos.bi+(e.cubePos.bi-t.cubePos.bi)*s),c=b.find(u=>u.cubePos&&u.cubePos.ri===l&&u.cubePos.gi===i&&u.cubePos.bi===a);c&&r.push(c)}return r}function qt(t,e,n){let r=t.luminance,o=e.luminance,s=[];for(let l=0;l<n;l++){let i=l/(n-1),a=r+(o-r)*i,c=b.filter(x=>x.temperature===t.temperature||x.temperature==="neutral"),u=c[0],g=Math.abs(u.luminance-a);for(let x of c){let p=Math.abs(x.luminance-a);p<g&&(g=p,u=x)}s.push(u)}return s}function K(t,e,n=4.5){let r=t.luminance/100,o=e.luminance/100,s=Math.max(r,o)+.05,l=Math.min(r,o)+.05;return s/l>=n}function R(t,e){return e[Math.floor(t()*e.length)]}function le(t,e,n){e/=100,n/=100;let r=e*Math.min(n,1-n),o=s=>{let l=(s+t/30)%12,i=n-r*Math.max(Math.min(l-3,9-l,1),-1);return Math.round(255*i).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}`}function ce(t){let e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,r=parseInt(t.slice(5,7),16)/255,o=Math.max(e,n,r),s=Math.min(e,n,r),l,i,a=(o+s)/2;if(o===s)l=i=0;else{let c=o-s;switch(i=a>.5?c/(2-o-s):c/(o+s),o){case e:l=((n-r)/c+(n<r?6:0))/6;break;case n:l=((r-e)/c+2)/6;break;case r:l=((e-n)/c+4)/6;break}}return{h:l*360,s:i*100,l:a*100}}function Ht(t,e=10){return b.filter(n=>n.hex!==t.hex&&Math.abs(n.luminance-t.luminance)<e&&(n.temperature!==t.temperature||n.saturation!==t.saturation))}function ue(t,e){let n=Math.round((t.r+e.r)/2),r=Math.round((t.g+e.g)/2),o=Math.round((t.b+e.b)/2),s=(t.luminance+e.luminance)/2,l=b[0],i=1/0;for(let a of b){let c=Math.sqrt(Math.pow(a.r-n,2)+Math.pow(a.g-r,2)+Math.pow(a.b-o,2)),u=Math.abs(a.luminance-s)*2,g=c+u;g<i&&(i=g,l=a)}return l}function Wt(t,e,n){let r=[];switch(e){case"value":{let o=t.luminance>50?-40:40,s=Math.max(5,Math.min(95,t.luminance+o));r=b.filter(l=>l.hex!==t.hex&&Math.abs(l.luminance-s)<20&&(l.temperature===t.temperature||l.temperature==="neutral"||t.temperature==="neutral")),r.sort((l,i)=>{let a=l.temperature===t.temperature?0:1,c=i.temperature===t.temperature?0:1;return a!==c?a-c:Math.abs(l.luminance-s)-Math.abs(i.luminance-s)});break}case"temperature":{let o=t.temperature==="warm"?"cool":t.temperature==="cool"||n()<.5?"warm":"cool";r=b.filter(s=>s.hex!==t.hex&&s.temperature===o&&Math.abs(s.luminance-t.luminance)<25),r.sort((s,l)=>Math.abs(s.luminance-t.luminance)-Math.abs(l.luminance-t.luminance));break}case"saturation":{let o=["gray","muted","chromatic","vivid"],s=o.indexOf(t.saturation),l=s<=1?["chromatic","vivid"]:["muted","gray"];r=b.filter(i=>i.hex!==t.hex&&l.includes(i.saturation)&&Math.abs(i.luminance-t.luminance)<30&&(i.temperature===t.temperature||i.temperature==="neutral")),r.sort((i,a)=>{let c=o.indexOf(i.saturation),u=o.indexOf(a.saturation);return Math.abs(u-s)-Math.abs(c-s)});break}case"complement":{r=ae(t),r.sort((o,s)=>Math.abs(s.luminance-t.luminance)-Math.abs(o.luminance-t.luminance));break}case"neighbor":{t.cubePos?(r=dt(t,1),r.length<3&&(r=dt(t,2))):r=b.filter(o=>o.hex!==t.hex&&Mt(t,o)<60&&Mt(t,o)>20),r.sort((o,s)=>Mt(t,o)-Mt(t,s));break}}return r}function fe(t){let e=H(t);if(e()<.03)switch(Math.floor(e()*5)){case 0:{let C=e()<.5?it.midLight:it.midDark,h=[R(e,C),R(e,C),R(e,C)];return{bg:h[0].hex,text:h[1].hex,accent:h[2].hex,strategy:"glitch/washed"}}case 1:{let C=Ot.vivid.filter(A=>A.temperature==="warm"),h=Ot.vivid.filter(A=>A.temperature==="cool");return{bg:R(e,C).hex,text:R(e,h).hex,accent:R(e,e()<.5?C:h).hex,strategy:"glitch/acid"}}case 2:{let C=b.filter(A=>A.luminance<15),h=b.filter(A=>A.luminance>=10&&A.luminance<25);return{bg:R(e,C).hex,text:R(e,h).hex,accent:R(e,h).hex,strategy:"glitch/void"}}case 3:{let C=b.filter(A=>A.luminance>85),h=b.filter(A=>A.luminance>=70&&A.luminance<90);return{bg:R(e,C).hex,text:R(e,h).hex,accent:R(e,h).hex,strategy:"glitch/bleach"}}case 4:default:{let C=b.filter(h=>h.type==="cga");return{bg:R(e,C).hex,text:R(e,C).hex,accent:R(e,C).hex,strategy:"glitch/corrupt"}}}let r=b.filter(d=>d.saturation!=="gray"&&d.type==="websafe"),o=R(e,r),s=e(),l;s<.4?l="light":s<.8?l="dark":l="mid";let i=e(),a;i<.3?a="value":i<.5?a="temperature":i<.65?a="saturation":i<.8?a="complement":a="neighbor";let c;l==="light"?c=it.light.filter(d=>d.temperature===o.temperature||d.temperature==="neutral"||d.saturation==="gray"):l==="dark"?c=it.dark.filter(d=>d.temperature===o.temperature||d.temperature==="neutral"||d.saturation==="gray"):c=b.filter(d=>d.luminance>=35&&d.luminance<=65&&(d.saturation==="muted"||d.saturation==="gray")&&(d.temperature===o.temperature||d.temperature==="neutral")),c.length===0&&(c=l==="light"?it.light:it.dark);let u=R(e,c),g=Wt(o,a,e);g=g.filter(d=>K(u,d,4.5)),g.length===0&&(g=Wt(o,"value",e).filter(d=>K(u,d,4.5))),g.length===0&&(g=b.filter(d=>K(u,d,4.5)));let x=g.length>3?g[Math.floor(e()*Math.min(3,g.length))]:g[0]||o,p=e()<.2,y;if(p){let d=Ht(u,15),C=Ht(x,15),h=[...d,...C].filter(F=>K(u,F,3)&&F.hex!==x.hex&&F.saturation!=="gray"),A=new Set;if(h=h.filter(F=>A.has(F.hex)?!1:(A.add(F.hex),!0)),h.length>0){let F=h.filter(f=>f.saturation==="vivid"||f.saturation==="chromatic");y=R(e,F.length>0?F:h)}else{let F=ue(u,x);K(u,F,2.5)?y=F:y=x}}else y=x;return{bg:u.hex,text:x.hex,accent:y.hex,strategy:`${l}/${a}${p?"+accent":""}`}}function Yt(t,e,n){let r=[];for(let o=e;o<=n;o++)t%o===0&&r.push(o);return r}function he(t,e,n,r){let o=1200-n*2,s=1500-n*2,l=Yt(o,4,600),i=Yt(s,4,600);l.length===0&&l.push(6),i.length===0&&i.push(10);let a=H(r+9999),c=.05,u=[];for(let p of l)for(let y of i){let d=p/y;Math.abs(d-.6)<=c&&u.push({w:p,h:y})}if(u.length===0)return{cellW:6,cellH:10};u.sort((p,y)=>p.w*p.h-y.w*y.h);let g=a(),x;if(g<.25){let p=Math.floor(a()*Math.ceil(u.length*.25));x=u[p]}else if(g>.75){let p=Math.floor(u.length*.75),y=p+Math.floor(a()*(u.length-p));x=u[y]}else x=u[Math.floor(a()*u.length)];return{cellW:x.w,cellH:x.h}}function xe(t){let n=H(t+5555)();return n<.35?"normal":n<.5?"binary":n<.65?"inverted":n<.8?"sparse":"dense"}function Dt(t){let e=H(t+7777),n=e();if(n<.25){let r=.2+e()*.2;return{min:r,max:r+.1+e()*.2}}else if(n<.5){let r=.6+e()*.2;return{min:r,max:r+.1+e()*.1}}else return n<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function Vt(t){let e=H(t+2222);return Math.floor(4+e()*66)}function zt(t){let e=H(t+6666),n=e();return n<.16?{type:"horizontal",jitter:3+e()*12}:n<.32?{type:"vertical",jitter:3+e()*12}:n<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:n<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:n<.68?{type:"grid",jitter:3+e()*10}:n<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function Nt(t){let e=t.toUpperCase();return b.find(n=>n.hex===e)||b[0]}function ge(t,e,n){let r=H(t+3333),o=Nt(e),s=Nt(n),l=o.luminance>50,i=r();if(i<.45){if(o.cubePos&&s.cubePos){let c=ie(o,s,6);if(c.length>=4)return[c[0].hex,c[Math.floor(c.length*.33)].hex,c[Math.floor(c.length*.66)].hex,c[c.length-1].hex]}let a=qt(o,s,6);return[a[0].hex,a[Math.floor(a.length*.33)].hex,a[Math.floor(a.length*.66)].hex,a[a.length-1].hex]}else if(i<.75){let a=dt(s,1),c=dt(s,2),u=dt(s,3),g=(h,A)=>l?A.luminance-h.luminance:h.luminance-A.luminance,x=a.filter(h=>K(o,h,2)).sort(g),p=c.filter(h=>K(o,h,3)).sort(g),y=u.filter(h=>K(o,h,4)).sort(g),d=[s.hex];if(x.length>0?d.push(R(r,x).hex):d.push(s.hex),p.length>0){let h=p.filter(A=>!d.includes(A.hex));d.push(h.length>0?R(r,h).hex:p[0].hex)}else d.push(d[1]);if(y.length>0){let h=y.filter(A=>!d.includes(A.hex));d.push(h.length>0?R(r,h).hex:y[0].hex)}else d.push(s.hex);let C=d.map(h=>Nt(h));return C.sort((h,A)=>l?A.luminance-h.luminance:h.luminance-A.luminance),C.map(h=>h.hex)}else{let a=s.temperature,c=a==="warm"?"cool":"warm",u=Pt[a].filter(h=>K(o,h,2.5)),g=Pt[c].filter(h=>K(o,h,2.5)),x=(h,A)=>l?A.luminance-h.luminance:h.luminance-A.luminance;u.sort(x),g.sort(x);let p=[];p.push(u.length>0?u[0].hex:s.hex);let y=u.filter(h=>!p.includes(h.hex));p.push(y.length>0?y[Math.floor(y.length*.3)].hex:s.hex);let d=g.filter(h=>!p.includes(h.hex));p.push(d.length>0?d[Math.floor(d.length*.5)].hex:s.hex);let C=[...u,...g].filter(h=>!p.includes(h.hex));return C.sort(x),p.push(C.length>0?C[C.length-1].hex:s.hex),p}}function me(t){return H(t+4444)()<.25}function de(t){let e=Object.values(t).filter(i=>i>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((i,a)=>i-a);let n=(i,a)=>{let c=Math.floor(i.length*a);return i[Math.min(c,i.length-1)]},r=n(e,.7),o=n(e,.94),s=n(e,.94)+1,l=n(e,.985);return{t1:Math.max(.01,r),t2:Math.max(r+.01,o),t3:Math.max(o+.01,s),tExtreme:Math.max(s+.01,l)}}function tt(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}function H(t){let e=Math.abs(t)||1;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}function bt(t,e){let n=t;for(let r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r)|0;return Math.abs(n)||1}var T={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>T.len(T.sub(t,e)),norm:t=>{let e=T.len(t);return e>1e-4?T.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,n)=>({x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>T.dist(t,e)<.5};function pe(t,e,n,r){let o=T.sub(e,t),s=T.sub(r,n),l=o.x*s.y-o.y*s.x;if(Math.abs(l)<1e-4)return null;let i=T.sub(n,t),a=(i.x*s.y-i.y*s.x)/l,c=(i.x*o.y-i.y*o.x)/l;return a>=.001&&a<=.999&&c>=.001&&c<=.999?{point:T.add(t,T.scale(o,a)),t:a,u:c}:null}function ye(t,e,n,r){let o=[{p:{x:0,y:0},d:{x:1,y:0},max:n},{p:{x:n,y:0},d:{x:0,y:1},max:r},{p:{x:0,y:r},d:{x:1,y:0},max:n},{p:{x:0,y:0},d:{x:0,y:1},max:r}],s=[];for(let l of o){let i=e.x*l.d.y-e.y*l.d.x;if(Math.abs(i)<1e-4)continue;let a=T.sub(l.p,t),c=(a.x*l.d.y-a.y*l.d.x)/i,u=T.add(t,T.scale(e,c)),g=T.dot(T.sub(u,l.p),l.d);g>=-.001&&g<=l.max+.001&&(u.x=Math.max(0,Math.min(n,u.x)),u.y=Math.max(0,Math.min(r,u.y)),s.some(x=>T.dist(x,u)<.5)||s.push(u))}return s.length>=2?(s.sort((l,i)=>T.dot(T.sub(l,t),e)-T.dot(T.sub(i,t),e)),{p1:s[0],p2:s[s.length-1]}):null}function Me(t,e,n,r){let o=a=>{let c=r.x-n.x,u=r.y-n.y,g=c*c+u*u;return g<1e-4?!1:Math.abs((a.x-n.x)*u-(a.y-n.y)*c)/Math.sqrt(g)<1},s=t.filter(a=>!o(a)),l=e.filter(a=>!o(a));if(s.length===0)return e.slice();if(l.length===0)return t.slice();let i=[...t,...e];return be(i)}function be(t){if(t.length<3)return t.slice();let e=0;for(let i=1;i<t.length;i++)(t[i].y<t[e].y||t[i].y===t[e].y&&t[i].x<t[e].x)&&(e=i);let n=t[e],r=t.slice().sort((i,a)=>{let c=Math.atan2(i.y-n.y,i.x-n.x),u=Math.atan2(a.y-n.y,a.x-n.x);if(Math.abs(c-u)<1e-4){let g=(i.x-n.x)**2+(i.y-n.y)**2,x=(a.x-n.x)**2+(a.y-n.y)**2;return g-x}return c-u}),o=[r[0]];for(let i=1;i<r.length;i++){let a=o[o.length-1];(Math.abs(r[i].x-a.x)>.5||Math.abs(r[i].y-a.y)>.5)&&o.push(r[i])}if(o.length<3)return o;let s=[o[0],o[1]],l=(i,a,c)=>(a.x-i.x)*(c.y-i.y)-(a.y-i.y)*(c.x-i.x);for(let i=2;i<o.length;i++){for(;s.length>1&&l(s[s.length-2],s[s.length-1],o[i])<=0;)s.pop();s.push(o[i])}return s}function Ae(t,e,n){if(t.length<3)return{left:[],right:[]};let r=[],o=[],s=n.x-e.x,i=-(n.y-e.y),a=s,c=-(i*e.x+a*e.y),u=g=>i*g.x+a*g.y+c;for(let g=0;g<t.length;g++){let x=t[g],p=t[(g+1)%t.length],y=u(x),d=u(p);if(y<=0&&r.push({x:x.x,y:x.y}),y>=0&&o.push({x:x.x,y:x.y}),y<0&&d>0||y>0&&d<0){let C=y/(y-d),h={x:x.x+C*(p.x-x.x),y:x.y+C*(p.y-x.y)};r.push(h),o.push({x:h.x,y:h.y})}}return{left:r,right:o}}function Jt(t,e,n){let r=n.x-e.x,o=n.y-e.y,s=r*r+o*o;if(s<1e-4)return{x:t.x,y:t.y};let l=t.x-e.x,i=t.y-e.y,a=(l*r+i*o)/s,c=e.x+a*r,u=e.y+a*o;return{x:2*c-t.x,y:2*u-t.y}}function Ce(t,e,n){return t.map(r=>Jt(r,e,n))}function Qt(t){if(t.length===0)return{minX:0,minY:0,maxX:1,maxY:1};let e=1/0,n=1/0,r=-1/0,o=-1/0;for(let s of t)e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),o=Math.max(o,s.y);return{minX:e,minY:n,maxX:r,maxY:o}}function Xt(t,e,n,r=0){if(t.length<3)return t;let o=Qt(t),s=o.maxX-o.minX,l=o.maxY-o.minY;if(s<.001||l<.001)return t;let i=e-r*2,a=n-r*2,c=Math.min(i/s,a/l),u=(o.minX+o.maxX)/2,g=(o.minY+o.maxY)/2,x=e/2,p=n/2;return t.map(y=>({x:(y.x-u)*c+x,y:(y.y-g)*c+p}))}function Te(t){if(t.length<3)return 0;let e=0;for(let n=0;n<t.length;n++){let r=(n+1)%t.length;e+=t[n].x*t[r].y,e-=t[r].x*t[n].y}return e/2}function lt(t){return t.length<3?t:Te(t)<0?t.slice().reverse():t}function Zt(t,e,n,r,o={min:0,max:1},s=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let l=s||zt(r),i=Vt(r),a=lt([{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}]),c=[],u=null,g=null;if(!n||n<=0)return{creases:[],finalShape:a,maxFolds:i,firstFoldTarget:null,lastFoldTarget:null};let x=r,p=H(r+8888),y=H(r+3333),d=.05+y()*.15,C=.05+y()*.15,h=y()*Math.PI*2,A=y()*Math.PI*2,F=[],f=H(r+1111);for(let I=0;I<i;I++)F[I]=.001+f()*.25;for(let I=0;I<n;I++){let G=I%i,j=Math.floor(I/i);if(G===0&&j>0)for(let E of c)E.reductionMultiplier!==void 0&&(E.weight=Math.max(.01,E.weight*E.reductionMultiplier));if(!a||a.length<3)break;let U=H(x);I>0&&I%5===0&&(a=Xt(a,t,e,0),a=lt(a));let X=Qt(a),pt=X.maxX-X.minX,yt=X.maxY-X.minY,$=Math.floor(U()*a.length),W=a[$],q=[];for(let E=0;E<a.length;E++)E!==$&&q.push(a[E]);for(let E=0;E<a.length;E++){let P=a[E],m=a[(E+1)%a.length],M=.2+U()*.6;q.push({x:P.x+(m.x-P.x)*M,y:P.y+(m.y-P.y)*M})}let Q=q[Math.floor(U()*q.length)],et=Math.max(t,e)*.05,Ct=T.dist(W,Q),D=Math.min(pt,yt)*.05;if(Ct<D){x=bt(x,"skip"+I);continue}let v=T.mid(W,Q),Z=T.norm(T.sub(Q,W)),B=T.perp(Z),nt=Math.max(pt,yt)*3,ot={x:v.x-B.x*nt,y:v.y-B.y*nt},rt={x:v.x+B.x*nt,y:v.y+B.y*nt},{left:st,right:S}=Ae(a,ot,rt);if(st.length<3||S.length<3){x=bt(x,"badsplit"+I);continue}let O=st.some(E=>T.dist(E,W)<1),Tt=O?st:S,ct=O?S:st,ut=Ce(Tt,ot,rt),Et=lt(ct),ft=lt(ut),ht=Me(Et,ft,ot,rt);if(ht.length<3){x=bt(x,"badunion"+I);continue}let at=.3+Math.min(I*.002,.2),xt=Math.sin(I*d+h)*t*at,wt=Math.sin(I*C+A)*e*at,N=ye({x:v.x+xt,y:v.y+wt},B,t,e);if(N){let E=o.min+p()*(o.max-o.min);c.push({p1:T.copy(N.p1),p2:T.copy(N.p2),depth:c.length,weight:E,cyclePosition:G,reductionMultiplier:F[G]});let P=Jt(W,ot,rt),m={x:Math.max(et,Math.min(t-et,P.x)),y:Math.max(et,Math.min(e-et,P.y))};I===0&&u===null&&(u=m),g=m}a=lt(ht),x=bt(x,"fold"+I)}return a=Xt(a,t,e,0),a=lt(a),{creases:c,finalShape:a,maxFolds:i,firstFoldTarget:u,lastFoldTarget:g}}function Ee(t){let e=[];for(let n=0;n<t.length;n++)for(let r=n+1;r<t.length;r++){let o=pe(t[n].p1,t[n].p2,t[r].p1,t[r].p2);if(o){let s=t[n].weight||1,l=t[r].weight||1;e.push({x:o.point.x,y:o.point.y,depth1:t[n].depth,depth2:t[r].depth,gap:Math.abs(t[r].depth-t[n].depth),weight:s+l})}}return e}function we(t,e,n,r,o,s=null){let l=Ee(t),i={},a={},c={};for(let u of l){let g=Math.floor(u.x/r),x=Math.floor(u.y/o);if(g>=0&&g<e&&x>=0&&x<n){let p=`${g},${x}`;i[p]=(i[p]||0)+u.weight,a[p]=Math.max(a[p]||0,u.gap),c[p]=(c[p]||0)+1}}return{activeCreases:t,intersections:l,cellWeights:i,cellMaxGap:a,cellIntersectionCounts:c,destroyed:0,maxFolds:s}}function te({folds:t,seed:e,outputWidth:n,outputHeight:r,bgColor:o,textColor:s,accentColor:l,cellWidth:i,cellHeight:a,renderMode:c,multiColor:u,levelColors:g,foldStrategy:x=null,showCreases:p=!1,showPaperShape:y=!1,showFoldTargets:d=!1,showIntersections:C=!1,showGrid:h=!1,fontFamily:A=jt}){let F=document.createElement("canvas"),f=F.getContext("2d"),I=2;F.width=n*I,F.height=r*I,f.setTransform(I,0,0,I,0,0),f.fillStyle=o,f.fillRect(0,0,n,r);let G=n/1200,j=r/1500,U=1200-50*2,X=1500-50*2,pt=50,yt=50,$=Math.max(1,Math.floor(U/i)),W=Math.max(1,Math.floor(X/a)),q=U/$,Q=X/W,et=U*G,Ct=X*j,D=pt*G,v=yt*j,Z=q*G,B=Q*j,nt=Dt(e),{creases:ot,finalShape:rt,maxFolds:st,firstFoldTarget:S,lastFoldTarget:O}=Zt(U,X,t,e,nt,x),Tt=ot.map(m=>({...m,p1:{x:m.p1.x*G,y:m.p1.y*j},p2:{x:m.p2.x*G,y:m.p2.y*j}})),ct=null;if(S){let m=Math.floor(S.x/q),M=Math.floor(S.y/Q);m>=0&&m<$&&M>=0&&M<W&&S.x>=0&&S.x<=U&&S.y>=0&&S.y<=X&&(ct=`${m},${M}`)}let ut=null;if(O){let m=Math.floor(O.x/q),M=Math.floor(O.y/Q);m>=0&&m<$&&M>=0&&M<W&&O.x>=0&&O.x<=U&&O.y>=0&&O.y<=X&&(ut=`${m},${M}`)}let{activeCreases:Et,intersections:ft,cellWeights:ht,cellMaxGap:at}=we(Tt,$,W,Z,B,st),xt=new Set;if(Object.keys(at).length>0){let m=Math.max(...Object.values(at));for(let[M,V]of Object.entries(at))V===m&&xt.add(M)}let wt=B;f.font=`${wt}px ${A}`,f.textBaseline="top";let N=[" ","\u2591","\u2592","\u2593"],E=de(ht),P=(m,M)=>u&&g?g[Math.min(m,3)]:s;for(let m=0;m<W;m++)for(let M=0;M<$;M++){let V=Math.round(D+M*Z),It=Math.round(v+m*B),L=`${M},${m}`,k=ht[L]||0,_=null,Y=s,w=-1;if(ct===L)w=k>0?tt(k,E):2,_=N[Math.max(w,2)],Y=l;else if(ut===L)w=k>0?tt(k,E):2,_=N[Math.max(w,2)],Y=s;else if(xt.has(L)&&k>0)_=N[2],w=2,Y=l;else if(k>=1.5){let _t=k-1.5,gt=30+Math.min(_t*300,150),z=ce(s),mt=(z.h+gt+360)%360,Rt=Math.min(100,z.s+20),J=Math.min(85,z.l+10);_=N[3],w=3,Y=le(mt,Rt,J)}else c==="normal"?(w=tt(k,E),_=N[w],Y=P(w,L)):c==="binary"?k===0?(_=N[0],w=0,Y=P(0,L)):(_=N[3],w=3,Y=P(3,L)):c==="inverted"?(w=3-tt(k,E),_=N[w],Y=P(w,L)):c==="sparse"?(w=tt(k,E),w===1&&(_=N[1],Y=P(1,L))):c==="dense"&&(w=tt(k,E),w>=2?(_=N[w],Y=P(w,L)):k===0&&(_=N[0],w=0,Y=P(0,L)));if(_){if(ct===L||ut===L)f.fillStyle=Y;else{let J=P(tt(k,E),L);f.fillStyle=xt.has(L)&&k>0?l:J}let _t=f.measureText(_).width,gt=Math.round(D+(M+1)*Z);f.save(),f.beginPath(),f.rect(V,It,Z,B),f.clip();let z=V,mt=0,Rt=.95;for(;z<gt&&w>=0;){let J=_;w>=2&&mt>0&&mt%2===0&&(J=N[Math.max(0,w-1)]);let Ft=f.measureText(J).width,Gt=gt-z;if(Gt<=0)break;if(Gt<Ft*1.1){f.fillText(J,gt-Ft,It);break}else f.fillText(J,z,It),z+=Ft*Rt;mt++}f.restore()}}if(p){f.strokeStyle="#ff00ff",f.lineWidth=1,f.globalAlpha=.7;for(let m of Et)f.beginPath(),f.moveTo(D+m.p1.x,v+m.p1.y),f.lineTo(D+m.p2.x,v+m.p2.y),f.stroke();f.globalAlpha=1}if(y){let m=rt.map(M=>({x:M.x*G,y:M.y*j}));if(m.length>=3){f.strokeStyle="#00ffff",f.lineWidth=2,f.globalAlpha=.9,f.beginPath(),f.moveTo(D+m[0].x,v+m[0].y);for(let M=1;M<m.length;M++)f.lineTo(D+m[M].x,v+m[M].y);f.closePath(),f.stroke(),f.fillStyle="#00ffff",f.globalAlpha=.15,f.fill(),f.globalAlpha=1}}if(h){f.strokeStyle=s,f.lineWidth=1,f.globalAlpha=.3;for(let m=0;m<=$;m++){let M=D+m*Z;f.beginPath(),f.moveTo(M,v),f.lineTo(M,v+Ct),f.stroke()}for(let m=0;m<=W;m++){let M=v+m*B;f.beginPath(),f.moveTo(D,M),f.lineTo(D+et,M),f.stroke()}f.globalAlpha=1}if(d){let m=8*G;if(f.lineWidth=2,f.globalAlpha=1,S){let M=D+S.x*G,V=v+S.y*j;f.strokeStyle="#00ff00",f.beginPath(),f.arc(M,V,m,0,Math.PI*2),f.stroke()}if(O){let M=D+O.x*G,V=v+O.y*j;f.strokeStyle="#00ff00",f.beginPath(),f.arc(M,V,m,0,Math.PI*2),f.stroke()}}if(C&&ft&&ft.length>0){f.strokeStyle="#ff0000",f.fillStyle="rgba(255, 0, 0, 0)",f.lineWidth=1.5,f.globalAlpha=1;let m=3;for(let M of ft)f.beginPath(),f.arc(D+M.x,v+M.y,m,0,Math.PI*2),f.fill(),f.stroke()}return F.toDataURL("image/png")}function St(t,e=1200,n=1500,r=0,o=null){let s=fe(t),l=he(e,n,r,t),i=xe(t),a=Dt(t),c=zt(t),u=me(t),g=u?ge(t,s.bg,s.text):null,x=Vt(t),p=o;if(p===null){let y=H(t+9999);p=Math.floor(1+y()*500)}return{seed:t,palette:s,cells:l,renderMode:i,weightRange:a,foldStrategy:c,multiColor:u,levelColors:g,maxFolds:x,folds:p}}function Ie(t,e,n,r=""){let o=St(e,1200,1500,0,n),s=Dt(e),l=1200-50*2,i=1500-50*2,{creases:a}=Zt(l,i,n,e,s,o.foldStrategy);return{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:r?`${r}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:o.foldStrategy.type},{trait_type:"Render Mode",value:o.renderMode},{trait_type:"Multi-Color",value:o.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${o.cells.cellW}x${o.cells.cellH}`},{trait_type:"Fold Count",value:n},{trait_type:"Max Folds",value:o.maxFolds},{trait_type:"Crease Count",value:a.length},{trait_type:"Palette Strategy",value:o.palette.strategy}]}}async function Re(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${At}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${At}`),!0}catch(n){return console.warn("Failed to load on-chain font:",n),!1}}async function Lt(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,n=typeof window<"u"&&window.FONT_DATA_URI||Bt;if(t&&e!==void 0){let r=document.getElementById("c")||document.querySelector("canvas");if(r){await Re(n);let o=St(t,1200,1500,0,e),s=te({folds:e,seed:t,outputWidth:1200,outputHeight:1500,bgColor:o.palette.bg,textColor:o.palette.text,accentColor:o.palette.accent,cellWidth:o.cells.cellW,cellHeight:o.cells.cellH,renderMode:o.renderMode,multiColor:o.multiColor,levelColors:o.levelColors,foldStrategy:o.foldStrategy}),l=new Image;l.onload=()=>{let i=r.getContext("2d");r.width=1200,r.height=1500,i.drawImage(l,0,0),typeof window.scaleCanvas=="function"&&window.scaleCanvas()},l.src=s}}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Lt()):Lt());export{jt as FONT_STACK,Bt as ONCHAIN_FONT_DATA_URI,At as ONCHAIN_FONT_NAME,St as generateAllParams,Ie as generateMetadata,Lt as initOnChain,te as renderToCanvas};
