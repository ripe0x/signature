(()=>{var Jt="FoldMono",nn="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",Rn='"Courier New", Courier, monospace',ue=`"${Jt}", ${Rn}`,ie=.6,le=.08,ae=.06,Tn=.03,Sn=.05;function Ue(t,e,o){let r=t/255,n=e/255,s=o/255;return(.2126*r+.7152*n+.0722*s)*100}var nt=[{hex:"#000000",name:"black",luminance:0,temperature:"neutral",r:0,g:0,b:0},{hex:"#0000AA",name:"blue",luminance:10,temperature:"cool",r:0,g:0,b:170},{hex:"#AA0000",name:"red",luminance:20,temperature:"warm",r:170,g:0,b:0},{hex:"#AA00AA",name:"magenta",luminance:25,temperature:"warm",r:170,g:0,b:170},{hex:"#FFFFFF",name:"white",luminance:100,temperature:"neutral",r:255,g:255,b:255},{hex:"#FFFF55",name:"yellow",luminance:93,temperature:"warm",r:255,g:255,b:85},{hex:"#55FFFF",name:"lightCyan",luminance:85,temperature:"cool",r:85,g:255,b:255},{hex:"#55FF55",name:"lightGreen",luminance:77,temperature:"cool",r:85,g:255,b:85},{hex:"#00AA00",name:"green",luminance:30,temperature:"cool",r:0,g:170,b:0},{hex:"#00AAAA",name:"cyan",luminance:40,temperature:"cool",r:0,g:170,b:170},{hex:"#5555FF",name:"lightBlue",luminance:45,temperature:"cool",r:85,g:85,b:255},{hex:"#FF5555",name:"lightRed",luminance:45,temperature:"warm",r:255,g:85,b:85},{hex:"#FF55FF",name:"lightMagenta",luminance:60,temperature:"warm",r:255,g:85,b:255}],Ln=nt.filter(t=>t.luminance<30||t.luminance>70),kn={black:.2,white:.15,blue:.15,red:.15,magenta:.1,yellow:.1,lightCyan:.08,lightGreen:.07},Ht=nt,Fn=nt.filter(t=>t.temperature!=="neutral"),Dn=nt.filter(t=>t.temperature!=="neutral"),Ke=nt,Xo={dark:nt.filter(t=>t.luminance<30),light:nt.filter(t=>t.luminance>70)},Ve={warm:nt.filter(t=>t.temperature==="warm"),cool:nt.filter(t=>t.temperature==="cool"),neutral:nt.filter(t=>t.temperature==="neutral")};function Gn(t,e){let o=t.r-e.r,r=t.g-e.g,n=t.b-e.b;return Math.sqrt(o*o*.3+r*r*.59+n*n*.11)}function On(t,e,o){let r=t.luminance,n=e.luminance,s=[];for(let i=0;i<o;i++){let f=i/(o-1),a=r+(n-r)*f,g=nt.filter(p=>p.temperature===t.temperature||p.temperature==="neutral"),b=g[0],M=Math.abs(b.luminance-a);for(let p of g){let u=Math.abs(p.luminance-a);u<M&&(M=u,b=p)}s.push(b)}return s}function qe(t,e,o=4.5){let r=t.luminance/100,n=e.luminance/100,s=Math.max(r,n)+.05,i=Math.min(r,n)+.05;return s/i>=o}function ce(t,e){return e[Math.floor(t()*e.length)]}function Wn(t,e,o){let r=t(),n=0;for(let s of e)if(n+=o[s.name]||0,r<n)return s;return e[e.length-1]}function Te(t,e,o){e/=100,o/=100;let r=e*Math.min(o,1-o),n=s=>{let i=(s+t/30)%12,f=o-r*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*f).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}function Se(t){let e=parseInt(t.slice(1,3),16)/255,o=parseInt(t.slice(3,5),16)/255,r=parseInt(t.slice(5,7),16)/255,n=Math.max(e,o,r),s=Math.min(e,o,r),i,f,a=(n+s)/2;if(n===s)i=f=0;else{let g=n-s;switch(f=a>.5?g/(2-n-s):g/(n+s),n){case e:i=((o-r)/g+(o<r?6:0))/6;break;case o:i=((r-e)/g+2)/6;break;case r:i=((e-o)/g+4)/6;break}}return{h:i*360,s:f*100,l:a*100}}var Nn={red:["cyan","lightCyan"],magenta:["green","lightGreen"],blue:["yellow"],lightRed:["cyan","lightCyan"],lightMagenta:["green","lightGreen"],lightBlue:["yellow"],cyan:["red","lightRed"],lightCyan:["red","lightRed"],green:["magenta","lightMagenta"],lightGreen:["magenta","lightMagenta"],yellow:["blue","lightBlue"],black:["white","yellow","lightCyan"],white:["black","blue","magenta"]};function _n(t,e,o){let n=[];switch(e){case"value":{let s=t.luminance<50;n=Ht.filter(i=>s?i.luminance>60:i.luminance<40);break}case"temperature":{if(t.temperature==="neutral")n=Ht.filter(s=>s.temperature!=="neutral"&&Math.abs(s.luminance-t.luminance)>25);else{let s=t.temperature==="warm"?"cool":"warm";n=Ht.filter(i=>i.temperature===s&&Math.abs(i.luminance-t.luminance)>25)}break}case"complement":{let s=Nn[t.name]||[];if(n=Ht.filter(i=>s.includes(i.name)),n.length===0){let i=t.luminance<50;n=Ht.filter(f=>i?f.luminance>60:f.luminance<40)}break}case"clash":{n=Ht.filter(s=>s.name!==t.name&&Math.abs(s.luminance-t.luminance)>20&&Math.abs(s.luminance-t.luminance)<50);break}}return n.sort((s,i)=>Math.abs(i.luminance-t.luminance)-Math.abs(s.luminance-t.luminance)),n.length>0?ce(o,n):t.luminance<50?nt.find(s=>s.name==="white"):nt.find(s=>s.name==="black")}function Hn(t,e,o){if(o()<.4)return e;let r=Fn.filter(s=>s.name!==t.name&&s.name!==e.name&&Math.abs(s.luminance-t.luminance)>20);if(r.length===0)return e;let n=r.filter(s=>["yellow","lightCyan","lightMagenta","lightGreen"].includes(s.name));return n.length>0&&o()<.6?ce(o,n):ce(o,r)}function Bn(t){let e=ce(t,Dn),o;return e.luminance>50?o=nt.find(r=>r.name==="black"):e.luminance<30?o=t()<.75?nt.find(r=>r.name==="black"):nt.find(r=>r.name==="white"):o=t()<.6?nt.find(r=>r.name==="black"):nt.find(r=>r.name==="white"),{bg:o.hex,text:e.hex,accent:e.hex,strategy:`monochrome/${e.name}`,colorCount:2}}function Pn(t){let e=O(t);if(e()<.12)return Bn(e);let o=Wn(e,Ln,kn),r=e(),n;r<.4?n="value":r<.68?n="temperature":r<.9?n="complement":n="clash";let s=_n(o,n,e),i=Hn(o,s,e),f=i.hex===s.hex?2:3;return Math.abs(o.luminance-s.luminance)<25?{bg:o.luminance<50?"#000000":"#FFFFFF",text:o.luminance<50?"#FFFFFF":"#000000",accent:"#FFFF55",strategy:n,colorCount:f}:{bg:o.hex,text:s.hex,accent:i.hex,strategy:n,colorCount:f}}function Je(t,e,o){let r=[];for(let n=e;n<=o;n++)t%n===0&&r.push(n);return r}function $n(t,e,o,r){let n=1200-o*2-290,s=1697-o*2-145*2,i=Je(n,20,600),f=Je(s,20,600);i.length===0&&i.push(8),f.length===0&&f.push(12);let a=O(r+9999),g=1+le+ae,b=ie/g,M=[];for(let d of i)for(let x of f){let c=Math.max(d/x,x/d),h=x*b;c<=3&&d>=h&&M.push({w:d,h:x})}if(M.length===0)return{cellW:8,cellH:12};M.sort((d,x)=>d.w*d.h-x.w*x.h);let p=a(),u;if(p<.03){let d=Math.max(1,Math.ceil(M.length*.1)),x=Math.floor(a()*d);u=M[x]}else if(p<.1){let d=Math.floor(M.length*.1),x=Math.floor(M.length*.25),c=d+Math.floor(a()*Math.max(1,x-d));u=M[Math.min(c,M.length-1)]}else if(p<.45){let d=Math.floor(M.length*.25),x=Math.floor(M.length*.75),c=d+Math.floor(a()*(x-d));u=M[Math.min(c,M.length-1)]}else if(p<.95){let d=Math.floor(M.length*.75),x=Math.floor(M.length*.9),c=d+Math.floor(a()*Math.max(1,x-d));u=M[Math.min(c,M.length-1)]}else{let d=Math.floor(M.length*.9),x=d+Math.floor(a()*(M.length-d));u=M[Math.min(x,M.length-1)]}return{cellW:u.w,cellH:u.h}}function Xn(t){let o=O(t+5555)();return o<.4?"normal":o<.7?"inverted":o<.8?"binary":o<.9?"sparse":"dense"}function Yn(t){return O(t+5556)()<.3}function Oe(t){let e=O(t+7777),o=e();if(o<.25){let r=.2+e()*.2;return{min:r,max:r+.1+e()*.2}}else if(o<.5){let r=.6+e()*.2;return{min:r,max:r+.1+e()*.1}}else return o<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function zn(t){let e=O(t+11111);if(!(e()>=.5))return{hasOverlap:!1,amount:"none"};let r=e(),n;return r<.2?n="5%":r<.4?n="25%":r<.6?n="50%":r<.8?n="75%":n="95%",{hasOverlap:!0,amount:n}}function on(t){let e=O(t+2222);return Math.floor(4+e()*66)}function rn(t){let e=O(t+6666),o=e();return o<.16?{type:"horizontal",jitter:3+e()*12}:o<.32?{type:"vertical",jitter:3+e()*12}:o<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:o<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:o<.68?{type:"grid",jitter:3+e()*10}:o<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function ke(t){let e=t.toUpperCase();return Ke.find(o=>o.hex===e)||Ke[0]}function jn(t,e,o){let r=O(t+3333),n=ke(e),s=ke(o),i=n.luminance>50,f=(g,b)=>i?b.luminance-g.luminance:g.luminance-b.luminance;if(r()<.5){let g=On(n,s,6);return[g[0].hex,g[Math.floor(g.length*.33)].hex,g[Math.floor(g.length*.66)].hex,g[g.length-1].hex]}else{let g=s.temperature,b=g==="warm"?"cool":"warm",M=Ve[g].filter(m=>qe(n,m,2)).sort(f),p=Ve[b].filter(m=>qe(n,m,2)).sort(f),u=[],d=new Set;M.length>0?(u.push(M[0].hex),d.add(M[0].hex)):(u.push(s.hex),d.add(s.hex));let x=M.filter(m=>!d.has(m.hex));if(x.length>0){let m=x[Math.floor(x.length*.4)];u.push(m.hex),d.add(m.hex)}else u.push(s.hex);let c=p.filter(m=>!d.has(m.hex));if(c.length>0){let m=c[Math.floor(c.length*.5)];u.push(m.hex),d.add(m.hex)}else u.push(s.hex);let h=[...M,...p].filter(m=>!d.has(m.hex)).sort(f);return h.length>0?u.push(h[h.length-1].hex):u.push(s.hex),u}}function Un(t){return O(t+4444)()<.25}function sn(t){return .08+(.35-.08)*Math.exp(-.03*t)}function Kn(t,e=0){let o=O(t+77777),r=sn(e);return o()<r}function Vn(t){let o=O(t+88888)();return o<.5?"background":o<.85?"text":"accent"}function Le(t){let e=[0,51,102,153,204,255],o=e[0],r=Math.abs(t-o);for(let n of e){let s=Math.abs(t-n);s<r&&(r=s,o=n)}return o}function ln(t,e,o){let r=Le(t),n=Le(e),s=Le(o);return"#"+r.toString(16).padStart(2,"0").toUpperCase()+n.toString(16).padStart(2,"0").toUpperCase()+s.toString(16).padStart(2,"0").toUpperCase()}function fe(t){let e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function re(t){let e=fe(t);return(.299*e.r+.587*e.g+.114*e.b)/255}function Qe(t,e,o){let r=fe(t),s=e*o*51,i=Math.max(0,Math.min(255,r.r+s)),f=Math.max(0,Math.min(255,r.g+s)),a=Math.max(0,Math.min(255,r.b+s));return ln(i,f,a)}function Bt(t,e,o,r){let s=O(t+(r==="background"?11111:r==="text"?22222:33333)),i=re(e),f=re(o),a;r==="background"?i<.3?a=s()<.75?1:-1:i>.7?a=s()<.75?-1:1:a=s()<.5?1:-1:r==="text"?f<.4?a=i>.5&&s()<.6?-1:1:a=i<.5&&s()<.6?1:-1:a=s()<.5?1:-1;let g=s(),b=g<.5?1:g<.85?2:3,M=Qe(e,a,b),p=re(M),u=Math.abs(p-f);if(r!=="accent"&&u<.2){let d=Qe(e,-a,b+1),x=re(d);if(Math.abs(x-f)>u)return d}return M}function qn(t,e,o){let r={...e,anchorType:o,cgaBg:e.bg,cgaText:e.text,cgaAccent:e.accent};return o==="background"?(r.bg=e.bg,r.text=Bt(t,e.text,e.bg,"text"),r.accent=Bt(t+1,e.accent,e.bg,"accent")):o==="text"?(r.bg=Bt(t,e.bg,e.text,"background"),r.text=e.text,r.accent=Bt(t+1,e.accent,e.text,"accent")):(r.bg=Bt(t,e.bg,e.accent,"background"),r.text=Bt(t+1,e.text,r.bg,"text"),r.accent=e.accent),r}function Jn(t,e){let o=fe(t),r=fe(e);return[.25,.5,.75,1].map(i=>{let f=Math.round(o.r+(r.r-o.r)*i),a=Math.round(o.g+(r.g-o.g)*i),g=Math.round(o.b+(r.b-o.b)*i);return ln(f,a,g)})}function Qn(t){return O(t+9191)()<.008}function Zn(t){return O(t+9393)()<.008}function to(t){let e=O(t+5555),o=.1+e()*.8,r=0,n=e()<.4,s=n?e()*180:null,i=n?.2+e()*.6:0,f=.3+e()*1.4;return{absorbency:o,intersectionThreshold:r,angleAffinity:s,affinityStrength:i,ceilingMultiplier:f}}function eo(t){let e=t.absorbency<.35?"Resistant":t.absorbency<.65?"Standard":"Absorbent",o=t.intersectionThreshold<.15?"Fine":t.intersectionThreshold<.35?"Medium":"Coarse",r=t.angleAffinity!==null?"Grain":"Uniform";return`${e}/${o}/${r}`}function an(t,e,o){return t}var Yo=[-1/1,-1/2,-1/4,-1/8,-1/16,1/64,1/32,1/16,1/8,1/4,1/2,1,2];function cn(t,e,o,r,n){let s=O(t+12345),i=s()<.6,f=!1,a=!1,g=!1,b=!1;if(i){let U=s();U<.33?f=!0:(U<.66||(f=!0),a=!0),f&&s()<.3&&(g=!0),a&&s()<.3&&(b=!0)}let M=[-1/16,-1/8,-1/4,-1/2],p=U=>{if(U)return M[Math.floor(s()*M.length)];let T=s();return T<.4?0:T<.525?1/64:T<.65?1/32:T<.75?1/16:T<.85?1/8:T<.9?1/4:T<.95?1/2:T<.98?1:2},u=e,d=o,x=f?p(g):0,c=u*x,h=u+c,m=h>0?Math.max(1,Math.floor((r+c)/h)):1,y=m>1?c:0;m===1&&u<r&&(u=r,y=0);let A=a?p(b):0,I=d*A,F=d+I,R=F>0?Math.max(1,Math.floor((n+I)/F)):1,k=R>1?I:0;R===1&&d<n&&(d=n,k=0);let Y=m,z=R,j=y,P=k,l=Y*u+(Y>1?(Y-1)*j:0),gt=z*d+(z>1?(z-1)*P:0),H=r-l,S=n-gt;return{cols:Y,rows:z,cellWidth:u,cellHeight:d,colGap:j,rowGap:P,strideX:u+j,strideY:d+P,gridOffsetX:H>0?H/2:0,gridOffsetY:S>0?S/2:0,actualGridWidth:l,actualGridHeight:gt}}function fn(t){let e=Object.values(t).filter(f=>f>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((f,a)=>f-a);let o=(f,a)=>{let g=Math.floor(f.length*a);return f[Math.min(g,f.length-1)]},r=o(e,.7),n=o(e,.94),s=o(e,.94)+1,i=o(e,.985);return{t1:Math.max(.01,r),t2:Math.max(r+.01,n),t3:Math.max(n+.01,s),tExtreme:Math.max(s+.01,i)}}function xt(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}var no=1103515245n,oo=12345n,Ze=0x7fffffffn;function O(t){let e=BigInt(Math.abs(t)||1);return()=>(e=e*no+oo&Ze,Number(e)/Number(Ze))}function un(t,e,o){let n=O(t+22222)(),s;n<.6?s=0:n<.8?s=1:n<.9?s=2:n<.97?s=3:s=5;let i=O(t+33333),f=i(),a;f<.22?a="ltr":f<.44?a="rtl":f<.65?a="center":f<.8?a="alternate":f<.9?a="diagonal":f<.96?a="randomMid":a="checkerboard";let g=i()<.5,b=Math.floor(i()*e),M=i()<.5,p=O(t+11111),u=p()>=.65,x=(()=>{if(!u)return 1;let S=p();return S<.1?.95:S<.2?.75:S<.3?.65:S<.6?.5:S<.8?.25:.05})(),c=[.95,.75,.5,.25,.05],h=u?Math.floor(p()*5):0,m=c.indexOf(x),y=Math.floor(p()*3)+1,A=Math.floor(p()*3),I=Math.floor(p()*4)+1,F=[],R=[],k=[],Y=.3+p()*.4,z=.3+p()*.4,j=.3+p()*.4;for(let S=0;S<20;S++)F.push(p()<Y),R.push(p()<z),k.push(p()<j);let P=Math.floor(p()*2),l=p()<.1;return{cellOverflowAmount:s,drawDirectionMode:a,hasOverlap:u,invertedSingleCharOnEmpty:l,getOverlapFactor:(S,U)=>{if(!u)return 1;let T=m===-1?0:m;switch(h){case 1:A===1?F[S%20]&&(T=(T+y)%c.length):A===2?T=(T+S%3*y)%c.length:T=(T+Math.floor(S/I)*y)%c.length;break;case 2:A===1?R[U%20]&&(T=(T+y)%c.length):A===2?T=(T+U%3*y)%c.length:T=(T+Math.floor(U/I)*y)%c.length;break;case 3:if(A===1){let $=F[S%20],W=R[U%20];(P===0?$||W:$!==W)&&(T=(T+y)%c.length)}else(S+U)%(A===2?3:2)===0&&(T=(T+y)%c.length);break;case 4:A===1?k[(S+U)%20]&&(T=(T+y)%c.length):(S+U)%(A===2?5:I+1)===0&&(T=(T+y)%c.length);break}return c[T]||x},getCellDirection:(S,U)=>{if(a==="ltr")return"ltr";if(a==="rtl")return"rtl";if(a==="center")return"center";if(a==="alternate")return S%2===1!==g?"rtl":"ltr";if(a==="diagonal"){let T=(b+(M?S:-S)+e*100)%e;return U<T?"ltr":"rtl"}if(a==="randomMid"){let T=O(t+55555+S),$=Math.floor(T()*e);return U<$?"ltr":"rtl"}return a==="checkerboard"?(S+U)%2===0?"ltr":"rtl":"ltr"}}}var ot={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>ot.len(ot.sub(t,e)),norm:t=>{let e=ot.len(t);return e>1e-4?ot.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,o)=>({x:t.x+(e.x-t.x)*o,y:t.y+(e.y-t.y)*o}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>ot.dist(t,e)<.5};function We(t,e,o,r){let n=ot.sub(e,t),s=ot.sub(r,o),i=n.x*s.y-n.y*s.x;if(Math.abs(i)<1e-4)return null;let f=ot.sub(o,t),a=(f.x*s.y-f.y*s.x)/i,g=(f.x*n.y-f.y*n.x)/i;return a>=.001&&a<=.999&&g>=.001&&g<=.999?{point:ot.add(t,ot.scale(n,a)),t:a,u:g}:null}function tn(t,e){let o=t.reduce((n,s)=>n+s,0);if(o<=0)return 0;let r=e()*o;for(let n=0;n<t.length;n++)if(r-=t[n],r<=0)return n;return t.length-1}var ro=0,so=1,io=2,lo=3;function ut(t,e,o,r){switch(t){case ro:return{x:e*o,y:0};case so:return{x:o,y:e*r};case io:return{x:(1-e)*o,y:r};case lo:return{x:0,y:(1-e)*r};default:return{x:e*o,y:0}}}function Fe(t,e,o){switch(t){case 0:return{x:0,y:0};case 1:return{x:e,y:0};case 2:return{x:e,y:o};case 3:return{x:0,y:o};default:return{x:0,y:0}}}function dn(t,e){return{x:t.p1.x+(t.p2.x-t.p1.x)*e,y:t.p1.y+(t.p2.y-t.p1.y)*e}}function De(t,e){let o=e.x-t.x,r=e.y-t.y,n=Math.atan2(r,o)*180/Math.PI;return n<0&&(n+=180),n>=180&&(n-=180),n}function ao(t,e,o,r,n,s,i){let a=(()=>{if(!i)return[0,1,2,3];switch(i.type){case"horizontal":return[1,3];case"vertical":return[0,2];case"grid":return t%2===0?[1,3]:[0,2];case"diagonal":return[0,1,2,3];case"radial":case"clustered":case"random":default:return[0,1,2,3]}})();if(i&&i.type==="radial"){let p=i.focalX*r,u=i.focalY*n;if(t<10||e.length===0||s()<.6){let d=[{edge:0,dist:u},{edge:1,dist:r-p},{edge:2,dist:n-u},{edge:3,dist:p}];d.sort((m,y)=>m.dist-y.dist);let x=s(),c=x<.5?d[0].edge:x<.8?d[1].edge:d[Math.floor(s()*4)].edge,h;return c===0||c===2?h=.1+p/r*.8+(s()-.5)*.3:h=.1+u/n*.8+(s()-.5)*.3,h=Math.max(.05,Math.min(.95,h)),{point:ut(c,h,r,n),type:"edge",edge:c,t:h}}}if(i&&i.type==="clustered"){let p=i.clusterX*r,u=i.clusterY*n,d=i.spread;if(t<15||s()<.7){let x=[{edge:0,weight:1+(1-Math.abs(u/n))*2},{edge:1,weight:1+p/r*2},{edge:2,weight:1+u/n*2},{edge:3,weight:1+(1-p/r)*2}],c=x.reduce((A,I)=>A+I.weight,0),h=s()*c,m=0;for(let A of x)if(h-=A.weight,h<=0){m=A.edge;break}let y;return m===0||m===2?y=p/r+(s()-.5)*d:y=u/n+(s()-.5)*d,y=Math.max(.05,Math.min(.95,y)),{point:ut(m,y,r,n),type:"edge",edge:m,t:y}}}let g=Math.max(.2,1-t*.015),b=i&&(i.type==="horizontal"||i.type==="vertical"||i.type==="grid");if(b||s()<g||e.length===0&&o.length===0){let p=b?0:i&&i.type==="diagonal"?.5:.15;if(s()<p){let d=Math.floor(s()*4);return{point:Fe(d,r,n),type:"corner",corner:d}}else{let d=a[Math.floor(s()*a.length)],x=i&&i.jitter?i.jitter/100:0,c=.05+s()*.9,h=Math.max(.05,Math.min(.95,c+(s()-.5)*x));return{point:ut(d,h,r,n),type:"edge",edge:d,t:h}}}else if(o.length>0&&s()<.35){let u=o[Math.floor(s()*o.length)];return{point:{x:u.x,y:u.y},type:"intersection",intersectionIndex:o.indexOf(u)}}else if(e.length>0){let u=e[Math.floor(s()*e.length)],d=.1+s()*.8;return{point:dn(u,d),type:"crease",creaseIndex:e.indexOf(u),t:d}}else{let u=a[Math.floor(s()*a.length)],d=.05+s()*.9;return{point:ut(u,d,r,n),type:"edge",edge:u,t:d}}}function co(t,e,o,r,n,s,i,f,a){let g=Math.min(n,s)*.15,b=c=>c===0||c===2,M=c=>c===1||c===3;if(a&&(a.type==="horizontal"||a.type==="vertical"||a.type==="grid")){let c=a.type==="horizontal"||a.type==="grid"&&e%2===0;if(t.type==="edge"){let h=(t.edge+2)%4,m=M(t.edge);if(c&&m||!c&&!m){let y=a.jitter?a.jitter/100:0,A=t.t!==void 0?t.t:.5,I=Math.max(.05,Math.min(.95,A+(i()-.5)*y));return I=1-I,{point:ut(h,I,n,s),type:"edge",edge:h}}}}if(a&&a.type==="diagonal"){let c=a.angle||(i()<.5?45:135);if(t.type==="corner"){let h=(t.corner+2)%4;return{point:Fe(h,n,s),type:"corner"}}else if(t.type==="edge"){let h=a.jitter?(i()-.5)*a.jitter:0,m=(c+h)*Math.PI/180,y=t.point.x,A=t.point.y,I=Math.cos(m),F=Math.sin(m),R=null,k=0,Y=[{edge:0,y:0},{edge:2,y:s},{edge:3,x:0},{edge:1,x:n}];for(let z of Y){let j=null;if(z.y!==void 0){let P=(z.y-A)/F;if(P>0){let l=y+I*P;l>=0&&l<=n&&(j={x:l,y:z.y})}}else{let P=(z.x-y)/I;if(P>0){let l=A+F*P;l>=0&&l<=s&&(j={x:z.x,y:l})}}if(j){let P=ot.dist(t.point,j);P>k&&P>=g&&(k=P,R=j)}}if(R)return{point:R,type:"edge"}}}if(a&&a.type==="radial"){let c=a.focalX*n,h=a.focalY*s,m={x:c,y:h},y=t.point.x-c,A=t.point.y-h,I=Math.sqrt(y*y+A*A);if(I>0){let F=y/I,R=A/I,k=1/0;F>0&&(k=Math.min(k,(n-t.point.x)/F)),F<0&&(k=Math.min(k,-t.point.x/F)),R>0&&(k=Math.min(k,(s-t.point.y)/R)),R<0&&(k=Math.min(k,-t.point.y/R));let Y={x:Math.max(0,Math.min(n,t.point.x+F*k*.95)),y:Math.max(0,Math.min(s,t.point.y+R*k*.95))};if(ot.dist(t.point,Y)>=g)return{point:Y,type:"edge"}}}if(a&&a.type==="clustered"){let c=a.clusterX*n,h=a.clusterY*s,m={x:c,y:h},y=[];for(let I=0;I<4;I++)for(let F=0;F<3;F++){let R=.1+i()*.8,k=ut(I,R,n,s),Y=fo(m,t.point,k),z=Math.max(n,s)*.5,j=Math.max(.1,1-Y/z)*3;y.push({point:k,type:"edge",edge:I,weight:j})}let A=y.filter(I=>ot.dist(t.point,I.point)>=g);if(A.length>0){let I=A.map(R=>R.weight),F=tn(I,i);return A[F]}}let p=[];if(t.type==="edge"){let c=(t.edge+2)%4,h=(t.edge+1)%4,m=(t.edge+3)%4,y=e<3?3:1.5;for(let I=0;I<3;I++){let F=.1+i()*.8;p.push({point:ut(c,F,n,s),type:"edge",edge:c,weight:y})}let A=1;for(let I=0;I<2;I++){let F=.1+i()*.8;p.push({point:ut(h,F,n,s),type:"edge",edge:h,weight:A}),p.push({point:ut(m,F,n,s),type:"edge",edge:m,weight:A})}}else if(t.type==="corner"){let c=(t.corner+2)%4;p.push({point:Fe(c,n,s),type:"corner",weight:2});for(let h=0;h<4;h++)if(!(h===t.corner||h===(t.corner+3)%4)){let y=.2+i()*.6;p.push({point:ut(h,y,n,s),type:"edge",edge:h,weight:1.5})}}else{for(let c=0;c<4;c++){let h=.1+i()*.8;p.push({point:ut(c,h,n,s),type:"edge",edge:c,weight:1})}if(o.length>1&&e>3)for(let c=0;c<Math.min(3,o.length);c++){let h=Math.floor(i()*o.length),m=o[h];if(t.type==="crease"&&t.creaseIndex===h)continue;let y=.15+i()*.7;p.push({point:dn(m,y),type:"crease",creaseIndex:h,weight:.6})}}if(o.length>0&&f)for(let c of p){let h=De(t.point,c.point);for(let m of o){let y=De(m.p1,m.p2),A=Math.abs(h-y);A>90&&(A=180-A),f.parallel>0&&A<15&&(c.weight*=1+f.parallel),f.perpendicular>0&&A>75&&(c.weight*=1+f.perpendicular)}}let u=p.filter(c=>ot.dist(t.point,c.point)>=g);if(u.length===0){for(let h=0;h<4;h++){let y=ut(h,.5,n,s);if(ot.dist(t.point,y)>=g)return{point:y,type:"edge",edge:h}}let c=t.type==="edge"?(t.edge+2)%4:0;return{point:ut(c,.5,n,s),type:"edge",edge:c}}let d=u.map(c=>c.weight),x=tn(d,i);return u[x]}function fo(t,e,o){let r=o.x-e.x,n=o.y-e.y,s=r*r+n*n;if(s===0)return ot.dist(t,e);let i=((t.x-e.x)*r+(t.y-e.y)*n)/s;i=Math.max(0,Math.min(1,i));let f={x:e.x+i*r,y:e.y+i*n};return ot.dist(t,f)}function uo(t){let e=[];for(let o=0;o<t.length;o++)for(let r=o+1;r<t.length;r++){let n=We(t[o].p1,t[o].p2,t[r].p1,t[r].p2);n&&e.push({x:n.point.x,y:n.point.y,crease1:o,crease2:r})}return e}function Ne(t,e,o,r,n={min:0,max:1},s=null,i=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let f=s||rn(r),a=on(r),g=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],b=[],M=null,p=null;if(!o||o<=0)return{creases:[],finalShape:g,maxFolds:a,firstFoldTarget:null,lastFoldTarget:null};let u=O(r),d=O(r+8888),x=O(r+6666),c=i||{absorbency:1,intersectionThreshold:0,angleAffinity:null,affinityStrength:0,ceilingMultiplier:1},h=[],m=O(r+1111);for(let R=0;R<a;R++)h[R]=.001+m()*.25;let y=O(r+2222),A={parallel:y()*.8,perpendicular:y()*.8},I=Math.max(t,e)*.05,F=[];for(let R=0;R<o;R++){let k=R%a,Y=Math.floor(R/a);if(k===0&&Y>0)for(let $ of b)$.reductionMultiplier!==void 0&&($.weight=Math.max(.01,$.weight*$.reductionMultiplier));R%5===0&&b.length>1&&(F=uo(b));let z=ao(R,b,F,t,e,u,f),j=co(z,R,b,F,t,e,u,A,f),P=z.point,l=j.point,H=x()<c.absorbency,S=n.min+d()*(n.max-n.min);if(c.angleAffinity!==null&&c.affinityStrength>0){let $=De(P,l),W=Math.abs($-c.angleAffinity);W>90&&(W=180-W);let Z=1-W/90*c.affinityStrength;S*=Z}if(H&&S>.01&&(b.push({p1:ot.copy(P),p2:ot.copy(l),depth:b.length,weight:S,cyclePosition:k,reductionMultiplier:h[k],anchorType:z.type,terminusType:j.type}),b.length>1)){let $=b[b.length-1];for(let W=0;W<b.length-1;W++){let Z=We($.p1,$.p2,b[W].p1,b[W].p2);Z&&F.push({x:Z.point.x,y:Z.point.y,crease1:W,crease2:b.length-1})}}let U=ot.mid(P,l),T={x:Math.max(I,Math.min(t-I,U.x)),y:Math.max(I,Math.min(e-I,U.y))};R===0&&M===null&&(M=T),p=T}return{creases:b,finalShape:g,maxFolds:a,firstFoldTarget:M,lastFoldTarget:p}}function ho(t){let e=[];for(let o=0;o<t.length;o++)for(let r=o+1;r<t.length;r++){let n=We(t[o].p1,t[o].p2,t[r].p1,t[r].p2);if(n){let s=t[o].weight||1,i=t[r].weight||1;e.push({x:n.point.x,y:n.point.y,depth1:t[o].depth,depth2:t[r].depth,gap:Math.abs(t[r].depth-t[o].depth),weight:s+i})}}return e}function hn(t,e,o,r,n,s=null,i=null){let f=ho(t),a=i||{intersectionThreshold:0,ceilingMultiplier:1},g=f.filter(c=>c.weight>=a.intersectionThreshold),b={},M={},p={};for(let c of g){let h=Math.floor(c.x/r),m=Math.floor(c.y/n);if(h>=0&&h<e&&m>=0&&m<o){let y=`${h},${m}`;b[y]=(b[y]||0)+c.weight,M[y]=Math.max(M[y]||0,c.gap),p[y]=(p[y]||0)+1}}let d=e*o*.5*a.ceilingMultiplier,x=Object.values(b).reduce((c,h)=>c+h,0);if(x>d&&x>0){let c=d/x,h=c+(1-c)*.3;for(let m of Object.keys(b))b[m]*=h}return{activeCreases:t,intersections:g,cellWeights:b,cellMaxGap:M,cellIntersectionCounts:p,destroyed:0,maxFolds:s}}function _e({folds:t,seed:e,outputWidth:o,outputHeight:r,bgColor:n,textColor:s,accentColor:i,cellWidth:f,cellHeight:a,renderMode:g,showEmptyCells:b=!1,multiColor:M,levelColors:p,foldStrategy:u=null,paperProperties:d=null,padding:x=0,showCreases:c=!1,showPaperShape:h=!1,showFoldTargets:m=!1,showIntersections:y=!1,showGrid:A=!1,showHitCounts:I=!1,showCellOutlines:F=!1,showCreaseLines:R=!1,fontFamily:k=ue,linesOnlyMode:Y=!1,analyticsMode:z=!1,skipCells:j=null}){let P=document.createElement("canvas"),l=P.getContext("2d"),gt=2;P.width=o*gt,P.height=r*gt,l.setTransform(gt,0,0,gt,0,0),l.fillStyle=n,l.fillRect(0,0,o,r);let H=o/1200,S=r/1697,U=1200-x*2-145*2,T=1697-x*2-145*2;{let w=15*H;l.font=`${w}px ${k}`,l.fillStyle=s,l.globalAlpha=.1;let E=w*ie,D=w*1.13;for(let K=0;K<r+D;K+=D)for(let rt=0;rt<o+E;rt+=E)l.fillText("\u2591",rt,K+D);l.globalAlpha=1}let $=cn(e,f,a,U,T),{cols:W,rows:Z,strideX:Pt,strideY:$t,gridOffsetX:he,gridOffsetY:pe}=$,ge=$.cellWidth,Xt=$.cellHeight,Rt=U*H,Ot=T*S,N=(x+145+he)*H,_=(x+145+pe)*S,mt=ge*H,yt=Xt*S,lt=Pt*H,bt=$t*S,Yt=Oe(e),wt=an(d,W,Z),Ct=$.actualGridWidth,Tt=$.actualGridHeight,{creases:At,finalShape:St,maxFolds:xe,firstFoldTarget:Lt,lastFoldTarget:It}=Ne(Ct,Tt,t,e,Yt,u,wt),me=At.map(v=>({...v,p1:{x:v.p1.x*H,y:v.p1.y*S},p2:{x:v.p2.x*H,y:v.p2.y*S}})),Qt=null;if(Lt){let v=Math.max(0,Math.min(W-1,Math.floor(Lt.x/Pt))),w=Math.max(0,Math.min(Z-1,Math.floor(Lt.y/$t)));Qt=`${v},${w}`}let Zt=null;if(It){let v=Math.max(0,Math.min(W-1,Math.floor(It.x/Pt))),w=Math.max(0,Math.min(Z-1,Math.floor(It.y/$t)));Zt=`${v},${w}`}let{activeCreases:vt,intersections:dt,cellWeights:X,cellMaxGap:ht}=hn(me,W,Z,lt,bt,xe,d),st=new Set;if(Object.keys(ht).length>0){let v=Math.max(...Object.values(ht));for(let[w,E]of Object.entries(ht))E===v&&st.add(w)}let zt=1+le+ae,V=yt/zt;l.font=`${V}px ${k}`,l.textBaseline="top";let tt=[" ","\u2591","\u2592","\u2593"],et=V<30?2:3,B=V*ie,J=V*le,jt=V*ae,Be=V*Tn,Pe=V*Sn,Mt=fn(X),ye=un(e,W,g),{cellOverflowAmount:te,drawDirectionMode:Me,invertedSingleCharOnEmpty:Ut,getOverlapFactor:Kt,getCellDirection:be}=ye,kt=(v,w)=>p&&p.length>0?p[Math.min(v,3)]:s,Ft=O(e+22222),Wt=Ft()<.25,Ce=Math.round(2+Ft()*2)*H,mn=Math.round(1+Ft()*2)*S,yn=Wt?.4+Ft()*.3:0,Mn=(v,w)=>{let E=O(e+22222+v*1e3+w),D=Math.floor(E()*3);return{x:D!==1?Ce:0,y:D!==0?mn:0}},bn=Wt?(()=>{if(i&&i!==s)return i;let v=ke(s),w=nt.filter(K=>K.hex!==s&&K.hex!==n&&Gn(K,v)>100),E=Math.floor(Ft()*w.length);return(w.length>0?w[E]:nt[0]).hex})():null,$e=(x+145)*H,ve=(x+145)*S,Ee=$e+Pe,Cn=ve+J,we=$e+Rt,Ho=ve+Ot-jt;if(Y){let v=L=>{let G=parseInt(L.slice(1,3),16),it=parseInt(L.slice(3,5),16),Q=parseInt(L.slice(5,7),16);return Ue(G,it,Q)},w=v(n),E=v(s),D=v(i),K=Math.abs(w-E)>Math.abs(w-D)?s:i,rt=2*H;if(vt.length>0){l.strokeStyle=K,l.lineWidth=rt,l.globalAlpha=1,l.lineCap="round";for(let L of vt)l.beginPath(),l.moveTo(N+L.p1.x,_+L.p1.y),l.lineTo(N+L.p2.x,_+L.p2.y),l.stroke()}if(dt&&dt.length>0){l.strokeStyle=K,l.lineWidth=rt,l.globalAlpha=1;let L=4*H;for(let G of dt)l.beginPath(),l.arc(N+G.x,_+G.y,L,0,Math.PI*2),l.stroke()}l.globalAlpha=1}else if(z){let v=2*H;l.strokeStyle=i,l.lineWidth=1,l.globalAlpha=.4;for(let E=0;E<=W;E++){let D=N+E*lt;l.beginPath(),l.moveTo(D,_),l.lineTo(D,_+Ot),l.stroke()}for(let E=0;E<=Z;E++){let D=_+E*bt;l.beginPath(),l.moveTo(N,D),l.lineTo(N+Rt,D),l.stroke()}if(l.globalAlpha=1,vt.length>0){l.strokeStyle=i,l.lineWidth=v,l.globalAlpha=1,l.lineCap="round";for(let E of vt)l.beginPath(),l.moveTo(N+E.p1.x,_+E.p1.y),l.lineTo(N+E.p2.x,_+E.p2.y),l.stroke()}if(dt&&dt.length>0){l.strokeStyle=i,l.lineWidth=v,l.globalAlpha=1;let E=4*H;for(let D of dt)l.beginPath(),l.arc(N+D.x,_+D.y,E,0,Math.PI*2),l.stroke()}let w=Math.floor(Math.min(mt*.45,yt*.7));l.font=`bold ${w}px monospace`,l.textAlign="center",l.textBaseline="middle",l.fillStyle=i;for(let E=0;E<Z;E++)for(let D=0;D<W;D++){let K=Math.round(N+D*lt+mt/2),rt=Math.round(_+E*bt+yt/2),L=`${D},${E}`,G=X[L]||0;l.fillText(Math.round(G).toString(),K,rt)}l.textAlign="left",l.textBaseline="top"}else if(I){let v=Math.floor(Math.min(mt*.45,yt*.7));l.font=`bold ${v}px monospace`,l.textAlign="center",l.textBaseline="middle",l.fillStyle=s;for(let w=0;w<Z;w++)for(let E=0;E<W;E++){let D=Math.round(N+E*lt+mt/2),K=Math.round(_+w*bt+yt/2),rt=`${E},${w}`,L=X[rt]||0;l.fillText(Math.round(L).toString(),D,K)}l.textAlign="left",l.textBaseline="top"}else{let v=Math.max(N,Ee),w=Math.max(_,Cn);for(let E=0;E<Z;E++){let D=Math.round(w+E*bt);if(!(D>ve+Ot))for(let K=0;K<W;K++){let rt=Math.round(v+K*lt),L=`${K},${E}`;if(j&&j.has(L))continue;let G=X[L]||0,it=null,Q=s,q=-1,Nt=!1;if(Qt===L)q=G>0?xt(G,Mt):2,it=tt[Math.min(Math.max(q,2),et)],Q=i;else if(g==="normal")if(q=xt(G,Mt),q===0?it=null:it=tt[Math.min(q,et)],Q=kt(q,L),G>=1.5){let _t=G-1.5,Dt=30+Math.min(_t*300,150),ct=Se(s);Q=Te((ct.h+Dt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else st.has(L)&&G>0?Q=i:Zt===L&&(Q=s);else if(g==="binary")G===0?b&&(it=tt[1],q=0,Nt=!0,Q=s):(q=et,it=tt[q],Q=kt(q,L),st.has(L)&&(Q=i));else if(g==="inverted")if(q=Math.min(3-xt(G,Mt),et),it=tt[q],Q=kt(q,L),G>=1.5){let _t=G-1.5,Dt=30+Math.min(_t*300,150),ct=Se(s);Q=Te((ct.h+Dt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else st.has(L)&&G>0&&(Q=i);else if(g==="sparse")q=xt(G,Mt),q===1?(it=tt[1],Q=kt(1,L),st.has(L)&&(Q=i)):it=null;else if(g==="dense")if(q=xt(G,Mt),q>=2)if(it=tt[Math.min(q,et)],Q=kt(q,L),G>=1.5){let _t=G-1.5,Dt=30+Math.min(_t*300,150),ct=Se(s);Q=Te((ct.h+Dt+360)%360,Math.min(100,ct.s+20),Math.min(85,ct.l+10))}else st.has(L)&&(Q=i);else it=null;if(it){if(Qt===L||Zt===L)l.fillStyle=Q;else{let at=kt(xt(G,Mt),L);l.fillStyle=st.has(L)&&G>0?i:at}Nt&&(l.globalAlpha=.1,l.fillStyle=s);let _t=l.measureText(it).width,Dt=rt+mt,ct=Math.min(Dt,we),Vt=ct-rt;if(Vt<B*.5)continue;let En=Nt||G===0&&g!=="inverted",Ae=g==="inverted"&&G===0&&Ut,wn=En||Ae?1:Kt(E,K),Xe=B*wn,Ie=Math.max(1,Math.floor((Vt-B)/Xe)+1),An=(Ie-1)*Xe+B,Et=(Vt-An)/B>.3?Ie+1:Ie,Gt=Et<=1?B:(Vt-B)/(Et-1),Ye=Nt||Ae?0:te*mt,ze=0;Ye>0&&(ze=Math.ceil(Ye/Gt));let In=Ae?1:Et+ze,je=be(E,K),ee=rt+Vt/2;for(let at=0;at<In&&q>=0;at++){let Re=it;q>=2&&at>0&&at%2===0&&(Re=tt[Math.max(0,q-1)]);let ft;if(je==="center")if(at<Et){let pt=Math.floor((at+1)/2)*Gt;at%2===0?ft=ee+(at===0?-B/2:pt-B/2):ft=ee-pt-B/2}else{let pt=at-Et,ne=Math.floor(Et/2)*Gt,oe=Math.floor((pt+1)/2)*Gt;if(pt%2===0){if(ft=ee+ne+oe,ft+B>we)break}else if(ft=ee-ne-oe-B,ft<Ee)break}else if(at<Et)ft=rt+at*Gt;else if(je==="rtl"){let pt=at-Et;if(ft=rt-(pt+1)*Gt,ft<Ee)break}else{let pt=at-Et;if(ft=ct+pt*Gt,ft+B>we)break}if(Wt&&!Nt){let pt=Mn(E,K),ne=l.globalAlpha,oe=l.fillStyle;l.globalAlpha=yn,l.fillStyle=bn,l.fillText(Re,ft+pt.x,D+pt.y),l.globalAlpha=ne,l.fillStyle=oe}l.fillText(Re,ft,D)}Nt&&(l.globalAlpha=1)}}}}if(F){l.strokeStyle=i,l.lineWidth=.5,l.globalAlpha=1;for(let v=0;v<Z;v++)for(let w=0;w<W;w++){let E=Math.round(N+w*lt),D=Math.round(_+v*bt);l.strokeRect(E,D,mt,yt)}}if(R&&vt.length>0){let w=O(e+9292)()<.6;l.strokeStyle=w?i:s,l.lineWidth=1.5*H,l.globalAlpha=.85,l.lineCap="round";for(let E of vt)l.beginPath(),l.moveTo(N+E.p1.x,_+E.p1.y),l.lineTo(N+E.p2.x,_+E.p2.y),l.stroke();l.globalAlpha=1}if(c){let v=L=>{let G=parseInt(L.slice(1,3),16),it=parseInt(L.slice(3,5),16),Q=parseInt(L.slice(5,7),16);return Ue(G,it,Q)},w=v(n),E=v(s),D=v(i),K=Math.abs(w-E)>Math.abs(w-D)?s:i,rt=2*H;l.strokeStyle=K,l.lineWidth=rt,l.globalAlpha=1,l.lineCap="round";for(let L of vt)l.beginPath(),l.moveTo(N+L.p1.x,_+L.p1.y),l.lineTo(N+L.p2.x,_+L.p2.y),l.stroke();if(dt&&dt.length>0){l.strokeStyle=K,l.lineWidth=rt,l.globalAlpha=1;let L=4*H;for(let G of dt)l.beginPath(),l.arc(N+G.x,_+G.y,L,0,Math.PI*2),l.stroke()}}if(h){let v=St.map(w=>({x:w.x*H,y:w.y*S}));if(v.length>=3){l.strokeStyle="#00ffff",l.lineWidth=2,l.globalAlpha=.9,l.beginPath(),l.moveTo(N+v[0].x,_+v[0].y);for(let w=1;w<v.length;w++)l.lineTo(N+v[w].x,_+v[w].y);l.closePath(),l.stroke(),l.fillStyle="#00ffff",l.globalAlpha=.15,l.fill(),l.globalAlpha=1}}if(A){l.strokeStyle=s,l.lineWidth=1,l.globalAlpha=.3;for(let v=0;v<=W;v++){let w=N+v*lt;l.beginPath(),l.moveTo(w,_),l.lineTo(w,_+Ot),l.stroke()}for(let v=0;v<=Z;v++){let w=_+v*bt;l.beginPath(),l.moveTo(N,w),l.lineTo(N+Rt,w),l.stroke()}l.globalAlpha=1}if(m){let v=8*H;if(l.lineWidth=2,l.globalAlpha=1,Lt){let w=N+Lt.x*H,E=_+Lt.y*S;l.strokeStyle="#00ff00",l.beginPath(),l.arc(w,E,v,0,Math.PI*2),l.stroke()}if(It){let w=N+It.x*H,E=_+It.y*S;l.strokeStyle="#00ff00",l.beginPath(),l.arc(w,E,v,0,Math.PI*2),l.stroke()}}let vn={grid:{cols:W,rows:Z,colGap:$.colGap,rowGap:$.rowGap},drawDirection:Me,foldStrategy:u?.type||"random",multiColor:M,showCreaseLines:R,creaseCount:At.length};return{canvas:P,dataUrl:P.toDataURL("image/png"),settings:vn}}function He(t,e=1200,o=1697,r=0,n=null){let s=Oe(t),i=rn(t),f=on(t),a=to(t),g=n;if(g===null){let j=O(t+9999);g=Math.floor(1+j()*500)}let b=e-145*2,M=o-145*2,{creases:p}=Ne(b,M,g,t,s,i,a),u=p.length,d=sn(u),x=Kn(t,u),c=Pn(t),h,m=null;x?(m=Vn(t),h=qn(t,c,m)):h=c;let y=x?!1:Un(t),A=null;x?A=Jn(h.bg,h.text):y&&(A=jn(t,h.bg,h.text));let I=$n(e,o,0,t),F=Xn(t),R=Yn(t),k=Qn(t),Y=Zn(t),z=zn(t);return{seed:t,palette:h,cells:I,renderMode:F,showEmptyCells:R,weightRange:s,foldStrategy:i,gradientMode:x,gradientProbability:d,creaseCount:u,multiColor:y,levelColors:A,maxFolds:f,paperProperties:a,showCreaseLines:k,analyticsMode:Y,overlapInfo:z,folds:g}}function po(t,e,o,r=""){let n=He(e,1200,1697,0,o),s=eo(n.paperProperties),i=Math.round(n.gradientProbability*100),f;return n.gradientMode?f=`gradient/${n.palette.anchorType||"background"} (${i}% @ ${n.creaseCount} creases)`:f=`cga/${n.palette.strategy} (${i}% gradient @ ${n.creaseCount} creases)`,{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:r?`${r}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:n.foldStrategy.type},{trait_type:"Render Mode",value:n.renderMode},{trait_type:"Multi-Color",value:n.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${n.cells.cellW}x${n.cells.cellH}`},{trait_type:"Fold Count",value:o},{trait_type:"Max Folds",value:n.maxFolds},{trait_type:"Crease Count",value:n.creaseCount},{trait_type:"Palette Strategy",value:f},{trait_type:"Paper Type",value:s},{trait_type:"Paper Grain",value:n.paperProperties.angleAffinity!==null?"Grain":"Uniform"},...n.showCreaseLines?[{trait_type:"Crease Lines",value:"Visible"}]:[]]}}async function go(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${Jt}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${Jt}`),await document.fonts.ready,!0}catch(o){return console.warn("Failed to load on-chain font:",o),!1}}function xo(t){if(typeof t=="number")return t;if(typeof t!="string")return 0;let e=t.replace(/^0x/,"").slice(0,16),o=BigInt("0x"+e);return Number(o%BigInt(2147483647))}var se=null;function mo(t,e,o){let{seed:r,foldCount:n,params:s}=t,{palette:i,cells:f,renderMode:a,showEmptyCells:g,multiColor:b,levelColors:M,foldStrategy:p,paperProperties:u}=s,{cellW:d,cellH:x}=f,{bg:c,text:h,accent:m}=i,y=e/1200,A=o/1697,I=1200-145*2,F=1697-145*2,R=cn(r,d,x,I,F),{cols:k,rows:Y,strideX:z,strideY:j,gridOffsetX:P,gridOffsetY:l}=R,gt=R.cellWidth,H=R.cellHeight,S=(145+P)*y,U=(145+l)*A,T=gt*y,$=H*A,W=z*y,Z=j*A,Pt=Oe(r),$t=an(u,k,Y),he=R.actualGridWidth,pe=R.actualGridHeight,{creases:ge,firstFoldTarget:Xt,lastFoldTarget:Rt}=Ne(he,pe,n,r,Pt,p,$t),Ot=ge.map(X=>({...X,p1:{x:X.p1.x*y,y:X.p1.y*A},p2:{x:X.p2.x*y,y:X.p2.y*A}})),N=null;if(Xt){let X=Math.max(0,Math.min(k-1,Math.floor(Xt.x/z))),ht=Math.max(0,Math.min(Y-1,Math.floor(Xt.y/j)));N=`${X},${ht}`}let _=null;if(Rt){let X=Math.max(0,Math.min(k-1,Math.floor(Rt.x/z))),ht=Math.max(0,Math.min(Y-1,Math.floor(Rt.y/j)));_=`${X},${ht}`}let{cellWeights:mt,cellMaxGap:yt}=hn(Ot,k,Y,W,Z,n,u),lt=new Set;if(Object.keys(yt).length>0){let X=Math.max(...Object.values(yt));for(let[ht,st]of Object.entries(yt))st===X&&lt.add(ht)}let bt=1+le+ae,Yt=$/bt,wt=Yt*ie,Ct=[" ","\u2591","\u2592","\u2593"],Tt=Yt<30?2:3,At=fn(mt),St=(X,ht)=>b&&M&&M[X]?M[X]:h,xe=un(r,k,a),{cellOverflowAmount:Lt,invertedSingleCharOnEmpty:It,getOverlapFactor:me,getCellDirection:Qt}=xe,Zt=145*y,vt=1055*y,dt=[];for(let X=0;X<Y;X++){let ht=U+X*Z;for(let st=0;st<k;st++){let zt=S+st*W,V=`${st},${X}`,tt=mt[V]||0,et=null,B=h,J=-1,jt=!1;if(N===V?(J=tt>0?xt(tt,At):2,et=Ct[Math.min(Math.max(J,2),Tt)],B=m):a==="normal"?(J=xt(tt,At),J===0?et=null:et=Ct[Math.min(J,Tt)],B=St(J,V),lt.has(V)&&tt>0?B=m:_===V&&(B=h)):a==="binary"?tt===0?g&&(et=Ct[1],jt=!0,B=h):(J=Tt,et=Ct[J],B=St(J,V),lt.has(V)&&(B=m)):a==="inverted"?(J=Math.min(3-xt(tt,At),Tt),et=Ct[J],B=St(J,V),lt.has(V)&&tt>0&&(B=m)):a==="sparse"?(J=xt(tt,At),J===1?(et=Ct[1],B=St(1,V),lt.has(V)&&(B=m)):et=null):a==="dense"&&(J=xt(tt,At),J>=2?(et=Ct[Math.min(J,Tt)],B=St(J,V),lt.has(V)&&(B=m)):et=null),!et||et===" "||jt)continue;let Be=zt+T,Mt=Math.min(Be,vt)-zt;if(Mt<wt*.5)continue;let ye=jt||tt===0&&a!=="inverted",te=a==="inverted"&&tt===0&&It,Me=ye||te?1:me(X,st),Ut=wt*Me,Kt=Math.max(1,Math.floor((Mt-wt)/Ut)+1),be=(Kt-1)*Ut+wt,Ft=(Mt-be)/wt,Wt=te?1:Ft>.3?Kt+1:Kt,Ce=et.repeat(Wt);dt.push({id:`char-${X}-${st}`,char:Ce,editChar:et,x:zt,y:ht,width:T,height:$,fontSize:Yt,color:B,row:X,col:st,level:J,numChars:Wt,step:Ut,charWidth:wt,isAccent:lt.has(V),isFoldTarget:N===V||_===V})}}return{characters:dt,background:{color:c,textureColor:h,textureOpacity:.1},grid:{cols:k,rows:Y,cellWidth:T,cellHeight:$,offsetX:S,offsetY:U}}}function yo(t,e){let o;return function(...r){clearTimeout(o),o=setTimeout(()=>t.apply(this,r),e)}}var C={charData:null,charElements:[],textBuffer:[],originalPositions:new Map,cursorIndex:-1,isEditing:!1,dragState:null,hiddenInput:null,container:null,bgCanvas:null,charLayer:null,loading:null,state:null,renderWidth:0,renderHeight:0,redrawCanvas:null},Mo=`
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    overflow: hidden;
  }
  .fold-container {
    position: relative;
    width: min(100vw, calc(100vh * 1200 / 1697));
    height: min(100vh, calc(100vw * 1697 / 1200));
  }
  .fold-loading {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #fff;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "Courier New", monospace;
    font-size: 24px;
    color: #000;
  }
  .fold-bg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
  }
  .fold-chars {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    overflow: hidden;
  }
  .fold-char {
    position: absolute;
    cursor: default;
    user-select: none;
    font-family: "${Jt}", "Courier New", monospace;
    line-height: 1;
    white-space: pre;
  }
  .fold-char.dragging {
    cursor: grabbing;
    z-index: 1000;
    filter: brightness(1.2);
  }
  .fold-char.editing::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 2px;
    height: 60%;
    background: currentColor;
    animation: cursor-blink 1s step-end infinite;
  }
  @keyframes cursor-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
`;function bo(){if(document.getElementById("fold-interactive-css"))return;let t=document.createElement("style");t.id="fold-interactive-css",t.textContent=Mo,document.head.appendChild(t)}function Co(){let t=document.createElement("div");t.className="fold-container",t.id="fold-container",t.style.cssText="position:relative;width:min(100vw,calc(100vh*1200/1697));height:min(100vh,calc(100vw*1697/1200))";let e=document.createElement("div");e.className="fold-loading",e.id="fold-loading",e.textContent="\u2592",e.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;background:#fff;z-index:100;display:flex;align-items:center;justify-content:center;font-family:Courier New,monospace;font-size:24px;color:#000";let o=document.createElement("canvas");o.className="fold-bg",o.id="fold-bg";let r=document.createElement("div");return r.className="fold-chars",r.id="fold-chars",t.appendChild(e),t.appendChild(o),t.appendChild(r),document.body.appendChild(t),C.container=t,C.bgCanvas=o,C.charLayer=r,C.loading=e,{container:t,bgCanvas:o,charLayer:r,loading:e}}function vo(t){let{isEditing:e,cursorIndex:o,textBuffer:r,hiddenInput:n,redrawCanvas:s}=C;if(!e||o<0)return;let i=t.data;if(!i)return;for(let a=0;a<i.length;a++){let g=o+a;if(g>=r.length)break;let b=r[g];b.char=i[a]}let f=Math.min(o+i.length,r.length-1);f!==o&&(C.cursorIndex=f),s&&s(!0),qt(),n.value=""}function Eo(t){let{isEditing:e,cursorIndex:o,textBuffer:r,redrawCanvas:n}=C;if(e){if(t.key==="Escape"){de();return}if(t.key==="ArrowLeft")t.preventDefault(),o>0&&(C.cursorIndex=o-1,n&&n(!0),qt());else if(t.key==="ArrowRight")t.preventDefault(),o<r.length-1&&(C.cursorIndex=o+1,n&&n(!0),qt());else if(t.key==="Backspace"){t.preventDefault();let s=r[o];s.char=s.originalChar,o>0&&(C.cursorIndex=o-1),n&&n(!0),qt()}else if(t.key==="Delete"){t.preventDefault();let s=r[o];s.char=s.originalChar,n&&n(!0)}}}function wo(){setTimeout(()=>{C.hiddenInput&&!C.hiddenInput.matches(":focus")&&de()},100)}function qt(){let{charElements:t,cursorIndex:e,hiddenInput:o,textBuffer:r}=C;if(t.forEach(n=>{n.classList.remove("editing"),n.style.color=""}),e>=0&&e<t.length){let n=r[e];n&&(n.el.style.color=n.color),t[e].classList.add("editing"),o&&(o.style.left=t[e].style.left,o.style.top=t[e].style.top)}}function Ao(t){C.isEditing=!0,C.cursorIndex=t,C.redrawCanvas&&C.redrawCanvas(!0),qt(),C.hiddenInput&&C.hiddenInput.focus()}function de(){let{charElements:t,redrawCanvas:e}=C;C.isEditing=!1,C.cursorIndex=-1,t.forEach(o=>{o.classList.remove("editing","cursor"),o.style.color=""}),C.hiddenInput&&C.hiddenInput.blur(),e&&e(!1)}function Io(t){t.addEventListener("mousedown",Ro),t.addEventListener("touchstart",To,{passive:!1}),document.addEventListener("mousemove",So),document.addEventListener("touchmove",Lo,{passive:!1}),document.addEventListener("mouseup",ko),document.addEventListener("touchend",Fo),t.addEventListener("dblclick",Do)}function Ro(t){let e=t.target.closest(".fold-char");e&&(t.preventDefault(),pn(e,t.clientX,t.clientY))}function To(t){let e=t.target.closest(".fold-char");if(!e)return;t.preventDefault();let o=t.touches[0];pn(e,o.clientX,o.clientY)}function pn(t,e,o){let r=t.getBoundingClientRect(),n=C.container.getBoundingClientRect();C.dragState={el:t,offsetX:e-r.left,offsetY:o-r.top,containerRect:n},t.classList.add("dragging")}function So(t){C.dragState&&gn(t.clientX,t.clientY)}function Lo(t){if(!C.dragState)return;t.preventDefault();let e=t.touches[0];gn(e.clientX,e.clientY)}function gn(t,e){let{el:o,containerRect:r,offsetX:n,offsetY:s}=C.dragState,i=t-r.left-n,f=e-r.top-s;o.style.left=i+"px",o.style.top=f+"px"}function ko(){xn()}function Fo(){xn()}function xn(){C.dragState&&(C.dragState.el.classList.remove("dragging"),C.dragState=null)}function Do(t){let e=t.target.closest(".fold-char");if(!e)return;t.preventDefault();let o=parseInt(e.dataset.index,10);isNaN(o)||Ao(o)}function Go(t){let{state:e,renderWidth:o,renderHeight:r,textBuffer:n,container:s}=C;if(!e||!s)return;let i=o,f=r,{params:a}=e,g=new Set;for(let u of n)u.char!==u.originalChar&&g.add(`${u.col},${u.row}`);let b=_e({folds:a.folds,seed:e.seed,outputWidth:i,outputHeight:f,bgColor:a.palette.bg,textColor:a.palette.text,accentColor:a.palette.accent,cellWidth:a.cells.cellW,cellHeight:a.cells.cellH,renderMode:a.renderMode,showEmptyCells:a.showEmptyCells,multiColor:a.multiColor,levelColors:a.levelColors,foldStrategy:a.foldStrategy,paperProperties:a.paperProperties,showCreaseLines:a.showCreaseLines,analyticsMode:a.analyticsMode,skipCells:g.size>0?g:null}),M=b.canvas.getContext("2d"),p=b.canvas.width/i;for(let u of n)if(u.char!==u.originalChar&&u.char.trim()!==""){let d=u.fontSize*p;M.font=`${d}px ${ue}`,M.fillStyle=u.color,M.textAlign="center",M.textBaseline="middle";let x=(u.x+u.width/2)*p,c=(u.y+u.height/2)*p;M.fillText(u.char,x,c)}b.canvas.toBlob(u=>{let d=URL.createObjectURL(u),x=document.createElement("a");x.href=d,x.download=`fold-${t||"edit"}.png`,x.click(),URL.revokeObjectURL(d)},"image/png")}function Oo(){de();let{charElements:t,textBuffer:e,originalPositions:o,redrawCanvas:r}=C;for(let n=0;n<t.length;n++){let s=t[n],i=o.get(n);i&&(s.style.left=i.x+"px",s.style.top=i.y+"px",e[n]&&(e[n].char=i.editChar,e[n].x=i.x,e[n].y=i.y))}r&&r(!1)}function Wo(t){document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="s"){e.preventDefault(),Go(t);return}C.isEditing||e.key==="Escape"&&(e.preventDefault(),Oo())})}function en(t,e,o){let{bgCanvas:r,charLayer:n}=C,{seed:s,params:i}=t;C.state=t,C.renderWidth=e,C.renderHeight=o;let f=(g=!1)=>{let b=new Set;for(let d=0;d<C.textBuffer.length;d++){let x=C.textBuffer[d];(g&&d===C.cursorIndex||x.char!==x.originalChar)&&b.add(`${x.col},${x.row}`)}let M=_e({folds:i.folds,seed:s,outputWidth:e,outputHeight:o,bgColor:i.palette.bg,textColor:i.palette.text,accentColor:i.palette.accent,cellWidth:i.cells.cellW,cellHeight:i.cells.cellH,renderMode:i.renderMode,showEmptyCells:i.showEmptyCells,multiColor:i.multiColor,levelColors:i.levelColors,foldStrategy:i.foldStrategy,paperProperties:i.paperProperties,showCreaseLines:i.showCreaseLines,analyticsMode:i.analyticsMode,skipCells:b.size>0?b:null});r.width=M.canvas.width,r.height=M.canvas.height,r.style.width=e+"px",r.style.height=o+"px";let p=r.getContext("2d");p.drawImage(M.canvas,0,0);let u=M.canvas.width/e;for(let d=0;d<C.textBuffer.length;d++){let x=C.textBuffer[d];if(!(g&&d===C.cursorIndex)&&x.char!==x.originalChar&&x.char.trim()!==""){let h=x.fontSize*u;p.font=`${h}px ${ue}`,p.fillStyle=x.color,p.textAlign="center",p.textBaseline="middle";let m=(x.x+x.width/2)*u,y=(x.y+x.height/2)*u;p.fillText(x.char,m,y),p.textAlign="left",p.textBaseline="top"}}};C.redrawCanvas=f,f(!1);let a=mo(t,e,o);C.charData=a,No(n,a.characters)}function No(t,e){de(),t.innerHTML="",C.charElements=[],C.originalPositions.clear(),C.textBuffer=[],C.hiddenInput=null;for(let r=0;r<e.length;r++){let n=e[r],s=document.createElement("div");s.className="fold-char",s.dataset.index=r,s.style.cssText=`
      position: absolute;
      left: ${n.x}px;
      top: ${n.y}px;
      width: ${n.width}px;
      height: ${n.height}px;
      user-select: none;
      background: transparent;
    `;let i=n.editChar||n.char.charAt(0),f=n.numChars||n.char.length;C.originalPositions.set(r,{x:n.x,y:n.y,char:n.char,editChar:i,numChars:f}),C.textBuffer.push({char:i,originalChar:i,displayChar:n.char,numChars:f,el:s,color:n.color,fontSize:n.fontSize,x:n.x,y:n.y,width:n.width,height:n.height,row:n.row,col:n.col,step:n.step,charWidth:n.charWidth}),t.appendChild(s),C.charElements.push(s)}let o=document.createElement("input");o.type="text",o.style.cssText="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;",o.addEventListener("input",vo),o.addEventListener("keydown",Eo),o.addEventListener("blur",wo),t.appendChild(o),C.hiddenInput=o}async function Ge(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,o=typeof window<"u"&&window.LESS_SEED;if(o&&!t&&(t=xo(o)),t&&e===void 0){let n=O(t+9999);e=Math.floor(1+n()*500)}let r=typeof window<"u"&&window.FONT_DATA_URI||nn;if(t&&e!==void 0){await go(r),bo(),Co();let n=He(t,1200,1697,0,e);se={seed:t,foldCount:e,params:n};let i=C.container.getBoundingClientRect();en(se,i.width,i.height),C.loading&&(C.loading.style.display="none"),Io(C.charLayer),Wo(t),typeof window<"u"&&(window.RENDER_COMPLETE=!0),window.addEventListener("resize",yo(()=>{if(se){let f=C.container.getBoundingClientRect();en(se,f.width,f.height)}},150))}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0||window.LESS_SEED)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Ge()):Ge());})();
