(()=>{var At="FoldMono",qt="data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAOIAA4AAAAADAQAAAM2AAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwmBmAAPBEQCo9sjiABNgIkAwwLDAAEIAWCfAcgGzkKIK4GbGOy2GicLj5u8RpRKYyZuIy26Oe9GkG0llXPQhAUoVLRQOiIjYYnUuLluRfqlUh8nv35d3DbeacPRpI7wLzuWl2XGTr+R4rdqk48ecPEg8A0wvynUz9VJ0gGYLd1C/5xl7xv3SZnBWzBGr8QtP8P9KU3gF/4v///XtV/LeBjv+MBmzYJYqG96Ce0h6/5XmbHBNnLAlygYMFqXKAK1bYRcgkLxgZhXaf627YE6gFJIBcCteo1AuwbDBChbA4tEHHa8CDi2utCBABSXokNorp4phkhurc/Cdkmqp0bWqrKalIqUp4jaAbAzD4U5MOrPfX1JpR/yDVAQLZF3YE+VCRkaEcRaEc1Bkq5kJLE/gHUNnm3+zdMKK9aMhR+h189BajFT9I/lJ0BIAcwLMQ2l3Yj73wvYnyWbjmo3XbjJ0eY8W5h/BrjMzLJ2VlnUo3PYuKqtuQN3OLm3X+/upK1DTdwjZsDyUyqec6GEF09syI3F92yUZdMJ62DE7XK6uCueMYse9occDNSOJk2TzuvAA1ohsS27Vw8Tqt1nSmHabjbFnGndFO5K3PzpJ4CUz1JBorMmHHLdmQwBHRTnMkKhQ2QvVOwlGW8DcP5FqbrJJvdjsuaDB97D7UPuQfMWVxWiURGZPMptIkVhKEJKCNQDIyTFKlyZLbV+p53gX4egWr7bX73rYYTy+fRt6NAzImHc31/acg9fC0EFH1/obMyd7VtOx4JfU3acYK4OL1wfhzUFbtqf+2dJ+YG3K/voIAkorej7to5G4ZgZG5J17dlDgasZyO9xT2bOM2geuh5N335H/05CBAo+D8a3teHrs9kVYNvlTICfznXj/qG+mEqQY0AQfnnlyCvvGfUD0jWq5FXOCj0rhgQshT513IJVZZQRF6DIzii0KmJkkZPKLNkNZ7LUKHHe3ulrkb3x2Kgo2PDk1VXwRPT09UzttAnIRgd6m8KBWMNkbgGj19b25mmG2vqxkaEs7LdVDE0VVGmSeKcTHfjguaJm3smpWsmdnzBsDSJIzDqMKW8o1bEecw0dHS0TGzyS4Z6n9NTNSaXDzlPw2BeyPLakJQRk0Wx9HurZUEAAA==",Ee='"Courier New", Courier, monospace',Jt=`"${At}", ${Ee}`,Lt=[0,51,102,153,204,255];function Qt(t,e,n){return"#"+[t,e,n].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function _t(t,e,n){let r=t/255,o=e/255,s=n/255;return(.2126*r+.7152*o+.0722*s)*100}function Zt(t,e,n){let r=t-n;return Math.abs(r)<30&&Math.abs(t-e)<30&&Math.abs(e-n)<30?"neutral":r>0?"warm":"cool"}function te(t,e,n){let r=Math.max(t,e,n),o=Math.min(t,e,n),s=r-o;return s<20?"gray":s<80?"muted":s<160?"chromatic":"vivid"}function we(){let t=[];for(let e=0;e<6;e++)for(let n=0;n<6;n++)for(let r=0;r<6;r++){let o=Lt[e],s=Lt[n],i=Lt[r];t.push({hex:Qt(o,s,i),r:o,g:s,b:i,cubePos:{ri:e,gi:n,bi:r},luminance:_t(o,s,i),temperature:Zt(o,s,i),saturation:te(o,s,i),type:"websafe"})}return t}var Te=[{hex:"#000000",name:"black"},{hex:"#0000AA",name:"blue"},{hex:"#00AA00",name:"green"},{hex:"#00AAAA",name:"cyan"},{hex:"#AA0000",name:"red"},{hex:"#AA00AA",name:"magenta"},{hex:"#AA5500",name:"brown"},{hex:"#AAAAAA",name:"lightGray"},{hex:"#555555",name:"darkGray"},{hex:"#5555FF",name:"lightBlue"},{hex:"#55FF55",name:"lightGreen"},{hex:"#55FFFF",name:"lightCyan"},{hex:"#FF5555",name:"lightRed"},{hex:"#FF55FF",name:"lightMagenta"},{hex:"#FFFF55",name:"yellow"},{hex:"#FFFFFF",name:"white"}];function Re(){return Te.map(t=>{let e=parseInt(t.hex.slice(1,3),16),n=parseInt(t.hex.slice(3,5),16),r=parseInt(t.hex.slice(5,7),16);return{hex:t.hex,r:e,g:n,b:r,cubePos:null,luminance:_t(e,n,r),temperature:Zt(e,n,r),saturation:te(e,n,r),type:"cga",name:t.name}})}function Ie(){let t=[];for(let e=0;e<24;e++){let n=Math.round(e/23*255);t.push({hex:Qt(n,n,n),r:n,g:n,b:n,cubePos:null,luminance:_t(n,n,n),temperature:"neutral",saturation:"gray",type:"grayscale",grayIndex:e})}return t}var C=[...we(),...Re(),...Ie()],ct={dark:C.filter(t=>t.luminance<30),midDark:C.filter(t=>t.luminance>=20&&t.luminance<50),mid:C.filter(t=>t.luminance>=40&&t.luminance<70),midLight:C.filter(t=>t.luminance>=55&&t.luminance<85),light:C.filter(t=>t.luminance>=70)},St={warm:C.filter(t=>t.temperature==="warm"),cool:C.filter(t=>t.temperature==="cool"),neutral:C.filter(t=>t.temperature==="neutral")},Ut={gray:C.filter(t=>t.saturation==="gray"),muted:C.filter(t=>t.saturation==="muted"),chromatic:C.filter(t=>t.saturation==="chromatic"),vivid:C.filter(t=>t.saturation==="vivid")},sn=C.filter(t=>t.saturation==="vivid"||t.type==="cga"&&t.saturation!=="gray");function bt(t,e){let n=t.r-e.r,r=t.g-e.g,o=t.b-e.b;return Math.sqrt(n*n*.3+r*r*.59+o*o*.11)}function pt(t,e){if(!t.cubePos)return[];let{ri:n,gi:r,bi:o}=t.cubePos;return C.filter(s=>{if(!s.cubePos)return!1;let i=Math.abs(s.cubePos.ri-n)+Math.abs(s.cubePos.gi-r)+Math.abs(s.cubePos.bi-o);return i>0&&i<=e})}function ve(t){if(!t.cubePos){let f=t.temperature==="warm"?"cool":t.temperature==="cool"?"warm":"neutral";return St[f]}let{ri:e,gi:n,bi:r}=t.cubePos,o=e<3?4:1,s=n<3?4:1,i=r<3?4:1;return C.filter(f=>f.cubePos?Math.abs(f.cubePos.ri-o)<=1&&Math.abs(f.cubePos.gi-s)<=1&&Math.abs(f.cubePos.bi-i)<=1:!1)}function Fe(t,e,n){if(!t.cubePos||!e.cubePos)return ee(t,e,n);let r=[];for(let o=0;o<n;o++){let s=o/(n-1),i=Math.round(t.cubePos.ri+(e.cubePos.ri-t.cubePos.ri)*s),f=Math.round(t.cubePos.gi+(e.cubePos.gi-t.cubePos.gi)*s),h=Math.round(t.cubePos.bi+(e.cubePos.bi-t.cubePos.bi)*s),a=C.find(c=>c.cubePos&&c.cubePos.ri===i&&c.cubePos.gi===f&&c.cubePos.bi===h);a&&r.push(a)}return r}function ee(t,e,n){let r=t.luminance,o=e.luminance,s=[];for(let i=0;i<n;i++){let f=i/(n-1),h=r+(o-r)*f,a=C.filter(M=>M.temperature===t.temperature||M.temperature==="neutral"),c=a[0],y=Math.abs(c.luminance-h);for(let M of a){let x=Math.abs(M.luminance-h);x<y&&(y=x,c=M)}s.push(c)}return s}function q(t,e,n=4.5){let r=t.luminance/100,o=e.luminance/100,s=Math.max(r,o)+.05,i=Math.min(r,o)+.05;return s/i>=n}function F(t,e){return e[Math.floor(t()*e.length)]}function Ge(t,e,n){e/=100,n/=100;let r=e*Math.min(n,1-n),o=s=>{let i=(s+t/30)%12,f=n-r*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*f).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}`}function Pe(t){let e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,r=parseInt(t.slice(5,7),16)/255,o=Math.max(e,n,r),s=Math.min(e,n,r),i,f,h=(o+s)/2;if(o===s)i=f=0;else{let a=o-s;switch(f=h>.5?a/(2-o-s):a/(o+s),o){case e:i=((n-r)/a+(n<r?6:0))/6;break;case n:i=((r-e)/a+2)/6;break;case r:i=((e-n)/a+4)/6;break}}return{h:i*360,s:f*100,l:h*100}}function $t(t,e=10){return C.filter(n=>n.hex!==t.hex&&Math.abs(n.luminance-t.luminance)<e&&(n.temperature!==t.temperature||n.saturation!==t.saturation))}function Le(t,e){let n=Math.round((t.r+e.r)/2),r=Math.round((t.g+e.g)/2),o=Math.round((t.b+e.b)/2),s=(t.luminance+e.luminance)/2,i=C[0],f=1/0;for(let h of C){let a=Math.sqrt(Math.pow(h.r-n,2)+Math.pow(h.g-r,2)+Math.pow(h.b-o,2)),c=Math.abs(h.luminance-s)*2,y=a+c;y<f&&(f=y,i=h)}return i}function Kt(t,e,n){let r=[];switch(e){case"value":{let o=t.luminance>50?-40:40,s=Math.max(5,Math.min(95,t.luminance+o));r=C.filter(i=>i.hex!==t.hex&&Math.abs(i.luminance-s)<20&&(i.temperature===t.temperature||i.temperature==="neutral"||t.temperature==="neutral")),r.sort((i,f)=>{let h=i.temperature===t.temperature?0:1,a=f.temperature===t.temperature?0:1;return h!==a?h-a:Math.abs(i.luminance-s)-Math.abs(f.luminance-s)});break}case"temperature":{let o=t.temperature==="warm"?"cool":t.temperature==="cool"||n()<.5?"warm":"cool";r=C.filter(s=>s.hex!==t.hex&&s.temperature===o&&Math.abs(s.luminance-t.luminance)<25),r.sort((s,i)=>Math.abs(s.luminance-t.luminance)-Math.abs(i.luminance-t.luminance));break}case"saturation":{let o=["gray","muted","chromatic","vivid"],s=o.indexOf(t.saturation),i=s<=1?["chromatic","vivid"]:["muted","gray"];r=C.filter(f=>f.hex!==t.hex&&i.includes(f.saturation)&&Math.abs(f.luminance-t.luminance)<30&&(f.temperature===t.temperature||f.temperature==="neutral")),r.sort((f,h)=>{let a=o.indexOf(f.saturation),c=o.indexOf(h.saturation);return Math.abs(c-s)-Math.abs(a-s)});break}case"complement":{r=ve(t),r.sort((o,s)=>Math.abs(s.luminance-t.luminance)-Math.abs(o.luminance-t.luminance));break}case"neighbor":{t.cubePos?(r=pt(t,1),r.length<3&&(r=pt(t,2))):r=C.filter(o=>o.hex!==t.hex&&bt(t,o)<60&&bt(t,o)>20),r.sort((o,s)=>bt(t,o)-bt(t,s));break}}return r}function ke(t){let e=G(t);if(e()<.03)switch(Math.floor(e()*5)){case 0:{let p=e()<.5?ct.midLight:ct.midDark,u=[F(e,p),F(e,p),F(e,p)];return{bg:u[0].hex,text:u[1].hex,accent:u[2].hex,strategy:"glitch/washed"}}case 1:{let p=Ut.vivid.filter(b=>b.temperature==="warm"),u=Ut.vivid.filter(b=>b.temperature==="cool");return{bg:F(e,p).hex,text:F(e,u).hex,accent:F(e,e()<.5?p:u).hex,strategy:"glitch/acid"}}case 2:{let p=C.filter(b=>b.luminance<15),u=C.filter(b=>b.luminance>=10&&b.luminance<25);return{bg:F(e,p).hex,text:F(e,u).hex,accent:F(e,u).hex,strategy:"glitch/void"}}case 3:{let p=C.filter(b=>b.luminance>85),u=C.filter(b=>b.luminance>=70&&b.luminance<90);return{bg:F(e,p).hex,text:F(e,u).hex,accent:F(e,u).hex,strategy:"glitch/bleach"}}case 4:default:{let p=C.filter(u=>u.type==="cga");return{bg:F(e,p).hex,text:F(e,p).hex,accent:F(e,p).hex,strategy:"glitch/corrupt"}}}let r=C.filter(g=>g.saturation!=="gray"&&g.type==="websafe"),o=F(e,r),s=e(),i;s<.4?i="light":s<.8?i="dark":i="mid";let f=e(),h;f<.3?h="value":f<.5?h="temperature":f<.65?h="saturation":f<.8?h="complement":h="neighbor";let a;i==="light"?a=ct.light.filter(g=>g.temperature===o.temperature||g.temperature==="neutral"||g.saturation==="gray"):i==="dark"?a=ct.dark.filter(g=>g.temperature===o.temperature||g.temperature==="neutral"||g.saturation==="gray"):a=C.filter(g=>g.luminance>=35&&g.luminance<=65&&(g.saturation==="muted"||g.saturation==="gray")&&(g.temperature===o.temperature||g.temperature==="neutral")),a.length===0&&(a=i==="light"?ct.light:ct.dark);let c=F(e,a),y=Kt(o,h,e);y=y.filter(g=>q(c,g,4.5)),y.length===0&&(y=Kt(o,"value",e).filter(g=>q(c,g,4.5))),y.length===0&&(y=C.filter(g=>q(c,g,4.5)));let M=y.length>3?y[Math.floor(e()*Math.min(3,y.length))]:y[0]||o,x=e()<.2,m;if(x){let g=$t(c,15),p=$t(M,15),u=[...g,...p].filter(E=>q(c,E,3)&&E.hex!==M.hex&&E.saturation!=="gray"),b=new Set;if(u=u.filter(E=>b.has(E.hex)?!1:(b.add(E.hex),!0)),u.length>0){let E=u.filter(U=>U.saturation==="vivid"||U.saturation==="chromatic");m=F(e,E.length>0?E:u)}else{let E=Le(c,M);q(c,E,2.5)?m=E:m=M}}else m=M;return{bg:c.hex,text:M.hex,accent:m.hex,strategy:`${i}/${h}${x?"+accent":""}`}}function Vt(t,e,n){let r=[];for(let o=e;o<=n;o++)t%o===0&&r.push(o);return r}function Se(t,e,n,r){let o=1200-n*2,s=1500-n*2,i=Vt(o,20,600),f=Vt(s,20,600);i.length===0&&i.push(8),f.length===0&&f.push(12);let h=G(r+9999),a=[];for(let M of i)for(let x of f)Math.max(M/x,x/M)<=3&&a.push({w:M,h:x});if(a.length===0)return{cellW:8,cellH:12};a.sort((M,x)=>M.w*M.h-x.w*x.h);let c=h(),y;if(c<.1){let M=Math.floor(h()*Math.ceil(a.length*.25));y=a[M]}else if(c<.4){let M=Math.floor(a.length*.25),x=Math.floor(a.length*.75),m=M+Math.floor(h()*(x-M));y=a[Math.min(m,a.length-1)]}else{let M=Math.floor(a.length*.75),x=M+Math.floor(h()*(a.length-M));y=a[Math.min(x,a.length-1)]}return{cellW:y.w,cellH:y.h}}function De(t){let n=G(t+5555)();return n<.35?"normal":n<.5?"binary":n<.65?"inverted":n<.8?"sparse":"dense"}function Ot(t){let e=G(t+7777),n=e();if(n<.25){let r=.2+e()*.2;return{min:r,max:r+.1+e()*.2}}else if(n<.5){let r=.6+e()*.2;return{min:r,max:r+.1+e()*.1}}else return n<.75?{min:.1+e()*.2,max:.7+e()*.3}:{min:.3+e()*.2,max:.5+e()*.5}}function ne(t){let e=G(t+2222);return Math.floor(4+e()*66)}function oe(t){let e=G(t+6666),n=e();return n<.16?{type:"horizontal",jitter:3+e()*12}:n<.32?{type:"vertical",jitter:3+e()*12}:n<.44?{type:"diagonal",angle:e()<.5?45:135,jitter:5+e()*15}:n<.56?{type:"radial",focalX:.2+e()*.6,focalY:.2+e()*.6}:n<.68?{type:"grid",jitter:3+e()*10}:n<.8?{type:"clustered",clusterX:.15+e()*.7,clusterY:.15+e()*.7,spread:.2+e()*.4}:{type:"random"}}function kt(t){let e=t.toUpperCase();return C.find(n=>n.hex===e)||C[0]}function Ne(t,e,n){let r=G(t+3333),o=kt(e),s=kt(n),i=o.luminance>50,f=r();if(f<.45){if(o.cubePos&&s.cubePos){let a=Fe(o,s,6);if(a.length>=4)return[a[0].hex,a[Math.floor(a.length*.33)].hex,a[Math.floor(a.length*.66)].hex,a[a.length-1].hex]}let h=ee(o,s,6);return[h[0].hex,h[Math.floor(h.length*.33)].hex,h[Math.floor(h.length*.66)].hex,h[h.length-1].hex]}else if(f<.75){let h=pt(s,1),a=pt(s,2),c=pt(s,3),y=(u,b)=>i?b.luminance-u.luminance:u.luminance-b.luminance,M=h.filter(u=>q(o,u,2)).sort(y),x=a.filter(u=>q(o,u,3)).sort(y),m=c.filter(u=>q(o,u,4)).sort(y),g=[s.hex];if(M.length>0?g.push(F(r,M).hex):g.push(s.hex),x.length>0){let u=x.filter(b=>!g.includes(b.hex));g.push(u.length>0?F(r,u).hex:x[0].hex)}else g.push(g[1]);if(m.length>0){let u=m.filter(b=>!g.includes(b.hex));g.push(u.length>0?F(r,u).hex:m[0].hex)}else g.push(s.hex);let p=g.map(u=>kt(u));return p.sort((u,b)=>i?b.luminance-u.luminance:u.luminance-b.luminance),p.map(u=>u.hex)}else{let h=s.temperature,a=h==="warm"?"cool":"warm",c=St[h].filter(u=>q(o,u,2.5)),y=St[a].filter(u=>q(o,u,2.5)),M=(u,b)=>i?b.luminance-u.luminance:u.luminance-b.luminance;c.sort(M),y.sort(M);let x=[];x.push(c.length>0?c[0].hex:s.hex);let m=c.filter(u=>!x.includes(u.hex));x.push(m.length>0?m[Math.floor(m.length*.3)].hex:s.hex);let g=y.filter(u=>!x.includes(u.hex));x.push(g.length>0?g[Math.floor(g.length*.5)].hex:s.hex);let p=[...c,...y].filter(u=>!x.includes(u.hex));return p.sort(M),x.push(p.length>0?p[p.length-1].hex:s.hex),x}}function _e(t){return G(t+4444)()<.25}function Oe(t){return G(t+9191)()<.008}function We(t){let e=G(t+5555),n=.1+e()*.8,r=0,o=e()<.4,s=o?e()*180:null,i=o?.2+e()*.6:0,f=.3+e()*1.4;return{absorbency:n,intersectionThreshold:r,angleAffinity:s,affinityStrength:i,ceilingMultiplier:f}}function He(t){let e=t.absorbency<.35?"Resistant":t.absorbency<.65?"Standard":"Absorbent",n=t.intersectionThreshold<.15?"Fine":t.intersectionThreshold<.35?"Medium":"Coarse",r=t.angleAffinity!==null?"Grain":"Uniform";return`${e}/${n}/${r}`}function Ye(t,e,n){return t}var zt=[1/64,1/32,1/16,1/8,1/4,1/2,1,2];function Be(t,e,n,r,o){let s=G(t+12345),i=s()<.4,f=!1,h=!1;if(i){let T=s();T<.33?f=!0:(T<.66||(f=!0),h=!0)}let a=()=>{let T=zt.slice(0,7);return s()<.25&&T.push(zt[7]),T},c=e,y=n,M=1,x=0,m=1/0,g=f?a():[0];for(let T of g){let k=c*T,et=c+k,S=Math.max(1,Math.floor((r+k)/et));if(S===1){let R=Math.min(c,r),v=Math.abs(r-R);v<m&&(m=v,M=1,x=0,c=R)}else{let R=S*c+(S-1)*k;if(R<=r){let v=Math.abs(r-R);v<m&&(m=v,M=S,x=k)}}}M===1&&c<r&&(c=r,x=0);let p=1,u=0,b=1/0,E=h?a():[0];for(let T of E){let k=y*T,et=y+k,S=Math.max(1,Math.floor((o+k)/et));if(S===1){let R=Math.min(y,o),v=Math.abs(o-R);v<b&&(b=v,p=1,u=0,y=R)}else{let R=S*y+(S-1)*k;if(R<=o){let v=Math.abs(o-R);v<b&&(b=v,p=S,u=k)}}}p===1&&y<o&&(y=o,u=0);let U=M,$=p,z=x,P=u,K=U*c+(U>1?(U-1)*z:0),l=$*y+($>1?($-1)*P:0),V=r-K,L=o-l;return{cols:U,rows:$,cellWidth:c,cellHeight:y,colGap:z,rowGap:P,strideX:c+z,strideY:y+P,gridOffsetX:V>0?V/2:0,gridOffsetY:L>0?L/2:0,actualGridWidth:K,actualGridHeight:l}}function Xe(t){let e=Object.values(t).filter(f=>f>0);if(e.length===0)return{t1:1,t2:2,t3:3,tExtreme:999};e.sort((f,h)=>f-h);let n=(f,h)=>{let a=Math.floor(f.length*h);return f[Math.min(a,f.length-1)]},r=n(e,.7),o=n(e,.94),s=n(e,.94)+1,i=n(e,.985);return{t1:Math.max(.01,r),t2:Math.max(r+.01,o),t3:Math.max(o+.01,s),tExtreme:Math.max(s+.01,i)}}function rt(t,e){return t===0?0:t<=e.t1?1:t<=e.t2?2:3}function G(t){let e=Math.abs(t)||1;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}var W={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),sub:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),scale:(t,e)=>({x:t.x*e,y:t.y*e}),dot:(t,e)=>t.x*e.x+t.y*e.y,len:t=>Math.sqrt(t.x*t.x+t.y*t.y),dist:(t,e)=>W.len(W.sub(t,e)),norm:t=>{let e=W.len(t);return e>1e-4?W.scale(t,1/e):{x:0,y:0}},perp:t=>({x:-t.y,y:t.x}),mid:(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),lerp:(t,e,n)=>({x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}),copy:t=>({x:t.x,y:t.y}),eq:(t,e)=>W.dist(t,e)<.5};function Wt(t,e,n,r){let o=W.sub(e,t),s=W.sub(r,n),i=o.x*s.y-o.y*s.x;if(Math.abs(i)<1e-4)return null;let f=W.sub(n,t),h=(f.x*s.y-f.y*s.x)/i,a=(f.x*o.y-f.y*o.x)/i;return h>=.001&&h<=.999&&a>=.001&&a<=.999?{point:W.add(t,W.scale(o,h)),t:h,u:a}:null}function je(t,e){let n=t.reduce((o,s)=>o+s,0);if(n<=0)return 0;let r=e()*n;for(let o=0;o<t.length;o++)if(r-=t[o],r<=0)return o;return t.length-1}var Ue=0,$e=1,Ke=2,Ve=3;function Q(t,e,n,r){switch(t){case Ue:return{x:e*n,y:0};case $e:return{x:n,y:e*r};case Ke:return{x:(1-e)*n,y:r};case Ve:return{x:0,y:(1-e)*r};default:return{x:e*n,y:0}}}function re(t,e,n){switch(t){case 0:return{x:0,y:0};case 1:return{x:e,y:0};case 2:return{x:e,y:n};case 3:return{x:0,y:n};default:return{x:0,y:0}}}function se(t,e){return{x:t.p1.x+(t.p2.x-t.p1.x)*e,y:t.p1.y+(t.p2.y-t.p1.y)*e}}function Dt(t,e){let n=e.x-t.x,r=e.y-t.y,o=Math.atan2(r,n)*180/Math.PI;return o<0&&(o+=180),o>=180&&(o-=180),o}function ze(t,e,n,r,o,s){let i=Math.max(.2,1-t*.015);if(s()<i||e.length===0&&n.length===0)if(s()<.15){let a=Math.floor(s()*4);return{point:re(a,r,o),type:"corner",corner:a}}else{let a=Math.floor(s()*4),c=.05+s()*.9;return{point:Q(a,c,r,o),type:"edge",edge:a,t:c}}else if(n.length>0&&s()<.35){let a=n[Math.floor(s()*n.length)];return{point:{x:a.x,y:a.y},type:"intersection",intersectionIndex:n.indexOf(a)}}else if(e.length>0){let a=e[Math.floor(s()*e.length)],c=.1+s()*.8;return{point:se(a,c),type:"crease",creaseIndex:e.indexOf(a),t:c}}else{let a=Math.floor(s()*4),c=.05+s()*.9;return{point:Q(a,c,r,o),type:"edge",edge:a,t:c}}}function qe(t,e,n,r,o,s,i,f){let h=Math.min(o,s)*.15,a=[];if(t.type==="edge"){let x=(t.edge+2)%4,m=(t.edge+1)%4,g=(t.edge+3)%4,p=e<3?3:1.5;for(let b=0;b<3;b++){let E=.1+i()*.8;a.push({point:Q(x,E,o,s),type:"edge",edge:x,weight:p})}let u=1;for(let b=0;b<2;b++){let E=.1+i()*.8;a.push({point:Q(m,E,o,s),type:"edge",edge:m,weight:u}),a.push({point:Q(g,E,o,s),type:"edge",edge:g,weight:u})}}else if(t.type==="corner"){let x=(t.corner+2)%4;a.push({point:re(x,o,s),type:"corner",weight:2});for(let m=0;m<4;m++)if(!(m===t.corner||m===(t.corner+3)%4)){let p=.2+i()*.6;a.push({point:Q(m,p,o,s),type:"edge",edge:m,weight:1.5})}}else{for(let x=0;x<4;x++){let m=.1+i()*.8;a.push({point:Q(x,m,o,s),type:"edge",edge:x,weight:1})}if(n.length>1&&e>3)for(let x=0;x<Math.min(3,n.length);x++){let m=Math.floor(i()*n.length),g=n[m];if(t.type==="crease"&&t.creaseIndex===m)continue;let p=.15+i()*.7;a.push({point:se(g,p),type:"crease",creaseIndex:m,weight:.6})}}if(n.length>0&&f)for(let x of a){let m=Dt(t.point,x.point);for(let g of n){let p=Dt(g.p1,g.p2),u=Math.abs(m-p);u>90&&(u=180-u),f.parallel>0&&u<15&&(x.weight*=1+f.parallel),f.perpendicular>0&&u>75&&(x.weight*=1+f.perpendicular)}}let c=a.filter(x=>W.dist(t.point,x.point)>=h);if(c.length===0){for(let m=0;m<4;m++){let p=Q(m,.5,o,s);if(W.dist(t.point,p)>=h)return{point:p,type:"edge",edge:m}}let x=t.type==="edge"?(t.edge+2)%4:0;return{point:Q(x,.5,o,s),type:"edge",edge:x}}let y=c.map(x=>x.weight),M=je(y,i);return c[M]}function Je(t){let e=[];for(let n=0;n<t.length;n++)for(let r=n+1;r<t.length;r++){let o=Wt(t[n].p1,t[n].p2,t[r].p1,t[r].p2);o&&e.push({x:o.point.x,y:o.point.y,crease1:n,crease2:r})}return e}function ae(t,e,n,r,o={min:0,max:1},s=null,i=null){if(!t||!e||t<=0||e<=0)return{creases:[],finalShape:[]};let f=s||oe(r),h=ne(r),a=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],c=[],y=null,M=null;if(!n||n<=0)return{creases:[],finalShape:a,maxFolds:h,firstFoldTarget:null,lastFoldTarget:null};let x=G(r),m=G(r+8888),g=G(r+6666),p=i||{absorbency:1,intersectionThreshold:0,angleAffinity:null,affinityStrength:0,ceilingMultiplier:1},u=[],b=G(r+1111);for(let P=0;P<h;P++)u[P]=.001+b()*.25;let E=G(r+2222),U={parallel:E()*.8,perpendicular:E()*.8},$=Math.max(t,e)*.05,z=[];for(let P=0;P<n;P++){let K=P%h,l=Math.floor(P/h);if(K===0&&l>0)for(let Y of c)Y.reductionMultiplier!==void 0&&(Y.weight=Math.max(.01,Y.weight*Y.reductionMultiplier));P%5===0&&c.length>1&&(z=Je(c));let V=ze(P,c,z,t,e,x),L=qe(V,P,c,z,t,e,x,U),T=V.point,k=L.point;if(W.dist(T,k)<Math.min(t,e)*.1)continue;let S=g()<p.absorbency,R=o.min+m()*(o.max-o.min);if(p.angleAffinity!==null&&p.affinityStrength>0){let Y=Dt(T,k),X=Math.abs(Y-p.angleAffinity);X>90&&(X=180-X);let nt=1-X/90*p.affinityStrength;R*=nt}if(S&&R>.01&&(c.push({p1:W.copy(T),p2:W.copy(k),depth:c.length,weight:R,cyclePosition:K,reductionMultiplier:u[K],anchorType:V.type,terminusType:L.type}),c.length>1)){let Y=c[c.length-1];for(let X=0;X<c.length-1;X++){let nt=Wt(Y.p1,Y.p2,c[X].p1,c[X].p2);nt&&z.push({x:nt.point.x,y:nt.point.y,crease1:X,crease2:c.length-1})}}let v=W.mid(T,k),st={x:Math.max($,Math.min(t-$,v.x)),y:Math.max($,Math.min(e-$,v.y))};P===0&&y===null&&(y=st),M=st}return{creases:c,finalShape:a,maxFolds:h,firstFoldTarget:y,lastFoldTarget:M}}function Qe(t){let e=[];for(let n=0;n<t.length;n++)for(let r=n+1;r<t.length;r++){let o=Wt(t[n].p1,t[n].p2,t[r].p1,t[r].p2);if(o){let s=t[n].weight||1,i=t[r].weight||1;e.push({x:o.point.x,y:o.point.y,depth1:t[n].depth,depth2:t[r].depth,gap:Math.abs(t[r].depth-t[n].depth),weight:s+i})}}return e}function Ze(t,e,n,r,o,s=null,i=null){let f=Qe(t),h=i||{intersectionThreshold:0,ceilingMultiplier:1},a=f.filter(p=>p.weight>=h.intersectionThreshold),c={},y={},M={};for(let p of a){let u=Math.floor(p.x/r),b=Math.floor(p.y/o);if(u>=0&&u<e&&b>=0&&b<n){let E=`${u},${b}`;c[E]=(c[E]||0)+p.weight,y[E]=Math.max(y[E]||0,p.gap),M[E]=(M[E]||0)+1}}let m=e*n*.5*h.ceilingMultiplier,g=Object.values(c).reduce((p,u)=>p+u,0);if(g>m&&g>0){let p=m/g,u=p+(1-p)*.3;for(let b of Object.keys(c))c[b]*=u}return{activeCreases:t,intersections:a,cellWeights:c,cellMaxGap:y,cellIntersectionCounts:M,destroyed:0,maxFolds:s}}function ie({folds:t,seed:e,outputWidth:n,outputHeight:r,bgColor:o,textColor:s,accentColor:i,cellWidth:f,cellHeight:h,renderMode:a,multiColor:c,levelColors:y,foldStrategy:M=null,paperProperties:x=null,padding:m=0,showCreases:g=!1,showPaperShape:p=!1,showFoldTargets:u=!1,showIntersections:b=!1,showGrid:E=!1,showHitCounts:U=!1,showCellOutlines:$=!1,showCreaseLines:z=!1,fontFamily:P=Jt}){let K=document.createElement("canvas"),l=K.getContext("2d"),V=2;K.width=n*V,K.height=r*V,l.setTransform(V,0,0,V,0,0),l.fillStyle=o,l.fillRect(0,0,n,r);let L=n/1200,T=r/1500,k=1200-m*2-50*2,et=1500-m*2-50*2,S=Be(e,f,h,k,et),{cols:R,rows:v,strideX:st,strideY:Y,gridOffsetX:X,gridOffsetY:nt}=S,le=S.cellWidth,ce=S.cellHeight,ue=k*L,fe=et*T,O=(m+50+X)*L,H=(m+50+nt)*T,dt=le*L,mt=ce*T,ut=st*L,ft=Y*T,he=Ot(e),xe=Ye(x,R,v),Yt=S.actualGridWidth,ge=S.actualGridHeight,{creases:pe,finalShape:de,maxFolds:me,firstFoldTarget:at,lastFoldTarget:it}=ae(Yt,ge,t,e,he,M,xe),ye=pe.map(d=>({...d,p1:{x:d.p1.x*L,y:d.p1.y*T},p2:{x:d.p2.x*L,y:d.p2.y*T}})),Ct=null;if(at){let d=Math.max(0,Math.min(R-1,Math.floor(at.x/st))),A=Math.max(0,Math.min(v-1,Math.floor(at.y/Y)));Ct=`${d},${A}`}let Et=null;if(it){let d=Math.max(0,Math.min(R-1,Math.floor(it.x/st))),A=Math.max(0,Math.min(v-1,Math.floor(it.y/Y)));Et=`${d},${A}`}let{activeCreases:wt,intersections:Tt,cellWeights:Rt,cellMaxGap:It}=Ze(ye,R,v,ut,ft,me,x),vt=new Set;if(Object.keys(It).length>0){let d=Math.max(...Object.values(It));for(let[A,w]of Object.entries(It))w===d&&vt.add(A)}let Ft=mt-2*T,on=Ft>350?"large":Ft>100?"medium":"small";l.font=`${Ft}px ${P}`,l.textBaseline="top";let B=[" ","\u2591","\u2592","\u2593"],Bt={};for(let d of B){let A=l.measureText(d);Bt[d]={width:A.width}}let ot=Xe(Rt),Gt=G(e+11111),Me=Math.floor(Gt()*5),lt=[.95,.75,.5,.25,.05],ht=Math.floor(Gt()*lt.length),yt=Math.floor(Gt()*3)+1,be=(d,A)=>{let w=ht;switch(Me){case 1:w=(ht+Math.floor(d/2)*yt)%lt.length;break;case 2:w=(ht+Math.floor(A/2)*yt)%lt.length;break;case 3:w=(ht+(d+A)%2*yt)%lt.length;break;case 4:w=(ht+Math.floor((d+A)/2)*yt)%lt.length;break;default:break}return lt[w]},Z=(d,A)=>c&&y?y[Math.min(d,3)]:s,Ae=Yt*L,Ce=O+Ae;if(U){let d=Math.floor(Math.min(dt*.45,mt*.7));l.font=`bold ${d}px monospace`,l.textAlign="center",l.textBaseline="middle",l.fillStyle=s;for(let A=0;A<v;A++)for(let w=0;w<R;w++){let xt=Math.round(O+w*ut+dt/2),D=Math.round(H+A*ft+mt/2),N=`${w},${A}`,_=Rt[N]||0;_>0&&l.fillText(Math.round(_).toString(),xt,D)}l.textAlign="left",l.textBaseline="top"}else for(let d=0;d<v;d++)for(let A=0;A<R;A++){let w=Math.round(O+A*ut),xt=Math.round(H+d*ft),D=`${A},${d}`,N=Rt[D]||0,_=null,j=s,I=-1;if(Ct===D)I=N>0?rt(N,ot):2,_=B[Math.max(I,2)],j=i;else if(Et===D)I=N>0?rt(N,ot):2,_=B[Math.max(I,2)],j=s;else if(vt.has(D)&&N>0)_=B[2],I=2,j=i;else if(N>=1.5){let Xt=N-1.5,Mt=30+Math.min(Xt*300,150),J=Pe(s),gt=(J.h+Mt+360)%360,Pt=Math.min(100,J.s+20),tt=Math.min(85,J.l+10);_=B[3],I=3,j=Ge(gt,Pt,tt)}else a==="normal"?(I=rt(N,ot),_=B[I],j=Z(I,D)):a==="binary"?N===0?(_=B[0],I=0,j=Z(0,D)):(_=B[3],I=3,j=Z(3,D)):a==="inverted"?(I=3-rt(N,ot),_=B[I],j=Z(I,D)):a==="sparse"?(I=rt(N,ot),I===1&&(_=B[1],j=Z(1,D))):a==="dense"&&(I=rt(N,ot),I>=2?(_=B[I],j=Z(I,D)):N===0&&(_=B[0],I=0,j=Z(0,D)));if(_){if(Ct===D||Et===D)l.fillStyle=j;else{let tt=Z(rt(N,ot),D);l.fillStyle=vt.has(D)&&N>0?i:tt}let Xt=l.measureText(_).width,Mt=w+dt,J=w,gt=0,Pt=be(d,A);for(;J<Mt&&I>=0;){let tt=_;I>=2&&gt>0&&gt%2===0&&(tt=B[Math.max(0,I-1)]);let jt=Bt[tt]?.width||l.measureText(tt).width;if(Mt-J<=0||J+jt>Ce)break;l.fillText(tt,J,xt),J+=jt*Pt,gt++}}}if($){l.strokeStyle=i,l.lineWidth=.5,l.globalAlpha=1;for(let d=0;d<v;d++)for(let A=0;A<R;A++){let w=Math.round(O+A*ut),xt=Math.round(H+d*ft);l.strokeRect(w,xt,dt,mt)}}if(z&&wt.length>0){let A=G(e+9292)()<.6;l.strokeStyle=A?i:s,l.lineWidth=1.5*L,l.globalAlpha=.85,l.lineCap="round";for(let w of wt)l.beginPath(),l.moveTo(O+w.p1.x,H+w.p1.y),l.lineTo(O+w.p2.x,H+w.p2.y),l.stroke();l.globalAlpha=1}if(g){l.strokeStyle="#ff00ff",l.lineWidth=1,l.globalAlpha=.7;for(let d of wt)l.beginPath(),l.moveTo(O+d.p1.x,H+d.p1.y),l.lineTo(O+d.p2.x,H+d.p2.y),l.stroke();l.globalAlpha=1}if(p){let d=de.map(A=>({x:A.x*L,y:A.y*T}));if(d.length>=3){l.strokeStyle="#00ffff",l.lineWidth=2,l.globalAlpha=.9,l.beginPath(),l.moveTo(O+d[0].x,H+d[0].y);for(let A=1;A<d.length;A++)l.lineTo(O+d[A].x,H+d[A].y);l.closePath(),l.stroke(),l.fillStyle="#00ffff",l.globalAlpha=.15,l.fill(),l.globalAlpha=1}}if(E){l.strokeStyle=s,l.lineWidth=1,l.globalAlpha=.3;for(let d=0;d<=R;d++){let A=O+d*ut;l.beginPath(),l.moveTo(A,H),l.lineTo(A,H+fe),l.stroke()}for(let d=0;d<=v;d++){let A=H+d*ft;l.beginPath(),l.moveTo(O,A),l.lineTo(O+ue,A),l.stroke()}l.globalAlpha=1}if(u){let d=8*L;if(l.lineWidth=2,l.globalAlpha=1,at){let A=O+at.x*L,w=H+at.y*T;l.strokeStyle="#00ff00",l.beginPath(),l.arc(A,w,d,0,Math.PI*2),l.stroke()}if(it){let A=O+it.x*L,w=H+it.y*T;l.strokeStyle="#00ff00",l.beginPath(),l.arc(A,w,d,0,Math.PI*2),l.stroke()}}if(b&&Tt&&Tt.length>0){l.strokeStyle="#ff0000",l.fillStyle="rgba(255, 0, 0, 0)",l.lineWidth=1.5,l.globalAlpha=1;let d=3;for(let A of Tt)l.beginPath(),l.arc(O+A.x,H+A.y,d,0,Math.PI*2),l.fill(),l.stroke()}return K.toDataURL("image/png")}function Ht(t,e=1200,n=1500,r=0,o=null){let s=ke(t),i=Se(e,n,r,t),f=De(t),h=Ot(t),a=oe(t),c=_e(t),y=c?Ne(t,s.bg,s.text):null,M=ne(t),x=We(t),m=Oe(t),g=o;if(g===null){let p=G(t+9999);g=Math.floor(1+p()*500)}return{seed:t,palette:s,cells:i,renderMode:f,weightRange:h,foldStrategy:a,multiColor:c,levelColors:y,maxFolds:M,paperProperties:x,showCreaseLines:m,folds:g}}function tn(t,e,n,r=""){let o=Ht(e,1200,1500,0,n),s=Ot(e),i=1200-50*2,f=1500-50*2,{creases:h}=ae(i,f,n,e,s,o.foldStrategy,o.paperProperties),a=He(o.paperProperties);return{name:`Fold #${t}`,description:"On-chain generative paper folding art",image:r?`${r}/${t}`:"",attributes:[{trait_type:"Fold Strategy",value:o.foldStrategy.type},{trait_type:"Render Mode",value:o.renderMode},{trait_type:"Multi-Color",value:o.multiColor?"Yes":"No"},{trait_type:"Cell Size",value:`${o.cells.cellW}x${o.cells.cellH}`},{trait_type:"Fold Count",value:n},{trait_type:"Max Folds",value:o.maxFolds},{trait_type:"Crease Count",value:h.length},{trait_type:"Palette Strategy",value:o.palette.strategy},{trait_type:"Paper Type",value:a},{trait_type:"Paper Grain",value:o.paperProperties.angleAffinity!==null?"Grain":"Uniform"},...o.showCreaseLines?[{trait_type:"Crease Lines",value:"Visible"}]:[]]}}async function en(t){if(!t)return!1;let e=document.createElement("style");e.textContent=`
    @font-face {
      font-family: '${At}';
      src: url('${t}');
    }
  `,document.head.appendChild(e);try{return await document.fonts.load(`12px ${At}`),!0}catch(n){return console.warn("Failed to load on-chain font:",n),!1}}function nn(t){if(typeof t=="number")return t;if(typeof t!="string")return 0;let e=t.replace(/^0x/,"").slice(0,16),n=BigInt("0x"+e);return Number(n%BigInt(2147483647))}async function Nt(){let t=typeof window<"u"&&window.SEED,e=typeof window<"u"&&window.FOLD_COUNT,n=typeof window<"u"&&window.LESS_SEED;if(n&&!t&&(t=nn(n)),t&&e===void 0){let o=G(t+9999);e=Math.floor(1+o()*500)}let r=typeof window<"u"&&window.FONT_DATA_URI||qt;if(t&&e!==void 0){let o=document.getElementById("c")||document.querySelector("canvas");o||(o=document.createElement("canvas"),o.id="c",o.style.cssText="display:block;margin:0 auto;max-width:100%;max-height:100vh;",document.body.appendChild(o),document.body.style.cssText="margin:0;padding:0;background:#000;display:flex;align-items:center;justify-content:center;min-height:100vh;"),await en(r);let s=Ht(t,1200,1500,0,e),i=ie({folds:e,seed:t,outputWidth:1200,outputHeight:1500,bgColor:s.palette.bg,textColor:s.palette.text,accentColor:s.palette.accent,cellWidth:s.cells.cellW,cellHeight:s.cells.cellH,renderMode:s.renderMode,multiColor:s.multiColor,levelColors:s.levelColors,foldStrategy:s.foldStrategy,paperProperties:s.paperProperties,showCreaseLines:s.showCreaseLines}),f=new Image;f.onload=()=>{let h=o.getContext("2d");o.width=1200,o.height=1500,h.drawImage(f,0,0),typeof window.scaleCanvas=="function"&&window.scaleCanvas()},f.src=i}}typeof window<"u"&&(window.SEED||window.FOLD_COUNT!==void 0||window.LESS_SEED)&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Nt()):Nt());})();
